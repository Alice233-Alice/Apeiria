{"version":3,"file":"index.js","mappings":"AAKAA,EAAE,KACEC,QAAQC,KAAK,iBAGbC,sBAAsB,OAAOC,KAAK,KAC9BH,QAAQC,KAAK,4BAGbG,kBACI,WACCC,IACG,IAEI,MAAMC,EAAaD,EAAQC,YAAcC,sBACnCC,EAAYC,IAAIC,WAAW,CAAEC,KAAM,UAAWL,eAEpD,IAAKE,EAED,OADAR,QAAQY,KAAK,oBACN,YAGX,MAAMC,EAAYC,EAAEC,IAAIP,EAAW,YAAa,CAAC,GAG3C,EAAOM,EAAEC,IAAIF,EAAW,KAAM,CAAC,GAC/B,EAAOG,OAAOC,KAAK,GAGzB,GAAI,EAAKC,OAAS,EAAG,CACjB,MAAMC,EAAS,EAAKC,KAAK,KAEzB,OADApB,QAAQC,KAAK,sBAAsBkB,KAC5BA,CACX,CAEI,OADAnB,QAAQC,KAAK,iBACN,WAEf,CAAE,MAAOoB,GAGL,OAFArB,QAAQsB,MAAM,aAAcD,GAC5BE,OAAOC,QAAQ,YAAYH,aAAaI,MAAQJ,EAAEK,QAAU,SAAU,OAC/D,MACX,IAIR1B,QAAQC,KAAK,eACbsB,OAAOI,QAAQ,0BAA2B,SAC3CC,MAAMP,IACLrB,QAAQY,KAAK,uBAAwBS,GACrCE,OAAOC,QAAQ,qBAAsB","sources":["src://tavern_helper_template/src/红颜宏替换/index.ts"],"sourcesContent":["/**\r\n * 红颜宏替换脚本\r\n * 将世界书中的 {红颜} 占位符替换为实际的红颜名字列表\r\n */\r\n\r\n$(() => {\r\n    console.info('[红颜宏] 开始注册宏替换');\r\n\r\n    // 等待 MVU 初始化\r\n    waitGlobalInitialized('Mvu').then(() => {\r\n        console.info('[红颜宏] MVU 已初始化，注册 {红颜} 宏');\r\n\r\n        // 注册 {红颜} 宏\r\n        registerMacroLike(\r\n            /\\{红颜\\}/gi,\r\n            (context) => {\r\n                try {\r\n                    // 获取当前消息的 MVU 变量\r\n                    const message_id = context.message_id ?? getCurrentMessageId();\r\n                    const variables = Mvu.getMvuData({ type: 'message', message_id });\r\n\r\n                    if (!variables) {\r\n                        console.warn('[红颜宏] 未找到 MVU 变量');\r\n                        return '(当前无红颜角色)';\r\n                    }\r\n\r\n                    const stat_data = _.get(variables, 'stat_data', {});\r\n\r\n                    // 从红颜变量中获取所有红颜名字\r\n                    const 红颜对象 = _.get(stat_data, '红颜', {});\r\n                    const 红颜列表 = Object.keys(红颜对象);\r\n\r\n                    // 如果有红颜，返回名字列表；否则返回提示\r\n                    if (红颜列表.length > 0) {\r\n                        const result = 红颜列表.join('、');\r\n                        console.info(`[红颜宏] 替换成功: {红颜} → ${result}`);\r\n                        return result;\r\n                    } else {\r\n                        console.info('[红颜宏] 当前无红颜角色');\r\n                        return '(当前无红颜角色)';\r\n                    }\r\n                } catch (e) {\r\n                    console.error('[红颜宏] 替换失败', e);\r\n                    toastr.warning(`红颜宏替换失败: ${e instanceof Error ? e.message : '未知错误'}`, '红颜宏');\r\n                    return '{红颜}';\r\n                }\r\n            }\r\n        );\r\n\r\n        console.info('[红颜宏] 宏注册成功');\r\n        toastr.success('红颜宏已启用，世界书中的 {红颜} 将自动替换', '红颜宏');\r\n    }).catch(e => {\r\n        console.warn('[红颜宏] MVU 未加载，宏功能不可用', e);\r\n        toastr.warning('MVU 框架未加载，红颜宏功能不可用', '红颜宏');\r\n    });\r\n});"],"names":["$","console","info","waitGlobalInitialized","then","registerMacroLike","context","message_id","getCurrentMessageId","variables","Mvu","getMvuData","type","warn","stat_data","_","get","Object","keys","length","result","join","e","error","toastr","warning","Error","message","success","catch"],"ignoreList":[],"sourceRoot":""}