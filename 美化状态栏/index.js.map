{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/踏月寻仙-测试版/schema.ts","src://tavern_helper_template/external var \"_\"","src://tavern_helper_template/src/踏月寻仙-测试版/character-assets.ts","src://tavern_helper_template/src/踏月寻仙-测试版/themes.ts","src://tavern_helper_template/src/踏月寻仙-测试版/store.ts","webpack://tavern_helper_template/./src/踏月寻仙-测试版/app.vue?3d78","webpack://tavern_helper_template/src/踏月寻仙-测试版/app.vue?43c3","src://tavern_helper_template/src/踏月寻仙-测试版/index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","const __WEBPACK_NAMESPACE_OBJECT__ = z;","// ============================================================================\n// 踏月寻仙 - MVU 变量结构定义 (Zod Schema for MVU Variables)\n// ============================================================================\n// 修炼境界等级与境界描述映射\n// 等级 1-4:   练气（初期、中期、后期、大圆满）\n// 等级 5-8:   筑基（初期、中期、后期、大圆满）\n// 等级 9-12:  金丹（初期、中期、后期、大圆满）\n// 等级 13-16: 元婴（初期、中期、后期、大圆满）\n// 等级 17-20: 化神（初期、中期、后期、大圆满）\n// 等级 21-24: 炼虚（初期、中期、后期、大圆满）\n// 等级 25-28: 合体（初期、中期、后期、大圆满）\n// 等级 29-32: 大乘（初期、中期、后期、大圆满）\n// 等级 33-36: 渡劫（初期、中期、后期、大圆满）\nconst REALM_NAMES = ['练气', '筑基', '金丹', '元婴', '化神', '炼虚', '合体', '大乘', '渡劫'];\nconst REALM_STAGES = ['初期', '中期', '后期', '大圆满'];\n// 修炼境界等级与突破阈值映射\n// 练气到金丹（1-12级）：每个小境界递增100\n// 元婴开始（13级+）：每4个小境界翻倍\nconst REALM_THRESHOLDS = [\n    // 练气（1-4）：100, 200, 300, 400\n    100, 200, 300, 400,\n    // 筑基（5-8）：500, 600, 700, 800\n    500, 600, 700, 800,\n    // 金丹（9-12）：900, 1000, 1100, 1200\n    900, 1000, 1100, 1200,\n    // 元婴（13-16）：2400\n    2400, 2400, 2400, 2400,\n    // 化神（17-20）：4800\n    4800, 4800, 4800, 4800,\n    // 炼虚（21-24）：9600\n    9600, 9600, 9600, 9600,\n    // 合体（25-28）：19200\n    19200, 19200, 19200, 19200,\n    // 大乘（29-32）：38400\n    38400, 38400, 38400, 38400,\n    // 渡劫（33-36）：76800\n    76800, 76800, 76800, 76800,\n];\n// 修炼境界等级与寿元上限映射\nconst REALM_LIFESPANS = [100, 100, 100, 100, 200, 200, 200, 200, 500, 500, 500, 500, 1000, 1000, 1000, 1000, 2000, 2000, 2000, 2000, 5000, 5000, 5000, 5000, 10000, 10000, 10000, 10000, 50000, 50000, 50000, 50000, 100000, 100000, 100000, 100000];\n// 物品 Schema\nconst ItemSchema = z.object({\n    名称: z.string().prefault(''),\n    描述: z.string().prefault(''),\n    品阶: z.string().prefault(''),\n    数量: z.coerce.number().transform(v => Math.max(0, v)).prefault(1), // 允许数量为 0，由后续 transform 过滤\n});\n// 宗门势力 Schema - 优化版\nconst FactionSchema = z.object({\n    地: z.string().describe('所在地'),\n    特: z.string().describe('核心特点'),\n    力: z.string().describe('最高战力'),\n    营: z.enum(['正', '魔', '中']),\n    模: z.enum(['超大', '大', '小', '微', '特']),\n});\n// 功法 Schema - 优化版\nconst TechniqueSchema = z.object({\n    阶: z.enum(['凡', '黄', '玄', '地', '天', '仙', '圣']),\n    性: z.string().describe('属性'),\n    效: z.string().describe('效果'),\n});\n// 法宝兵器 Schema - 极简版\nconst TreasureSchema = z.object({\n    阶: z.enum(['凡器', '法器', '灵器', '法宝', '灵宝', '仙器', '圣器', '道器']),\n    类: z.string().describe('类型'),\n}).transform(data => ({\n    ...data,\n    特: data.阶 === '仙器' ? '顶级' : data.阶 === '灵宝' ? '强' : data.阶 === '法宝' ? '中' : '普通',\n}));\n// 地点 Schema - 优化版\nconst LocationSchema = z.object({\n    域: z.enum(['天层', '神州', '东苍', '南炎', '西庚', '北冥', '下层', '四海']),\n    类: z.enum(['秘境', '城镇', '宗门', '禁地', '遗迹', '地形']),\n    危: z.coerce.number().transform(v => _.clamp(v, 0, 100)),\n    特: z.string().describe('特点'),\n    资: z.array(z.string()).prefault([]),\n});\n// 灵根 Schema - 极简版（速度根据质自动计算）\nconst SpiritRootSchema = z.object({\n    质: z.enum(['劣', '下', '中', '上', '极', '天', '异']),\n    性: z.string().describe('属性'),\n    稀: z.enum(['常', '少', '罕', '稀', '传']),\n}).transform(data => {\n    const 速度映射 = { 劣: '0.3倍', 下: '0.5倍', 中: '1倍', 上: '2倍', 极: '3倍', 天: '5倍', 异: '4倍' };\n    return {\n        ...data,\n        速: 速度映射[data.质] || '1倍',\n        特: data.质 === '天' ? '单系顶级' : data.质 === '异' ? '变异稀有' : data.质 === '极' ? '双系优秀' : '常规',\n    };\n});\n// 体质 Schema - 优化版\nconst PhysiqueSchema = z.object({\n    质: z.enum(['凡', '灵', '道', '圣', '神']),\n    特: z.string().describe('特性'),\n    稀: z.enum(['常', '少', '罕', '稀', '传']),\n}).transform(data => ({\n    ...data,\n    优: data.质 === '神' ? '至高' : data.质 === '圣' ? '极强' : data.质 === '道' ? '强' : data.质 === '灵' ? '中' : '无',\n}));\n// 完整的 MVU 变量结构 - 完全参考角色卡示例的结构\nexport const Schema = z.object({\n    世界时钟: z.object({\n        纪元: z.string().prefault('末法时代'),\n        年份: z.coerce.number().prefault(1),\n        月份: z.coerce.number().transform(v => _.clamp(v, 1, 12)).prefault(1),\n        日期: z.coerce.number().transform(v => _.clamp(v, 1, 30)).prefault(1),\n        时辰: z.string().prefault('子时'),\n    }).prefault({\n        纪元: '末法时代',\n        年份: 1,\n        月份: 1,\n        日期: 1,\n        时辰: '子时',\n    }),\n    世界地图: z.record(z.string().describe('区域名'), z.object({\n        layer: z.enum(['天层', '地层', '下层']).prefault('地层'),\n        danger: z.coerce.number().transform(v => _.clamp(v, 0, 100)),\n        desc: z.string().prefault(''),\n        connections: z.array(z.string()).prefault([]),\n    })).prefault({}),\n    世界图志: z.record(z.string().describe('事件名'), z.object({\n        状态: z.string().prefault(''),\n        事件: z.string().prefault(''),\n    })).prefault({}),\n    宗门势力库: z.record(z.string().describe('宗门名'), FactionSchema).prefault({\n        // 正道\n        剑阁: { 地: '神州剑门关', 特: '剑道源头', 力: '渡劫后期', 营: '正', 模: '超大' },\n        万法宗: { 地: '神州问道峰', 特: '万法本源', 力: '渡劫初期', 营: '正', 模: '超大' },\n        金刚寺: { 地: '西天佛山', 特: '佛修炼体', 力: '大乘中期', 营: '正', 模: '大' },\n        药王谷: { 地: '神农架', 特: '医炼丹药', 力: '大乘初期', 营: '正', 模: '大' },\n        儒门: { 地: '文圣山', 特: '浩然正气', 力: '大乘中期', 营: '正', 模: '大' },\n        青龙殿: { 地: '东苍青龙山', 特: '守护青帝', 力: '大乘初期', 营: '正', 模: '大' },\n        玄武宗: { 地: '北冥玄冰山', 特: '镇守归墟', 力: '大乘后期', 营: '正', 模: '大' },\n        青云门: { 地: '神州青云山', 特: '水脉一系', 力: '大乘初期', 营: '正', 模: '大' },\n        建木宗: { 地: '东苍建木树', 特: '木系道法', 力: '合体中期', 营: '正', 模: '小' },\n        百花谷: { 地: '百花秘境', 特: '女修花道', 力: '合体后期', 营: '正', 模: '小' },\n        // 魔道\n        血神教: { 地: '血魔渊', 特: '血道炼法', 力: '渡劫中期', 营: '魔', 模: '超大' },\n        天魔宗: { 地: '天魔山', 特: '天魔大道', 力: '大乘中期', 营: '魔', 模: '大' },\n        // 中立\n        妖盟: { 地: '万妖森林', 特: '妖族联盟', 力: '渡劫中期', 营: '中', 模: '超大' },\n        大夏王朝: { 地: '中州皇城', 特: '世俗统治', 力: '大乘初期', 营: '中', 模: '大' },\n        九州商会: { 地: '九大主城', 特: '商业联盟', 力: '大乘初期', 营: '中', 模: '大' },\n        离火宫: { 地: '南炎火山', 特: '朱雀供奉', 力: '合体圆满', 营: '中', 模: '小' },\n        铸剑山庄: { 地: '南炎地火', 特: '炼器第一', 力: '合体后期', 营: '中', 模: '小' },\n    }),\n    功法库: z.record(z.string().describe('功法名'), TechniqueSchema).prefault({\n        // 基础 - 保留核心\n        引气诀: { 阶: '凡', 性: '通用', 效: '入门' },\n        筑基真解: { 阶: '玄', 性: '通用', 效: '筑基' },\n        金丹大道: { 阶: '地', 性: '通用', 效: '结丹' },\n        // 五行天阶 - 合并相似\n        万剑归宗诀: { 阶: '天', 性: '金剑', 效: '剑阁镇宗' },\n        建木通天诀: { 阶: '天', 性: '木', 效: '建木镇宗' },\n        北冥真经: { 阶: '天', 性: '水', 效: '玄武吞噬' },\n        朱雀涅槃经: { 阶: '天', 性: '火', 效: '离火涅槃' },\n        不动明王身: { 阶: '天', 性: '土佛', 效: '金刚防御' },\n        // 仙阶\n        万木朝宗: { 阶: '仙', 性: '木', 效: '青帝遗法' },\n        海纳百川: { 阶: '仙', 性: '水', 效: '归墟本源' },\n        祝融神火: { 阶: '仙', 性: '火', 效: '火神遗法' },\n        轮回经: { 阶: '仙', 性: '轮回', 效: '{{user}}专属' },\n        斩轮回剑典: { 阶: '仙', 性: '剑轮回', 效: '{{user}}前世' },\n        剑意通神: { 阶: '仙', 性: '剑道', 效: '剑意化形' },\n        // 特殊 - 保留关键\n        九天雷神诀: { 阶: '天', 性: '雷', 效: '雷霆' },\n        虚空经: { 阶: '天', 性: '空间', 效: '空间' },\n        万法归宗: { 阶: '天', 性: '通用', 效: '模拟' },\n        医仙宝典: { 阶: '天', 性: '医道', 效: '医道' },\n        天魔策: { 阶: '天', 性: '魔道', 效: '速成' },\n    }),\n    法宝库: z.record(z.string().describe('法宝名'), TreasureSchema).prefault({\n        // 核心仙器（白名单）\n        镇渊剑: { 阶: '仙器', 类: '剑' },\n        双鱼佩: { 阶: '仙器', 类: '护身' },\n        // 基础法宝\n        青锋剑: { 阶: '法器', 类: '剑' },\n        储物戒: { 阶: '灵器', 类: '储物' },\n        // 四象灵宝\n        青龙剑: { 阶: '灵宝', 类: '剑' },\n        白虎剑: { 阶: '灵宝', 类: '剑' },\n        朱雀剑: { 阶: '灵宝', 类: '剑' },\n        玄武剑: { 阶: '灵宝', 类: '剑' },\n    }),\n    地点库: z.record(z.string().describe('地点名'), LocationSchema).prefault({\n        // 天层 - 保留核心禁地\n        天渊: { 域: '天层', 类: '禁地', 危: 95, 特: '星辰裂隙', 资: ['星辰碎片', '陨铁'] },\n        罡风带: { 域: '天层', 类: '禁地', 危: 90, 特: '罡风屏障', 资: ['罡风精华'] },\n        // 神州 - 压缩描述但保留关键信息\n        问道峰: { 域: '神州', 类: '宗门', 危: 10, 特: '万法宗', 资: ['功法', '灵药'] },\n        剑门关: { 域: '神州', 类: '宗门', 危: 15, 特: '剑阁', 资: ['剑意', '飞剑'] },\n        藏书阁: { 域: '神州', 类: '宗门', 危: 5, 特: '古籍', 资: ['功法', '秘术'] },\n        酆都城: { 域: '神州', 类: '城镇', 危: 30, 特: '鬼市', 资: ['幽冥材料'] },\n        龙门瀑: { 域: '神州', 类: '秘境', 危: 40, 特: '化龙', 资: ['龙气'] },\n        // 东苍 - 保留重要遗迹和秘境\n        建木林: { 域: '东苍', 类: '地形', 危: 50, 特: '古树精', 资: ['灵木', '妖丹'] },\n        青帝陵: { 域: '东苍', 类: '遗迹', 危: 85, 特: '青帝传承', 资: ['青帝传承'] },\n        百花境: { 域: '东苍', 类: '秘境', 危: 20, 特: '花海', 资: ['灵花'] },\n        // 南炎 - 火系核心地点\n        不灭火山: { 域: '南炎', 类: '地形', 危: 80, 特: '朱雀涅槃', 资: ['朱雀火'] },\n        涅槃台: { 域: '南炎', 类: '遗迹', 危: 70, 特: '涅槃', 资: ['涅槃感悟'] },\n        // 西庚 - 剑道圣地\n        万剑冢: { 域: '西庚', 类: '禁地', 危: 85, 特: '剑意', 资: ['剑意', '古剑'] },\n        // 北冥 - 水系核心\n        玄冰山: { 域: '北冥', 类: '宗门', 危: 50, 特: '玄武宗', 资: ['玄冰'] },\n        归墟眼: { 域: '北冥', 类: '禁地', 危: 99, 特: '归墟', 资: ['归墟感悟'] },\n        // 下层 - 危险禁地\n        黄泉迹: { 域: '下层', 类: '遗迹', 危: 90, 特: '幽冥', 资: ['黄泉水'] },\n        炎渊: { 域: '下层', 类: '禁地', 危: 95, 特: '地心火', 资: ['地心火'] },\n    }),\n    灵根库: z.record(z.string().describe('灵根名'), SpiritRootSchema).prefault({\n        // 天灵根\n        金天根: { 质: '天', 性: '金', 稀: '传' },\n        木天根: { 质: '天', 性: '木', 稀: '传' },\n        水天根: { 质: '天', 性: '水', 稀: '传' },\n        火天根: { 质: '天', 性: '火', 稀: '传' },\n        土天根: { 质: '天', 性: '土', 稀: '传' },\n        // 多灵根\n        三灵根: { 质: '上', 性: '三系', 稀: '罕' },\n        四灵根: { 质: '中', 性: '四系', 稀: '少' },\n        五行杂根: { 质: '下', 性: '五行', 稀: '常' },\n        // 变异灵根\n        冰根: { 质: '异', 性: '冰', 稀: '传' },\n        雷根: { 质: '异', 性: '雷', 稀: '传' },\n        离火根: { 质: '异', 性: '离火', 稀: '传' },\n        空间根: { 质: '异', 性: '空间', 稀: '传' },\n        时间根: { 质: '异', 性: '时间', 稀: '传' },\n        混沌根: { 质: '异', 性: '混沌', 稀: '传' },\n        轮回根: { 质: '异', 性: '轮回', 稀: '传' },\n    }),\n    体质库: z.record(z.string().describe('体质名'), PhysiqueSchema).prefault({\n        凡体: { 质: '凡', 特: '普通', 稀: '常' },\n        // 灵体 - 合并相似属性体质\n        玄冰体: { 质: '灵', 特: '冰系增强', 稀: '罕' },\n        离火体: { 质: '灵', 特: '火系增强', 稀: '罕' },\n        木灵体: { 质: '灵', 特: '恢复增强', 稀: '罕' },\n        天籁体: { 质: '灵', 特: '音律神通', 稀: '罕' },\n        花妖体: { 质: '灵', 特: '魅惑控制', 稀: '稀' },\n        // 道体\n        朱雀脉: { 质: '道', 特: '火系涅槃', 稀: '传' },\n        真龙脉: { 质: '道', 特: '龙族神通', 稀: '传' },\n        战体: { 质: '道', 特: '战力倍增', 稀: '传' },\n        梦魇体: { 质: '道', 特: '幻术掌控', 稀: '传' },\n        雪魂体: { 质: '道', 特: '冰系极致', 稀: '传' },\n        // 圣体\n        混沌体: { 质: '圣', 特: '万法无阻', 稀: '传' },\n        道体: { 质: '圣', 特: '悟性极高', 稀: '传' },\n        金身: { 质: '圣', 特: '防御无敌', 稀: '传' },\n        // 神体\n        轮回体: { 质: '神', 特: '{{user}}专属轮回', 稀: '传' },\n        时空体: { 质: '神', 特: '时空掌控', 稀: '传' },\n    }),\n    本尊: z\n        .object({\n        等级: z.coerce.number().transform(v => _.clamp(v, 1, 36)).prefault(1),\n        修为: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        灵根: z.string().prefault('五行杂灵根'),\n        体质: z.string().prefault('凡体'),\n        功法: z.string().prefault('无'),\n        本命兵器: z.string().prefault('无'),\n        神通列表: z\n            .record(z.string().describe('神通名'), z.object({\n            名称: z.string().prefault(''),\n            描述: z.string().prefault(''),\n            类型: z.enum(['功法', '神通', '秘术']).prefault('神通'), // 新增：区分功法和神通\n            品阶: z.string()\n                .transform(v => {\n                // 容错：修正常见错误写法\n                const 品阶映射 = {\n                    '凡': '凡', '凡阶': '凡', '凡级': '凡', '凡品': '凡',\n                    '黄': '黄', '黄阶': '黄', '黄级': '黄', '黄品': '黄',\n                    '玄': '玄', '玄阶': '玄', '玄级': '玄', '玄品': '玄',\n                    '地': '地', '地阶': '地', '地级': '地', '地品': '地',\n                    '天': '天', '天阶': '天', '天级': '天', '天品': '天',\n                    '仙': '仙', '仙阶': '仙', '仙级': '仙', '仙品': '仙',\n                    '圣': '圣', '圣阶': '圣', '圣级': '圣', '圣品': '圣',\n                    '先天': '先天', '先天阶': '先天', '先天级': '先天',\n                };\n                return 品阶映射[v] || '凡';\n            })\n                .catch('凡'),\n            熟练度: z.string()\n                .transform(v => {\n                // 容错：修正常见错误写法\n                const 熟练度映射 = {\n                    '入门': '入门', '初级': '入门', '初学': '入门', '新手': '入门',\n                    '熟练': '熟练', '中级': '熟练', '娴熟': '熟练',\n                    '精通': '精通', '高级': '精通', '精湛': '精通',\n                    '大成': '大成', '大师': '大成', '宗师': '大成',\n                    '圆满': '圆满', '完美': '圆满', '极致': '圆满',\n                    '化境': '化境', '化神': '化境', '返璞归真': '化境', '出神入化': '化境',\n                };\n                return 熟练度映射[v] || '入门';\n            })\n                .catch('入门'),\n            领悟时间: z.coerce.number().catch(() => Date.now()),\n            威力等级: z.coerce.number().optional(),\n        })\n            .transform(skill => {\n            // 仅当威力等级不存在或为0时才计算\n            if (!skill.威力等级 || skill.威力等级 === 0) {\n                const 品阶权重 = { 凡: 1, 黄: 2, 玄: 3, 地: 4, 天: 5, 仙: 6, 圣: 7, 先天: 8 };\n                const 熟练度权重 = { 入门: 1, 熟练: 2, 精通: 3, 大成: 4, 圆满: 5, 化境: 6 };\n                const 品阶值 = 品阶权重[skill.品阶] || 1;\n                const 熟练值 = 熟练度权重[skill.熟练度] || 1;\n                return {\n                    ...skill,\n                    威力等级: 品阶值 * 10 + 熟练值,\n                };\n            }\n            return skill;\n        }))\n            .prefault({}),\n        灵石: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        已活岁月: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        尝试突破: z.boolean().prefault(false),\n        行踪: z.object({\n            当前区域: z.string().prefault('未知之地'),\n            所属层级: z.string().prefault('地层'),\n            环境描述: z.string().prefault(''),\n            危险度: z.coerce.number().prefault(10),\n            可用通道: z.array(z.string()).prefault([]),\n            导航信息: z.string().prefault(''),\n        }).prefault({\n            当前区域: '未知之地',\n            所属层级: '地层',\n            环境描述: '',\n            危险度: 10,\n            可用通道: [],\n            导航信息: '',\n        }),\n        身份: z.object({\n            姓名: z.string().prefault('无名氏'),\n            宗门: z.string().prefault('散修'),\n            出身: z.string().prefault('凡人'),\n        }).prefault({\n            姓名: '无名氏',\n            宗门: '散修',\n            出身: '凡人',\n        }),\n        背包: z\n            .record(z.string().describe('物品名'), ItemSchema)\n            .prefault({})\n            .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),\n        法宝: z\n            .record(z.string().describe('法宝名'), ItemSchema)\n            .prefault({})\n            .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),\n        杂物袋: z\n            .record(z.string().describe('杂物名'), ItemSchema)\n            .prefault({})\n            .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),\n    })\n        .prefault({\n        等级: 1,\n        修为: 0,\n        灵根: '五行杂灵根',\n        体质: '凡体',\n        功法: '无',\n        本命兵器: '无',\n        神通列表: {},\n        灵石: 0,\n        已活岁月: 0,\n        尝试突破: false,\n        行踪: {\n            当前区域: '未知之地',\n            所属层级: '地层',\n            环境描述: '',\n            危险度: 10,\n            可用通道: [],\n            导航信息: '',\n        },\n        身份: {\n            姓名: '无名氏',\n            宗门: '散修',\n            出身: '凡人',\n        },\n        背包: {},\n        法宝: {},\n        杂物袋: {},\n    })\n        .transform(data => {\n        const level = data.等级;\n        const 突破阈值 = REALM_THRESHOLDS[level - 1] ?? 100;\n        const 寿元上限 = REALM_LIFESPANS[level - 1] ?? 100;\n        const majorIdx = Math.floor((level - 1) / 4);\n        const minorIdx = (level - 1) % 4;\n        const 境界描述 = `${REALM_NAMES[majorIdx] ?? '练气'}${REALM_STAGES[minorIdx] ?? '初期'}`;\n        const 寿元状态 = `${data.已活岁月}/${寿元上限}`;\n        const 状态 = data.尝试突破 ? '突破中' : data.修为 >= 突破阈值 ? '瓶颈期' : '修炼中';\n        const 进度 = `${((data.修为 / 突破阈值) * 100).toFixed(1)}%`;\n        return {\n            ...data,\n            突破阈值,\n            寿元上限,\n            境界描述,\n            寿元状态,\n            状态,\n            进度,\n        };\n    }),\n    红颜角色库: z.record(z.string().describe('角色名'), z.object({\n        级: z.coerce.number().transform(v => _.clamp(v, 1, 36)),\n        根: z.string().describe('灵根'),\n        质: z.string().describe('体质'),\n        龄: z.string().describe('年龄'),\n        属: z.string().describe('所属'),\n        法: z.string().describe('功法'),\n        器: z.string().describe('本命兵器'),\n        通: z.array(z.string()).prefault([]),\n        型: z.enum(['核心', '重要', '次要']),\n    })).prefault({\n        许听雨: { 级: 33, 根: '水本源天', 质: '归墟神体', 龄: '外26实12000', 属: '归墟之主', 法: '万水归源先天', 器: '沧海遗珠先天', 通: ['归墟歌', '逆流虚妄', '寂灭海域', '万水同源'], 型: '核心' },\n        虞汐颜: { 级: 12, 根: '水阴阳异', 质: '双鱼体', 龄: '化形0年', 属: '{{user}}玉佩', 法: '双生天极/阴阳', 器: '双鱼佩本体', 通: ['枯木春', '夺命妆', '双鱼梦'], 型: '核心' },\n        白清弦: { 级: 29, 根: '金天根', 质: '剑体', 龄: '外30实1000+', 属: '散修剑宗师', 法: '剑意仙/天音天', 器: '清弦琴剑灵宝', 通: ['琴剑杀', '剑意歌', '万剑心'], 型: '核心' },\n        南宫云裳: { 级: 16, 根: '火天根', 质: '神凰道体', 龄: '外10实118', 属: '大夏栖凤宫主', 法: '九转涅槃仙', 器: '栖梧簪灵宝', 通: ['南明离火', '凰威镇世', '羽化虚空'], 型: '核心' },\n        焰绯月: { 级: 12, 根: '离火根极', 质: '朱雀脉', 龄: '25', 属: '离火宫圣女', 法: '朱雀天', 器: '绯月弓法宝', 通: ['离火天', '朱雀身', '凤凰槃'], 型: '重要' },\n        幻千丝: { 级: 13, 根: '暗幻双根', 质: '梦魇体', 龄: '外20未知', 属: '散修幽冥', 法: '织梦天', 器: '千丝网灵宝', 通: ['织梦笼', '心魔境', '千丝缚'], 型: '重要' },\n        花想容: { 级: 8, 根: '木根', 质: '花妖体', 龄: '外12', 属: '建木宗', 法: '百花地', 器: '牡丹瓣', 通: ['花海域', '治愈粉', '魅惑香'], 型: '次要' },\n    }),\n    红颜: z\n        .record(z.string().describe('红颜名'), z\n        .object({\n        等级: z.coerce.number().transform(v => _.clamp(v, 1, 36)).prefault(1),\n        修为: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        灵根: z.string().prefault('五行杂灵根'),\n        体质: z.string().prefault('凡体'),\n        功法: z.string().prefault('无'),\n        本命兵器: z.string().prefault('无'),\n        神通列表: z\n            .record(z.string().describe('神通名'), z.object({\n            名称: z.string().prefault(''),\n            描述: z.string().prefault(''),\n            类型: z.enum(['功法', '神通', '秘术']).prefault('神通'), // 新增：区分功法和神通\n            品阶: z.string()\n                .transform(v => {\n                // 容错：修正常见错误写法\n                const 品阶映射 = {\n                    '凡': '凡', '凡阶': '凡', '凡级': '凡', '凡品': '凡',\n                    '黄': '黄', '黄阶': '黄', '黄级': '黄', '黄品': '黄',\n                    '玄': '玄', '玄阶': '玄', '玄级': '玄', '玄品': '玄',\n                    '地': '地', '地阶': '地', '地级': '地', '地品': '地',\n                    '天': '天', '天阶': '天', '天级': '天', '天品': '天',\n                    '仙': '仙', '仙阶': '仙', '仙级': '仙', '仙品': '仙',\n                    '圣': '圣', '圣阶': '圣', '圣级': '圣', '圣品': '圣',\n                    '先天': '先天', '先天阶': '先天', '先天级': '先天',\n                };\n                return 品阶映射[v] || '凡';\n            })\n                .catch('凡'),\n            熟练度: z.string()\n                .transform(v => {\n                // 容错：修正常见错误写法\n                const 熟练度映射 = {\n                    '入门': '入门', '初级': '入门', '初学': '入门', '新手': '入门',\n                    '熟练': '熟练', '中级': '熟练', '娴熟': '熟练',\n                    '精通': '精通', '高级': '精通', '精湛': '精通',\n                    '大成': '大成', '大师': '大成', '宗师': '大成',\n                    '圆满': '圆满', '完美': '圆满', '极致': '圆满',\n                    '化境': '化境', '化神': '化境', '返璞归真': '化境', '出神入化': '化境',\n                };\n                return 熟练度映射[v] || '入门';\n            })\n                .catch('入门'),\n            领悟时间: z.coerce.number().catch(() => Date.now()),\n            威力等级: z.coerce.number().optional(),\n        })\n            .transform(skill => {\n            // 仅当威力等级不存在或为0时才计算\n            if (!skill.威力等级 || skill.威力等级 === 0) {\n                const 品阶权重 = { 凡: 1, 黄: 2, 玄: 3, 地: 4, 天: 5, 仙: 6, 圣: 7, 先天: 8 };\n                const 熟练度权重 = { 入门: 1, 熟练: 2, 精通: 3, 大成: 4, 圆满: 5, 化境: 6 };\n                const 品阶值 = 品阶权重[skill.品阶] || 1;\n                const 熟练值 = 熟练度权重[skill.熟练度] || 1;\n                return {\n                    ...skill,\n                    威力等级: 品阶值 * 10 + 熟练值,\n                };\n            }\n            return skill;\n        }))\n            .prefault({}),\n        灵石: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        已活岁月: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        尝试突破: z.boolean().prefault(false),\n        好感度: z.coerce.number().transform(v => _.clamp(v, -100, 100)).prefault(0),\n        关系: z.string().prefault('陌生人'),\n        重要性: z.string().prefault('路人'),\n    })\n        .prefault({\n        等级: 1,\n        修为: 0,\n        灵根: '五行杂灵根',\n        体质: '凡体',\n        功法: '无',\n        本命兵器: '无',\n        神通列表: {},\n        灵石: 0,\n        已活岁月: 0,\n        尝试突破: false,\n        好感度: 0,\n        关系: '陌生人',\n        重要性: '路人',\n    })\n        .transform(data => {\n        const level = data.等级;\n        const 突破阈值 = REALM_THRESHOLDS[level - 1] ?? 100;\n        const 寿元上限 = REALM_LIFESPANS[level - 1] ?? 100;\n        const majorIdx = Math.floor((level - 1) / 4);\n        const minorIdx = (level - 1) % 4;\n        const 境界描述 = `${REALM_NAMES[majorIdx] ?? '练气'}${REALM_STAGES[minorIdx] ?? '初期'}`;\n        const 寿元状态 = `${data.已活岁月}/${寿元上限}`;\n        const 状态 = data.尝试突破 ? '突破中' : data.修为 >= 突破阈值 ? '瓶颈期' : '修炼中';\n        const 进度 = `${((data.修为 / 突破阈值) * 100).toFixed(1)}%`;\n        return {\n            ...data,\n            突破阈值,\n            寿元上限,\n            境界描述,\n            寿元状态,\n            状态,\n            进度,\n        };\n    }))\n        .prefault({}),\n    // NPC图鉴 - 极简版（保留向后兼容）\n    NPC图鉴: z.record(z.string().describe('NPC名'), z.object({\n        等级: z.coerce.number().transform(v => _.clamp(v, 1, 36)).prefault(1),\n        所在宗门: z.string().prefault('散修'),\n        备注: z.string().prefault(''),\n    })).prefault({}),\n    // 任务列表 - 参考储物栏的稳定更新逻辑\n    任务列表: z\n        .record(z.string().describe('任务ID'), z.object({\n        名称: z.string().prefault(''),\n        类型: z.enum(['主线', '支线', '每日', '临危受命', '秘境探索']).prefault('主线'),\n        目标: z.string().prefault(''),\n        状态: z.enum(['进行中', '已完成', '已失败']).prefault('进行中'),\n        // 秘境专属字段（仅当类型为秘境探索时需要）\n        秘境信息: z\n            .object({\n            域: z.enum(['天层', '神州', '东苍', '南炎', '西庚', '北冥', '下层', '四海']).optional(),\n            危: z.coerce.number().transform(v => _.clamp(v, 0, 100)).optional(),\n            特: z.string().optional(),\n            奖: z.array(z.string()).prefault([]),\n            限: z.string().optional(),\n        })\n            .optional(),\n        创建时间: z.coerce.number().prefault(() => Date.now()),\n    }))\n        .prefault({})\n        .transform(tasks => {\n        // 按创建时间排序,保留最近的任务\n        const sorted = _(tasks)\n            .entries()\n            .sortBy(([_, t]) => -(t.创建时间 || 0));\n        // 保留所有进行中的任务 + 最近10个已完成/已失败的任务\n        const active = sorted.filter(([_, t]) => t.状态 === '进行中').value();\n        const completed = sorted.filter(([_, t]) => t.状态 !== '进行中').take(10).value();\n        return _.fromPairs([...active, ...completed]);\n    }),\n    // 声望系统 - 健壮性与智能管理优化\n    声望系统: z\n        .record(z.string().describe('势力名'), z.object({\n        值: z.coerce.number().transform(v => _.clamp(v, -100, 100)).prefault(0),\n        关系: z.string().prefault('陌生'),\n        更新时间: z.coerce.number().prefault(() => Date.now()),\n    }))\n        .prefault({})\n        .transform(factions => {\n        // 自动根据声望值计算关系描述\n        return _(factions)\n            .mapValues(faction => {\n            const value = faction.值;\n            let 自动关系;\n            if (value >= 80) {\n                自动关系 = '盟友';\n            }\n            else if (value >= 60) {\n                自动关系 = '友善';\n            }\n            else if (value >= 30) {\n                自动关系 = '友好';\n            }\n            else if (value >= 10) {\n                自动关系 = '中立偏好';\n            }\n            else if (value >= -10) {\n                自动关系 = '中立';\n            }\n            else if (value >= -30) {\n                自动关系 = '中立偏恶';\n            }\n            else if (value >= -60) {\n                自动关系 = '敌对';\n            }\n            else if (value >= -80) {\n                自动关系 = '仇恨';\n            }\n            else {\n                自动关系 = '不死不休';\n            }\n            // 如果用户手动设置了关系，优先使用用户设置；否则使用自动计算的关系\n            const 最终关系 = faction.关系 && faction.关系 !== '陌生' ? faction.关系 : 自动关系;\n            return {\n                ...faction,\n                关系: 最终关系,\n            };\n        })\n            .value();\n    }),\n});\n// 配置常量\nexport const CONFIG = {\n    REALMS: {\n        MAJOR: REALM_NAMES,\n        MINOR: REALM_STAGES,\n    },\n    ELEMENTS: {\n        火: { effect: '灼烧', visual: '烈焰', nature: '爆裂', color: '#ff4444' },\n        水: { effect: '缠绕', visual: '激流', nature: '柔韧', color: '#4488ff' },\n        冰: { effect: '冻结', visual: '寒霜', nature: '极寒', color: '#88ddff' },\n        雷: { effect: '麻痹', visual: '紫电', nature: '狂暴', color: '#aa44ff' },\n        风: { effect: '切割', visual: '罡风', nature: '无形', color: '#88ff88' },\n        土: { effect: '镇压', visual: '岩铠', nature: '厚重', color: '#aa8844' },\n        木: { effect: '寄生', visual: '藤蔓', nature: '生生不息', color: '#44aa44' },\n        金: { effect: '穿透', visual: '锐金', nature: '锋利', color: '#ffdd44' },\n        暗: { effect: '腐蚀', visual: '黑雾', nature: '诡谲', color: '#442244' },\n        光: { effect: '净化', visual: '圣辉', nature: '神圣', color: '#ffffaa' },\n        混沌: { effect: '湮灭', visual: '灰光', nature: '虚无', color: '#888888' },\n    },\n};\n// 获取灵根元素颜色\nexport function getRootColor(root) {\n    for (const [elem, data] of Object.entries(CONFIG.ELEMENTS)) {\n        if (root.includes(elem)) {\n            return data.color;\n        }\n    }\n    return '#cc99ff'; // 默认薰衣草紫（神秘优雅，适合特殊灵根）\n}\n// 获取境界等级颜色\nexport function getRealmColor(level) {\n    const majorIdx = Math.floor((level - 1) / 4);\n    const colors = [\n        '#888888', // 练气 - 灰色\n        '#44aa44', // 筑基 - 绿色\n        '#4488ff', // 金丹 - 蓝色\n        '#aa44ff', // 元婴 - 紫色\n        '#ff4444', // 化神 - 红色\n        '#ffaa00', // 炼虚 - 橙色\n        '#ffdd44', // 合体 - 金色\n        '#ffffff', // 大乘 - 白色\n        '#ff88ff', // 渡劫 - 粉色\n    ];\n    return colors[majorIdx] || '#888888';\n}\n// 获取危险度颜色\nexport function getDangerColor(danger) {\n    if (danger >= 90)\n        return '#ff0000';\n    if (danger >= 70)\n        return '#ff4400';\n    if (danger >= 50)\n        return '#ff8800';\n    if (danger >= 30)\n        return '#ffcc00';\n    return '#44aa44';\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = _;","// ============================================================================\n// 角色图片资源配置 (Character Assets Configuration)\n// 在这里配置所有角色的图片资源（正面和背面）\n// ============================================================================\n\n/**\n * 单个表情的图片配置\n */\nexport interface ExpressionImages {\n    /** 正面图片 URL */\n    front: string;\n    /** 背面图片 URL（可选，如果不填则使用正面图片） */\n    back?: string;\n}\n\n/**\n * 角色图片资源配置\n * 格式: { 角色名: { 表情代号: { front: 正面URL, back: 背面URL } } }\n *\n * 使用方法:\n * 1. 为每个角色创建一个对象\n * 2. 为每个表情/状态配置对应的正面和背面图片URL\n * 3. AI 输出时会根据 img_code 自动匹配对应的图片\n * 4. 如果不需要不同的背面图片，可以只填写 front，或使用简写形式\n */\nexport const CHARACTER_ASSETS: Record<string, Record<string, ExpressionImages | string>> = {\n    // ============================================================================\n    // 示例角色：孟十七\n    // ============================================================================\n    孟十七: {\n        // 完整配置示例（有不同的正面和背面）\n        normal: {\n            front: 'https://files.catbox.moe/c1su29.jpg', // 日常/平静 - 正面\n            back: 'https://files.catbox.moe/c1su29.jpg', // 日常/平静 - 背面（可以是不同的图片）\n        },\n        // 简写形式（正面和背面使用相同图片）\n        shy: 'https://files.catbox.moe/8doe0f.jpg', // 害羞/脸红\n        smile: 'https://files.catbox.moe/8doe0f.jpg', // 微笑/开心\n        angry: 'https://files.catbox.moe/c1su29.jpg', // 生气/鼓嘴\n        cry: 'https://files.catbox.moe/c1su29.jpg', // 哭泣/委屈\n        surprise: 'https://files.catbox.moe/8doe0f.jpg', // 惊讶/瞪眼\n    },\n\n    // ============================================================================\n    // 白清弦 - 剑道宗师\n    // ============================================================================\n    白清弦: {\n        // 随机选择正面和背面图片\n        normal: {\n            front: 'random_front', // 特殊标记，表示从正面图片池中随机选择\n            back: 'random_back',   // 特殊标记，表示从背面图片池中随机选择\n        },\n    },\n\n    // ============================================================================\n    // 虞汐颜 - 一体双魂（虞汐白头发/虞颜黑头发）\n    // ============================================================================\n    虞汐颜: {\n        // 随机选择正面和背面图片\n        // 特殊逻辑：正面虞汐时背面虞颜，正面虞颜时背面虞汐\n        normal: {\n            front: 'random_dual_front', // 特殊标记，随机选择虞汐或虞颜的正面\n            back: 'random_dual_back',   // 特殊标记，自动选择另一个魂体的背面\n        },\n    },\n\n    // ============================================================================\n    // 许听雨\n    // ============================================================================\n    许听雨: {\n        // 随机选择正面和背面图片\n        normal: {\n            front: 'random_front', // 特殊标记，表示从正面图片池中随机选择\n            back: 'random_back',   // 特殊标记，表示从背面图片池中随机选择\n        },\n    },\n\n    // ============================================================================\n    // 南宫云裳\n    // ============================================================================\n    南宫云裳: {\n        // 随机选择正面和背面图片\n        normal: {\n            front: 'random_front', // 特殊标记，表示从正面图片池中随机选择\n            back: 'random_back',   // 特殊标记，表示从背面图片池中随机选择\n        },\n    },\n\n    // ============================================================================\n    // 添加更多角色示例\n    // ============================================================================\n    // 角色名2: {\n    //   // 完整配置（不同的正面和背面）\n    //   normal: {\n    //     front: '正面图片URL',\n    //     back: '背面图片URL',\n    //   },\n    //   // 简写配置（正面和背面相同）\n    //   happy: '图片URL',\n    //   sad: '图片URL',\n    //   // ... 更多表情\n    // },\n};\n\n/**\n * 角色图片池 - 用于随机选择\n * 格式: { 角色名: { front: [正面图片URL列表], back: [背面图片URL列表] } }\n */\nexport const CHARACTER_IMAGE_POOLS: Record<string, { front: string[]; back: string[] }> = {\n    白清弦: {\n        front: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦1.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦2.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦3.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦4.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦5.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦18.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦19.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦20.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦21.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦22.png',\n        ],\n        back: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦6.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦7.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦8.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦9.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦10.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦11.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦15.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦16.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦17.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦25.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦24.png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/白清弦23.png',\n        ],\n    },\n    许听雨: {\n        front: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (1).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (2).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (3).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (4).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (5).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (12).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (13).png',\n        ],\n        back: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (6).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (7).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (9).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (10).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (11).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (14).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (15).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (17).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (18).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (19).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (20).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (21).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/许听雨 (16).png',\n        ],\n    },\n    虞汐颜: {\n        // 虞汐的图片（白头发）\n        虞汐_front: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (1).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (15).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (16).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (6).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (5).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (3).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (2).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (13).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (11).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (14).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (10).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (12).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (18).png',\n        ],\n        虞汐_back: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (17).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (8).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (7).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (4).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (20).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞汐 (19).png',\n        ],\n        // 虞颜的图片（黑头发）\n        虞颜_front: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (15).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (14).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (13).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (12).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (11).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (10).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (9).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (8).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (7).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (6).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (1).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (16).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (17).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (19).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (21).png',\n        ],\n        虞颜_back: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (5).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (4).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (3).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (2).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (18).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (20).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (22).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (23).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/虞颜 (24).png',\n        ],\n    } as any,\n    南宫云裳: {\n        front: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (1).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (3).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (4).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (7).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (8).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (9).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (10).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (11).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (15).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (18).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (19).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (20).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (21).png',\n        ],\n        back: [\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (5).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (6).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (12).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (13).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (14).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (16).png',\n            'https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/南宫云裳 (17).png',\n        ],\n    },\n};\n\n/**\n * 默认表情 - 当 AI 输出的 img_code 不存在时使用\n */\nexport const DEFAULT_EXPRESSION = 'normal';\n\n/**\n * 默认卡片背景 - 当角色没有配置图片时使用的占位图\n */\nexport const DEFAULT_PLACEHOLDER = 'https://files.catbox.moe/placeholder.jpg';\n\n/**\n * 从图片池中随机选择一张图片\n * 虞汐颜专用：缓存当前选择的魂体，以便正面和背面使用不同的魂体\n */\nlet cachedDualSoul: '虞汐' | '虞颜' | null = null;\n\n/**\n * 会话缓存：记录已经为虞汐颜生成过的卡片\n * 避免在同一个消息楼层中生成多张虞汐颜卡片\n */\nlet dualSoulSessionUsed = false;\n\nfunction getRandomImage(characterName: string, type: 'front' | 'back'): string {\n    const pool = CHARACTER_IMAGE_POOLS[characterName];\n    if (!pool) {\n        console.warn(`[图鉴] 未找到角色 \"${characterName}\" 的图片池`);\n        return DEFAULT_PLACEHOLDER;\n    }\n\n    const images = pool[type];\n    if (!images || images.length === 0) {\n        console.warn(`[图鉴] 角色 \"${characterName}\" 的 ${type} 图片池为空`);\n        return DEFAULT_PLACEHOLDER;\n    }\n\n    // 随机选择一张图片\n    const randomIndex = Math.floor(Math.random() * images.length);\n    return images[randomIndex];\n}\n\n/**\n * 虞汐颜专用：获取一体双魂的图片和名字\n * 正面虞汐时背面虞颜，正面虞颜时背面虞汐\n *\n * 重要：每次调用此函数时，只会生成一对卡片（正面+背面）\n * 如果已经生成过，则返回 null，避免重复生成\n */\nfunction getDualSoulImage(type: 'front' | 'back'): { url: string; soulName: string } | null {\n    const pool = CHARACTER_IMAGE_POOLS['虞汐颜'] as any;\n    if (!pool) {\n        console.warn(`[图鉴] 未找到虞汐颜的图片池`);\n        return { url: DEFAULT_PLACEHOLDER, soulName: '虞汐颜' };\n    }\n\n    if (type === 'front') {\n        // 如果已经生成过虞汐颜卡片，返回 null\n        if (dualSoulSessionUsed) {\n            console.info(`[图鉴] 虞汐颜卡片已生成，跳过重复生成`);\n            return null;\n        }\n\n        // 标记为已使用\n        dualSoulSessionUsed = true;\n\n        // 正面：随机选择虞汐或虞颜\n        const soul = Math.random() < 0.5 ? '虞汐' : '虞颜';\n        cachedDualSoul = soul;\n        const images = pool[`${soul}_front`];\n        if (!images || images.length === 0) {\n            console.warn(`[图鉴] 虞汐颜的 ${soul} 正面图片池为空`);\n            return { url: DEFAULT_PLACEHOLDER, soulName: soul };\n        }\n        const randomIndex = Math.floor(Math.random() * images.length);\n        console.info(`[图鉴] 虞汐颜正面选择: ${soul}`);\n        return { url: images[randomIndex], soulName: soul };\n    } else {\n        // 背面：使用另一个魂体\n        // 如果 cachedDualSoul 为 null，说明出现了异常调用顺序\n        if (!cachedDualSoul) {\n            console.error(`[图鉴] 错误：虞汐颜背面图片获取时，正面魂体未缓存`);\n            return { url: DEFAULT_PLACEHOLDER, soulName: '虞汐颜' };\n        }\n        \n        const soul = cachedDualSoul === '虞汐' ? '虞颜' : '虞汐';\n        const images = pool[`${soul}_back`];\n        if (!images || images.length === 0) {\n            console.warn(`[图鉴] 虞汐颜的 ${soul} 背面图片池为空`);\n            return { url: DEFAULT_PLACEHOLDER, soulName: soul };\n        }\n        const randomIndex = Math.floor(Math.random() * images.length);\n        console.info(`[图鉴] 虞汐颜背面选择: ${soul}`);\n        return { url: images[randomIndex], soulName: soul };\n    }\n}\n\n/**\n * 标准化表情配置（将简写形式转换为完整形式）\n * 对于虞汐颜，还会返回对应的魂体名字\n *\n * 如果虞汐颜已经生成过卡片，则返回 null\n */\nfunction normalizeExpressionImages(config: ExpressionImages | string, characterName: string): (ExpressionImages & { frontName?: string; backName?: string }) | null {\n    if (typeof config === 'string') {\n        return { front: config, back: config };\n    }\n\n    // 处理虞汐颜的特殊逻辑\n    if (characterName === '虞汐颜') {\n        if (config.front === 'random_dual_front') {\n            const frontResult = getDualSoulImage('front');\n\n            // 如果返回 null，说明已经生成过了\n            if (frontResult === null) {\n                return null;\n            }\n\n            const backResult = getDualSoulImage('back');\n            if (backResult === null) {\n                return null;\n            }\n\n            return {\n                front: frontResult.url,\n                back: backResult.url,\n                frontName: frontResult.soulName,\n                backName: backResult.soulName\n            };\n        }\n    }\n\n    // 处理普通随机图片\n    let front = config.front;\n    let back = config.back ?? config.front;\n\n    if (front === 'random_front') {\n        front = getRandomImage(characterName, 'front');\n    }\n    if (back === 'random_back') {\n        back = getRandomImage(characterName, 'back');\n    }\n\n    return { front, back };\n}\n\n\n/**\n * 获取角色正面图片URL\n * @param characterName 角色名\n * @param imgCode 表情代号\n * @returns 正面图片URL\n */\nexport function getCharacterImage(characterName: string, imgCode: string): string {\n    const character = CHARACTER_ASSETS[characterName];\n    if (!character) {\n        console.warn(`[图鉴] 未找到角色 \"${characterName}\" 的图片配置，使用占位图`);\n        return DEFAULT_PLACEHOLDER;\n    }\n\n    const config = character[imgCode] ?? character[DEFAULT_EXPRESSION];\n    if (!config) {\n        console.warn(`[图鉴] 角色 \"${characterName}\" 没有表情 \"${imgCode}\" 的图片，使用占位图`);\n        return DEFAULT_PLACEHOLDER;\n    }\n\n    const normalized = normalizeExpressionImages(config, characterName);\n    if (!normalized) {\n        console.warn(`[图鉴] 角色 \"${characterName}\" 图片标准化失败，使用占位图`);\n        return DEFAULT_PLACEHOLDER;\n    }\n    return normalized.front;\n}\n\n/**\n * 获取角色背面图片URL\n * @param characterName 角色名\n * @param imgCode 表情代号\n * @returns 背面图片URL\n */\nexport function getCharacterBackImage(characterName: string, imgCode: string): string {\n    const character = CHARACTER_ASSETS[characterName];\n    if (!character) {\n        console.warn(`[图鉴] 未找到角色 \"${characterName}\" 的图片配置，使用占位图`);\n        return DEFAULT_PLACEHOLDER;\n    }\n\n    const config = character[imgCode] ?? character[DEFAULT_EXPRESSION];\n    if (!config) {\n        console.warn(`[图鉴] 角色 \"${characterName}\" 没有表情 \"${imgCode}\" 的图片，使用占位图`);\n        return DEFAULT_PLACEHOLDER;\n    }\n\n    const normalized = normalizeExpressionImages(config, characterName);\n    if (!normalized || !normalized.back) {\n        console.warn(`[图鉴] 角色 \"${characterName}\" 背面图片标准化失败，使用占位图`);\n        return DEFAULT_PLACEHOLDER;\n    }\n    return normalized.back;\n}\n\n/**\n * 获取角色正面和背面图片URL\n * 对于虞汐颜，会返回对应的魂体名字\n *\n * 重要：每次页面加载时，虞汐颜只会生成一张卡片\n * @param characterName 角色名\n * @param imgCode 正面表情代号\n * @param backImgCode 背面表情代号（可选，默认与正面相同）\n * @returns { front: 正面URL, back: 背面URL, frontName?: 正面名字, backName?: 背面名字 } 或 null（如果虞汐颜已生成）\n */\nexport function getCharacterImages(\n    characterName: string,\n    imgCode: string,\n    backImgCode?: string,\n): { front: string; back: string; frontName?: string; backName?: string } | null {\n    const character = CHARACTER_ASSETS[characterName];\n    if (!character) {\n        console.warn(`[图鉴] 未找到角色 \"${characterName}\" 的图片配置，使用占位图`);\n        return { front: DEFAULT_PLACEHOLDER, back: DEFAULT_PLACEHOLDER };\n    }\n\n    const frontConfig = character[imgCode] ?? character[DEFAULT_EXPRESSION];\n    if (!frontConfig) {\n        console.warn(`[图鉴] 角色 \"${characterName}\" 没有表情 \"${imgCode}\" 的图片，使用占位图`);\n        return { front: DEFAULT_PLACEHOLDER, back: DEFAULT_PLACEHOLDER };\n    }\n\n    const frontNormalized = normalizeExpressionImages(frontConfig, characterName);\n\n    // 如果返回 null（虞汐颜已生成），则返回 null\n    if (frontNormalized === null) {\n        return null;\n    }\n\n    // 如果指定了 backImgCode，则单独获取背面图片\n    let backUrl = frontNormalized.back;\n    if (backImgCode && backImgCode !== imgCode) {\n        const backConfig = character[backImgCode] ?? character[DEFAULT_EXPRESSION];\n        if (backConfig) {\n            const backNormalized = normalizeExpressionImages(backConfig, characterName);\n            if (backNormalized && backNormalized.back) {\n                backUrl = backNormalized.back;\n            }\n        } else {\n            console.warn(`[图鉴] 角色 \"${characterName}\" 没有背面表情 \"${backImgCode}\"，使用正面背面`);\n        }\n    }\n\n    if (!backUrl) {\n        console.warn(`[图鉴] 角色 \"${characterName}\" 背面图片缺失，使用正面图片`);\n        backUrl = frontNormalized.front;\n    }\n\n    return {\n        front: frontNormalized.front,\n        back: backUrl,\n        frontName: frontNormalized.frontName,\n        backName: frontNormalized.backName\n    };\n}\n\n/**\n * 重置虞汐颜的会话缓存\n * 在新的消息楼层或页面重新加载时调用\n */\nexport function resetDualSoulSession() {\n    dualSoulSessionUsed = false;\n    cachedDualSoul = null;\n    console.info('[图鉴] 虞汐颜会话缓存已重置');\n}\n\n/**\n * 获取角色所有可用的表情列表\n * @param characterName 角色名\n * @returns 表情代号列表\n */\nexport function getAvailableExpressions(characterName: string): string[] {\n    const character = CHARACTER_ASSETS[characterName];\n    return character ? Object.keys(character) : [];\n}\n\n/**\n * 检查角色是否已配置\n * @param characterName 角色名\n * @returns 是否已配置\n */\nexport function isCharacterConfigured(characterName: string): boolean {\n    return characterName in CHARACTER_ASSETS;\n}","// ============================================================================\r\n// 踏月寻仙 - 主题配置系统 (Theme Configuration System)\r\n// 版本: 1.0\r\n// ============================================================================\r\n\r\n/**\r\n * 主题配置接口\r\n */\r\nexport interface Theme {\r\n    id: string;\r\n    name: string;\r\n    description: string;\r\n    colors: {\r\n        // 主要背景色\r\n        bgPrimary: string;\r\n        bgSecondary: string;\r\n        // 边框颜色\r\n        border: string;\r\n        borderActive: string;\r\n        // 文字颜色\r\n        textPrimary: string;\r\n        textSecondary: string;\r\n        textAccent: string;\r\n        // 强调色\r\n        accent: string;\r\n        accentGlow: string;\r\n        // 按钮颜色\r\n        buttonBg: string;\r\n        buttonHover: string;\r\n        buttonActive: string;\r\n        // 进度条颜色\r\n        progressBg: string;\r\n        // 头部颜色\r\n        headerBg: string;\r\n        // 标签颜色\r\n        tabBg: string;\r\n        tabActive: string;\r\n        // 底部颜色\r\n        footerBg: string;\r\n    };\r\n    patterns: {\r\n        // 背景图案 (CSS background-image)\r\n        overlay?: string;\r\n        // 装饰图案类名\r\n        decoration?: string;\r\n    };\r\n}\r\n\r\n/**\r\n * CSS 图案生成器\r\n */\r\nexport const patterns = {\r\n    // 祥云图片 - 用于主要装饰\r\n    cloudImage: `url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png)`,\r\n\r\n    // 祥云图案（多层叠加）- 用于丰富背景层次\r\n    cloudsMulti: `\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png),\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png),\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png),\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png),\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png)\r\n  `,\r\n\r\n    // 祥云 + 星辰组合\r\n    cloudsWithStars: `\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png),\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png),\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png),\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png),\r\n    url(https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/古风祥云云朵85.png),\r\n    radial-gradient(circle at 25% 20%, rgba(255, 255, 255, 0.15) 1px, transparent 1px),\r\n    radial-gradient(circle at 75% 35%, rgba(255, 255, 255, 0.12) 1.5px, transparent 1.5px),\r\n    radial-gradient(circle at 35% 75%, rgba(255, 255, 255, 0.1) 1px, transparent 1px)\r\n  `,\r\n\r\n    // 星辰图案\r\n    stars: `\r\n    radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.3) 1px, transparent 1px),\r\n    radial-gradient(circle at 80% 60%, rgba(255, 255, 255, 0.25) 1.5px, transparent 1.5px),\r\n    radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.2) 1px, transparent 1px),\r\n    radial-gradient(circle at 60% 20%, rgba(255, 255, 255, 0.15) 2px, transparent 2px)\r\n  `,\r\n\r\n    // 纹理图案\r\n    texture: `\r\n    repeating-linear-gradient(\r\n      45deg,\r\n      transparent,\r\n      transparent 10px,\r\n      rgba(255, 255, 255, 0.03) 10px,\r\n      rgba(255, 255, 255, 0.03) 20px\r\n    )\r\n  `,\r\n\r\n    // 山水图案\r\n    landscape: `\r\n    linear-gradient(180deg,\r\n      transparent 0%,\r\n      rgba(255, 255, 255, 0.02) 30%,\r\n      rgba(255, 255, 255, 0.05) 50%,\r\n      rgba(255, 255, 255, 0.02) 70%,\r\n      transparent 100%\r\n    )\r\n  `,\r\n\r\n    // 莲花图案\r\n    lotus: `\r\n    radial-gradient(ellipse 120px 80px at 50% 50%, rgba(255, 255, 255, 0.08) 0%, transparent 50%)\r\n  `,\r\n};\r\n\r\n/**\r\n * 预设主题列表\r\n */\r\nexport const themes: Theme[] = [\r\n    // 默认主题 - 玄青\r\n    {\r\n        id: 'default',\r\n        name: '玄青仙境',\r\n        description: '深邃玄青，如夜空星辰',\r\n        colors: {\r\n            bgPrimary: 'linear-gradient(180deg, rgba(49, 66, 117, 0.95) 0%, rgba(15, 20, 35, 0.98) 100%)',\r\n            bgSecondary: 'rgba(30, 40, 60, 0.5)',\r\n            border: 'rgba(100, 150, 200, 0.3)',\r\n            borderActive: 'rgba(100, 150, 200, 0.6)',\r\n            textPrimary: '#e0e8f0',\r\n            textSecondary: '#8090a0',\r\n            textAccent: '#a0b8d0',\r\n            accent: '#88aacc',\r\n            accentGlow: 'rgba(100, 150, 255, 0.3)',\r\n            buttonBg: 'rgba(100, 150, 200, 0.2)',\r\n            buttonHover: 'rgba(100, 150, 200, 0.3)',\r\n            buttonActive: 'linear-gradient(135deg, rgba(80, 120, 180, 0.3) 0%, rgba(100, 80, 160, 0.3) 100%)',\r\n            progressBg: 'rgba(50, 60, 80, 0.8)',\r\n            headerBg: 'linear-gradient(90deg, rgba(60, 80, 120, 0.4) 0%, rgba(80, 60, 100, 0.4) 100%)',\r\n            tabBg: 'rgba(30, 40, 60, 0.5)',\r\n            tabActive: 'linear-gradient(135deg, rgba(80, 120, 180, 0.3) 0%, rgba(100, 80, 160, 0.3) 100%)',\r\n            footerBg: 'rgba(20, 30, 45, 0.8)',\r\n        },\r\n        patterns: {\r\n            overlay: patterns.cloudsWithStars,\r\n        },\r\n    },\r\n\r\n    // 紫霞主题\r\n    {\r\n        id: 'purple',\r\n        name: '紫霞仙踪',\r\n        description: '紫气东来，霞光万道',\r\n        colors: {\r\n            bgPrimary: 'linear-gradient(180deg, rgba(80, 40, 100, 0.95) 0%, rgba(30, 15, 40, 0.98) 100%)',\r\n            bgSecondary: 'rgba(50, 30, 70, 0.5)',\r\n            border: 'rgba(150, 100, 200, 0.3)',\r\n            borderActive: 'rgba(180, 120, 220, 0.6)',\r\n            textPrimary: '#f0e0f8',\r\n            textSecondary: '#a080b0',\r\n            textAccent: '#c0a0d0',\r\n            accent: '#aa88cc',\r\n            accentGlow: 'rgba(150, 100, 255, 0.4)',\r\n            buttonBg: 'rgba(150, 100, 200, 0.2)',\r\n            buttonHover: 'rgba(150, 100, 200, 0.3)',\r\n            buttonActive: 'linear-gradient(135deg, rgba(120, 80, 160, 0.3) 0%, rgba(140, 60, 180, 0.3) 100%)',\r\n            progressBg: 'rgba(60, 40, 80, 0.8)',\r\n            headerBg: 'linear-gradient(90deg, rgba(80, 50, 100, 0.4) 0%, rgba(100, 40, 120, 0.4) 100%)',\r\n            tabBg: 'rgba(50, 30, 70, 0.5)',\r\n            tabActive: 'linear-gradient(135deg, rgba(120, 80, 160, 0.3) 0%, rgba(140, 60, 180, 0.3) 100%)',\r\n            footerBg: 'rgba(30, 20, 50, 0.8)',\r\n        },\r\n        patterns: {\r\n            overlay: patterns.cloudsMulti,\r\n        },\r\n    },\r\n\r\n    // 赤炎主题\r\n    {\r\n        id: 'red',\r\n        name: '赤炎烈焰',\r\n        description: '烈火焚天，赤炎千里',\r\n        colors: {\r\n            bgPrimary: 'linear-gradient(180deg, rgba(100, 40, 40, 0.95) 0%, rgba(40, 15, 15, 0.98) 100%)',\r\n            bgSecondary: 'rgba(70, 30, 30, 0.5)',\r\n            border: 'rgba(200, 100, 100, 0.3)',\r\n            borderActive: 'rgba(220, 120, 120, 0.6)',\r\n            textPrimary: '#f8e0e0',\r\n            textSecondary: '#b08080',\r\n            textAccent: '#d0a0a0',\r\n            accent: '#cc8888',\r\n            accentGlow: 'rgba(255, 100, 100, 0.4)',\r\n            buttonBg: 'rgba(200, 100, 100, 0.2)',\r\n            buttonHover: 'rgba(200, 100, 100, 0.3)',\r\n            buttonActive: 'linear-gradient(135deg, rgba(160, 80, 80, 0.3) 0%, rgba(180, 60, 60, 0.3) 100%)',\r\n            progressBg: 'rgba(80, 40, 40, 0.8)',\r\n            headerBg: 'linear-gradient(90deg, rgba(100, 50, 50, 0.4) 0%, rgba(120, 40, 40, 0.4) 100%)',\r\n            tabBg: 'rgba(70, 30, 30, 0.5)',\r\n            tabActive: 'linear-gradient(135deg, rgba(160, 80, 80, 0.3) 0%, rgba(180, 60, 60, 0.3) 100%)',\r\n            footerBg: 'rgba(50, 20, 20, 0.8)',\r\n        },\r\n        patterns: {\r\n            overlay: patterns.cloudsMulti,\r\n        },\r\n    },\r\n\r\n    // 碧海主题\r\n    {\r\n        id: 'cyan',\r\n        name: '碧海青天',\r\n        description: '碧波荡漾，海天一色',\r\n        colors: {\r\n            bgPrimary: 'linear-gradient(180deg, rgba(40, 80, 100, 0.95) 0%, rgba(15, 30, 40, 0.98) 100%)',\r\n            bgSecondary: 'rgba(30, 60, 70, 0.5)',\r\n            border: 'rgba(100, 180, 200, 0.3)',\r\n            borderActive: 'rgba(120, 200, 220, 0.6)',\r\n            textPrimary: '#e0f0f8',\r\n            textSecondary: '#80a0b0',\r\n            textAccent: '#a0c0d0',\r\n            accent: '#88ccdd',\r\n            accentGlow: 'rgba(100, 200, 255, 0.4)',\r\n            buttonBg: 'rgba(100, 180, 200, 0.2)',\r\n            buttonHover: 'rgba(100, 180, 200, 0.3)',\r\n            buttonActive: 'linear-gradient(135deg, rgba(80, 140, 160, 0.3) 0%, rgba(60, 160, 180, 0.3) 100%)',\r\n            progressBg: 'rgba(40, 60, 80, 0.8)',\r\n            headerBg: 'linear-gradient(90deg, rgba(50, 80, 100, 0.4) 0%, rgba(40, 100, 120, 0.4) 100%)',\r\n            tabBg: 'rgba(30, 60, 70, 0.5)',\r\n            tabActive: 'linear-gradient(135deg, rgba(80, 140, 160, 0.3) 0%, rgba(60, 160, 180, 0.3) 100%)',\r\n            footerBg: 'rgba(20, 40, 50, 0.8)',\r\n        },\r\n        patterns: {\r\n            overlay: patterns.cloudsWithStars,\r\n        },\r\n    },\r\n\r\n    // 金辉主题\r\n    {\r\n        id: 'gold',\r\n        name: '金辉灿烂',\r\n        description: '金光璀璨，辉映九天',\r\n        colors: {\r\n            bgPrimary: 'linear-gradient(180deg, rgba(80, 70, 40, 0.95) 0%, rgba(30, 25, 15, 0.98) 100%)',\r\n            bgSecondary: 'rgba(60, 50, 30, 0.5)',\r\n            border: 'rgba(200, 180, 100, 0.3)',\r\n            borderActive: 'rgba(220, 200, 120, 0.6)',\r\n            textPrimary: '#f8f0e0',\r\n            textSecondary: '#b0a080',\r\n            textAccent: '#d0c0a0',\r\n            accent: '#ccaa88',\r\n            accentGlow: 'rgba(255, 200, 100, 0.4)',\r\n            buttonBg: 'rgba(200, 180, 100, 0.2)',\r\n            buttonHover: 'rgba(200, 180, 100, 0.3)',\r\n            buttonActive: 'linear-gradient(135deg, rgba(160, 140, 80, 0.3) 0%, rgba(180, 160, 60, 0.3) 100%)',\r\n            progressBg: 'rgba(60, 50, 40, 0.8)',\r\n            headerBg: 'linear-gradient(90deg, rgba(80, 70, 50, 0.4) 0%, rgba(100, 80, 40, 0.4) 100%)',\r\n            tabBg: 'rgba(60, 50, 30, 0.5)',\r\n            tabActive: 'linear-gradient(135deg, rgba(160, 140, 80, 0.3) 0%, rgba(180, 160, 60, 0.3) 100%)',\r\n            footerBg: 'rgba(40, 35, 20, 0.8)',\r\n        },\r\n        patterns: {\r\n            overlay: patterns.cloudsMulti,\r\n        },\r\n    },\r\n\r\n    // 翠竹主题\r\n    {\r\n        id: 'green',\r\n        name: '翠竹清风',\r\n        description: '竹影婆娑，清风徐来',\r\n        colors: {\r\n            bgPrimary: 'linear-gradient(180deg, rgba(40, 80, 60, 0.95) 0%, rgba(15, 30, 25, 0.98) 100%)',\r\n            bgSecondary: 'rgba(30, 60, 50, 0.5)',\r\n            border: 'rgba(100, 180, 150, 0.3)',\r\n            borderActive: 'rgba(120, 200, 170, 0.6)',\r\n            textPrimary: '#e0f8f0',\r\n            textSecondary: '#80b0a0',\r\n            textAccent: '#a0d0c0',\r\n            accent: '#88ccaa',\r\n            accentGlow: 'rgba(100, 255, 200, 0.4)',\r\n            buttonBg: 'rgba(100, 180, 150, 0.2)',\r\n            buttonHover: 'rgba(100, 180, 150, 0.3)',\r\n            buttonActive: 'linear-gradient(135deg, rgba(80, 140, 120, 0.3) 0%, rgba(60, 160, 140, 0.3) 100%)',\r\n            progressBg: 'rgba(40, 60, 50, 0.8)',\r\n            headerBg: 'linear-gradient(90deg, rgba(50, 80, 70, 0.4) 0%, rgba(40, 100, 80, 0.4) 100%)',\r\n            tabBg: 'rgba(30, 60, 50, 0.5)',\r\n            tabActive: 'linear-gradient(135deg, rgba(80, 140, 120, 0.3) 0%, rgba(60, 160, 140, 0.3) 100%)',\r\n            footerBg: 'rgba(20, 40, 35, 0.8)',\r\n        },\r\n        patterns: {\r\n            overlay: patterns.cloudsMulti,\r\n        },\r\n    },\r\n];\r\n\r\n/**\r\n * 根据ID获取主题\r\n */\r\nexport function getThemeById(id: string): Theme | undefined {\r\n    return themes.find(t => t.id === id);\r\n}\r\n\r\n/**\r\n * 获取默认主题\r\n */\r\nexport function getDefaultTheme(): Theme {\r\n    return themes.find(t => t.id === 'red') || themes[0];\r\n}","import _ from 'lodash';\nimport { getCharacterImages, resetDualSoulSession } from './character-assets';\nimport { Schema } from './schema';\nimport { getDefaultTheme, getThemeById, themes } from './themes';\n/**\n * 从消息内容中解析 <visual_cards> 标签\n * @param content 消息内容\n * @returns 解析出的视觉卡片数组\n */\nfunction parseVisualCards(content) {\n    try {\n        // 匹配 <visual_cards>...</visual_cards> 标签\n        const match = content.match(/<visual_cards>\\s*([\\s\\S]*?)\\s*<\\/visual_cards>/);\n        if (!match) {\n            return [];\n        }\n        const jsonStr = match[1].trim();\n        if (!jsonStr) {\n            return [];\n        }\n        // 解析 JSON 数组\n        const cards = JSON.parse(jsonStr);\n        // 验证数据结构\n        if (!Array.isArray(cards)) {\n            console.warn('[图鉴] visual_cards 不是数组');\n            return [];\n        }\n        return cards.filter(card => card.name &&\n            card.img_code &&\n            typeof card.back_text === 'string');\n    }\n    catch (e) {\n        console.error('[图鉴] 解析 visual_cards 失败', e);\n        return [];\n    }\n}\n/**\n * 将 AI 输出的视觉卡片转换为图鉴卡片\n * @param visualCards AI 输出的视觉卡片\n * @returns 图鉴卡片数组\n */\nfunction convertToGalleryCards(visualCards) {\n    // 重置虞汐颜会话缓存\n    resetDualSoulSession();\n    const result = [];\n    for (const card of visualCards) {\n        // 使用新的 getCharacterImages 函数获取正面和背面图片\n        const images = getCharacterImages(card.name, card.img_code, card.back_img_code);\n        // 如果返回 null（虞汐颜重复），则跳过\n        if (images === null) {\n            console.info(`[图鉴] 跳过重复的 ${card.name} 卡片`);\n            continue;\n        }\n        result.push({\n            name: card.name,\n            front: images.front,\n            back: images.back,\n            backText: card.back_text || '',\n            isFlipped: false,\n            frontName: images.frontName,\n            backName: images.backName,\n        });\n    }\n    return result;\n}\nexport const useDataStore = defineStore('data', errorCatched(() => {\n    const message_id = getCurrentMessageId();\n    // 从 MVU 变量中获取 stat_data\n    const rawData = ref(null);\n    // 图鉴卡片数据\n    const galleryCards = ref([]);\n    // 卡片缓存 - 避免重复解析\n    const cardCache = new Map();\n    // 初始化数据（带重试机制）\n    const initData = (retryCount = 0) => {\n        try {\n            const variables = getVariables({ type: 'message', message_id });\n            const statData = _.get(variables, 'stat_data', null);\n            if (statData && Object.keys(statData).length > 0) {\n                // 使用 Schema.parse 来解析和验证数据\n                // 🔧 修复：强制深拷贝，确保 Vue 能检测到嵌套对象变化\n                rawData.value = _.cloneDeep(Schema.parse(statData));\n            }\n            else if (statData === null || statData === undefined) {\n                // stat_data 为 null 或 undefined，使用空对象初始化以触发所有默认值\n                const defaultData = Schema.parse({});\n                rawData.value = defaultData;\n                console.info('[踏月寻仙] 使用默认值初始化变量数据', {\n                    等级: defaultData.本尊.等级,\n                    灵根: defaultData.本尊.灵根,\n                    体质: defaultData.本尊.体质,\n                    功法: defaultData.本尊.功法,\n                });\n                toastr.info('当前楼层无数据，已使用默认值初始化', '踏月寻仙');\n                // 解析当前楼层消息中的 visual_cards\n                parseCurrentMessageCards();\n                return; // 直接返回，不再重试\n            }\n            console.info('[踏月寻仙] 成功加载变量数据', {\n                等级: rawData.value?.本尊.等级,\n                灵根: rawData.value?.本尊.灵根,\n                体质: rawData.value?.本尊.体质,\n                功法: rawData.value?.本尊.功法,\n            });\n            // 解析当前楼层消息中的 visual_cards\n            parseCurrentMessageCards();\n        }\n        catch (e) {\n            // Schema.parse 失败或其他错误\n            console.error('[踏月寻仙] 初始化数据失败', e);\n            if (retryCount < 5) {\n                // 数据还没准备好，重试（减少重试次数到5次，固定延迟200ms，总计最多等待1秒）\n                console.info(`[踏月寻仙] 数据未就绪，200ms后第${retryCount + 1}次重试`);\n                setTimeout(() => {\n                    initData(retryCount + 1);\n                }, 200); // 固定延迟200ms\n            }\n            else {\n                console.warn('[踏月寻仙] 重试次数已用完，尝试手动触发MVU解析');\n                // 尝试手动触发MVU解析当前消息\n                tryManualParseMvuMessage();\n            }\n        }\n    };\n    // 手动触发MVU解析当前消息（用于初始楼层）\n    const tryManualParseMvuMessage = async () => {\n        try {\n            // 检查MVU是否已初始化\n            await waitGlobalInitialized('Mvu');\n            // 获取当前消息内容\n            const messages = getChatMessages(message_id);\n            if (messages.length === 0) {\n                console.warn('[踏月寻仙] 无法获取当前消息内容');\n                fallbackToInheritOrDefault();\n                return;\n            }\n            const content = messages[0].message || '';\n            console.info('[踏月寻仙] 尝试手动触发MVU解析，消息长度:', content.length);\n            // 获取当前的MVU数据（可能为空）\n            const currentMvuData = Mvu.getMvuData({ type: 'message', message_id });\n            // 手动解析消息中的MVU指令\n            const newMvuData = await Mvu.parseMessage(content, currentMvuData);\n            // 将解析结果写回当前楼层\n            await Mvu.replaceMvuData(newMvuData, { type: 'message', message_id });\n            console.info('[踏月寻仙] MVU手动解析完成，重新加载数据');\n            // 延迟后重新加载数据\n            setTimeout(() => {\n                const variables = getVariables({ type: 'message', message_id });\n                const statData = _.get(variables, 'stat_data', null);\n                if (statData && Object.keys(statData).length > 0) {\n                    // 🔧 修复：强制深拷贝\n                    rawData.value = _.cloneDeep(Schema.parse(statData));\n                    console.info('[踏月寻仙] ✅ 手动解析后成功加载数据');\n                    toastr.success('已成功初始化状态数据', '踏月寻仙');\n                    parseCurrentMessageCards();\n                }\n                else {\n                    console.warn('[踏月寻仙] 手动解析后仍无数据，使用备用方案');\n                    fallbackToInheritOrDefault();\n                }\n            }, 500);\n        }\n        catch (e) {\n            console.error('[踏月寻仙] 手动触发MVU解析失败', e);\n            fallbackToInheritOrDefault();\n        }\n    };\n    // 备用方案：继承或使用默认值（仅用于显示，不保存）\n    const fallbackToInheritOrDefault = () => {\n        console.warn('[踏月寻仙] 启用备用方案');\n        // 尝试从上一楼层继承数据用于显示\n        const inheritedData = tryInheritFromPreviousFloor();\n        if (inheritedData) {\n            // 成功继承数据，仅用于显示，不保存到当前楼层\n            rawData.value = inheritedData;\n            console.info('[踏月寻仙] 从上一楼层继承数据用于显示（不保存）');\n            toastr.info('正在显示上一楼层的状态数据', '踏月寻仙');\n        }\n        else {\n            // 无法继承，使用默认值\n            console.warn('[踏月寻仙] 无法继承数据，使用默认值');\n            rawData.value = Schema.parse({});\n            toastr.info('使用默认状态数据', '踏月寻仙');\n        }\n        // 解析当前楼层消息中的 visual_cards\n        parseCurrentMessageCards();\n    };\n    // 尝试从上一楼层继承数据\n    const tryInheritFromPreviousFloor = () => {\n        try {\n            // 从当前楼层往前查找最近的有效数据\n            // 获取所有聊天消息（从第0楼到最后一楼）\n            const chatMessages = getChatMessages('0-{{lastMessageId}}');\n            const currentIndex = chatMessages.findIndex(msg => msg.message_id === message_id);\n            if (currentIndex === -1) {\n                console.warn('[踏月寻仙] 无法找到当前楼层索引');\n                return null;\n            }\n            // 从当前楼层往前遍历，查找最近的有效 stat_data\n            for (let i = currentIndex - 1; i >= 0; i--) {\n                const prevMessageId = chatMessages[i].message_id;\n                const prevVariables = getVariables({ type: 'message', message_id: prevMessageId });\n                const prevStatData = _.get(prevVariables, 'stat_data', null);\n                if (prevStatData) {\n                    // 找到有效数据，解析并返回\n                    // 🔧 修复：强制深拷贝\n                    const parsedData = _.cloneDeep(Schema.parse(prevStatData));\n                    console.info(`[踏月寻仙] 从第 ${prevMessageId} 楼继承数据`);\n                    return parsedData;\n                }\n            }\n            console.warn('[踏月寻仙] 前面的楼层都没有有效数据');\n            return null;\n        }\n        catch (e) {\n            console.error('[踏月寻仙] 继承数据时出错', e);\n            return null;\n        }\n    };\n    // 解析当前楼层消息中的 visual_cards\n    const parseCurrentMessageCards = () => {\n        try {\n            // 获取当前消息内容\n            const messages = getChatMessages(message_id);\n            if (messages.length > 0) {\n                const content = messages[0].message || '';\n                // 检查缓存\n                const cacheKey = `${message_id}_${content.length}`;\n                if (cardCache.has(cacheKey)) {\n                    galleryCards.value = cardCache.get(cacheKey);\n                    console.info('[图鉴] 使用缓存的角色卡片');\n                    return;\n                }\n                const visualCards = parseVisualCards(content);\n                if (visualCards.length > 0) {\n                    const cards = convertToGalleryCards(visualCards);\n                    galleryCards.value = cards;\n                    // 缓存结果\n                    cardCache.set(cacheKey, cards);\n                    // 预加载图片\n                    preloadImages(cards);\n                    console.info('[图鉴] 解析到角色卡片', cards.length, '张');\n                }\n                else {\n                    galleryCards.value = [];\n                }\n            }\n        }\n        catch (e) {\n            console.error('[图鉴] 解析消息卡片失败', e);\n            toastr.warning(`解析角色卡片失败: ${e instanceof Error ? e.message : '未知错误'}`, '图鉴');\n        }\n    };\n    // 预加载图片\n    const preloadImages = (cards) => {\n        cards.forEach(card => {\n            // 预加载正面图片\n            const frontImg = new Image();\n            frontImg.src = card.front;\n            // 预加载背面图片\n            const backImg = new Image();\n            backImg.src = card.back;\n        });\n        console.info('[图鉴] 开始预加载', cards.length * 2, '张图片');\n    };\n    // 翻转卡片\n    const toggleCardFlip = (index) => {\n        if (galleryCards.value[index]) {\n            galleryCards.value[index].isFlipped = !galleryCards.value[index].isFlipped;\n        }\n    };\n    // 等待MVU框架初始化后再加载数据\n    waitGlobalInitialized('Mvu').then(() => {\n        console.info('[踏月寻仙] MVU 框架已初始化，开始加载数据');\n        // 立即开始初始化，不再额外延迟\n        initData();\n    }).catch(() => {\n        console.warn('[踏月寻仙] MVU 框架未加载，直接初始化');\n        initData();\n    });\n    // 防抖定时器 - 避免短时间内重复加载\n    let updateDebounceTimer = null;\n    const debouncedInitData = (delay = 200) => {\n        if (updateDebounceTimer) {\n            clearTimeout(updateDebounceTimer);\n        }\n        updateDebounceTimer = setTimeout(() => {\n            initData();\n            updateDebounceTimer = null;\n        }, delay);\n    };\n    // 监听消息更新事件，实时刷新数据\n    eventOn(tavern_events.MESSAGE_UPDATED, (id) => {\n        if (id === message_id) {\n            console.info('[踏月寻仙] 检测到消息更新，防抖延迟200ms后重新加载');\n            debouncedInitData(200);\n        }\n    });\n    // 监听消息删除事件（重新roll时会触发）\n    eventOn(tavern_events.MESSAGE_DELETED, (id) => {\n        console.info('[踏月寻仙] 检测到消息删除（可能是重新roll），清空数据');\n        if (id === message_id) {\n            // 清空当前数据，等待新消息\n            rawData.value = null;\n            galleryCards.value = [];\n        }\n    });\n    // 监听消息接收事件（新消息生成完成）\n    eventOn(tavern_events.MESSAGE_RECEIVED, (id) => {\n        if (id === message_id) {\n            console.info('[踏月寻仙] 检测到新消息接收，防抖延迟300ms后重新加载');\n            debouncedInitData(300);\n        }\n    });\n    // 监听 MVU 变量更新事件 - 修复：只监听当前楼层的更新\n    waitGlobalInitialized('Mvu').then(() => {\n        console.info('[踏月寻仙] 开始监听 MVU 变量更新事件（仅当前楼层）');\n        // 监听 MVU 变量更新结束事件\n        // 🔧 修复：VARIABLE_UPDATE_ENDED 实际接收 3 个参数！\n        // 第1个参数: new_variables (新变量)\n        // 第2个参数: old_variables (旧变量)\n        // 第3个参数: variable_option (变量位置信息，包含 message_id)\n        eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, (new_variables, _old_variables, variable_option) => {\n            try {\n                // 🔧 关键修复：只处理当前楼层的更新事件\n                if (variable_option?.message_id !== message_id) {\n                    console.debug('[踏月寻仙] 忽略其他楼层的更新事件', {\n                        event_message_id: variable_option?.message_id,\n                        current_message_id: message_id\n                    });\n                    return;\n                }\n                const statData = _.get(new_variables, 'stat_data', null);\n                console.info('[踏月寻仙] MVU 变量更新事件触发（当前楼层）', {\n                    message_id,\n                    has_stat_data: statData !== null && Object.keys(statData).length > 0,\n                });\n                // 更新当前楼层的数据\n                if (statData && Object.keys(statData).length > 0) {\n                    try {\n                        // 使用 Schema.parse 确保数据结构正确，包括过滤掉数量为0的物品\n                        const parsedData = Schema.parse(statData);\n                        // 🔧 修复：强制深拷贝，确保 Vue 能检测到所有嵌套对象（如神通列表、背包）的变化\n                        // 因为 zod transform 中的 _.pickBy 可能会复用对象引用\n                        rawData.value = _.cloneDeep(parsedData);\n                        console.info('[踏月寻仙] ✅ MVU 变量已更新', {\n                            等级: parsedData.本尊.等级,\n                            灵根: parsedData.本尊.灵根,\n                            体质: parsedData.本尊.体质,\n                            功法: parsedData.本尊.功法,\n                            本命兵器: parsedData.本尊.本命兵器,\n                            神通数量: Object.keys(parsedData.本尊.神通列表).length,\n                            背包物品数: Object.keys(parsedData.本尊.背包).length,\n                            法宝数量: Object.keys(parsedData.本尊.法宝).length,\n                            灵石: parsedData.本尊.灵石\n                        });\n                        // 🔧 新增：实时更新图鉴卡片\n                        // 由于消息内容可能包含新的 visual_cards，需要重新解析\n                        parseCurrentMessageCards();\n                    }\n                    catch (parseError) {\n                        console.error('[踏月寻仙] Schema 解析失败', parseError);\n                        // 解析失败时也尝试更新，但记录警告\n                        rawData.value = statData;\n                    }\n                }\n                else {\n                    console.warn('[踏月寻仙] stat_data 为空，跳过更新');\n                }\n            }\n            catch (e) {\n                console.error('[踏月寻仙] 处理 MVU 变量更新失败', e);\n            }\n        });\n    }).catch(e => {\n        console.warn('[踏月寻仙] MVU 框架未加载，将仅显示静态数据', e);\n    });\n    // 计算属性：安全获取各部分数据\n    const 世界时钟 = computed(() => rawData.value?.世界时钟 ?? { 纪元: '末法时代', 年份: 1 });\n    const 世界地图 = computed(() => rawData.value?.世界地图 ?? {});\n    const 世界图志 = computed(() => rawData.value?.世界图志 ?? {});\n    const 本尊 = computed(() => rawData.value?.本尊 ?? Schema.parse({}).本尊);\n    const 红颜 = computed(() => rawData.value?.红颜 ?? {});\n    const NPC图鉴 = computed(() => rawData.value?.NPC图鉴 ?? {});\n    const 任务列表 = computed(() => rawData.value?.任务列表 ?? {});\n    const 声望系统 = computed(() => rawData.value?.声望系统 ?? {});\n    const 地点库 = computed(() => rawData.value?.地点库 ?? {});\n    // 是否有数据\n    const hasData = computed(() => rawData.value !== null);\n    // 是否有图鉴卡片\n    const hasGalleryCards = computed(() => galleryCards.value.length > 0);\n    return {\n        rawData,\n        世界时钟,\n        世界地图,\n        世界图志,\n        地点库,\n        本尊,\n        红颜,\n        NPC图鉴,\n        任务列表,\n        声望系统,\n        hasData,\n        refresh: initData,\n        // 图鉴相关\n        galleryCards,\n        hasGalleryCards,\n        toggleCardFlip,\n        parseCurrentMessageCards,\n    };\n}));\n// ============================================================================\n// 主题管理 Store (Theme Management Store)\n// ============================================================================\nexport const useThemeStore = defineStore('theme', () => {\n    // 从消息楼层变量中读取用户选择的主题ID\n    const currentThemeId = ref('default');\n    // 当前主题对象\n    const currentTheme = computed(() => {\n        return getThemeById(currentThemeId.value) || getDefaultTheme();\n    });\n    // 所有可用主题列表\n    const availableThemes = computed(() => themes);\n    // 初始化主题 - 从消息楼层变量读取\n    const initTheme = () => {\n        try {\n            const message_id = getCurrentMessageId();\n            const variables = getVariables({ type: 'message', message_id });\n            const savedThemeId = _.get(variables, 'ui_theme_id', 'red');\n            if (typeof savedThemeId === 'string' && getThemeById(savedThemeId)) {\n                currentThemeId.value = savedThemeId;\n                console.info('[主题] 加载已保存的主题:', savedThemeId);\n            }\n            else {\n                currentThemeId.value = 'red';\n                console.info('[主题] 使用默认主题');\n            }\n        }\n        catch (e) {\n            console.warn('[主题] 加载主题失败，使用默认主题', e);\n            currentThemeId.value = 'red';\n        }\n    };\n    // 切换主题\n    const setTheme = (themeId) => {\n        if (getThemeById(themeId)) {\n            currentThemeId.value = themeId;\n            // 保存到消息楼层变量\n            try {\n                const message_id = getCurrentMessageId();\n                updateVariablesWith(vars => {\n                    _.set(vars, 'ui_theme_id', themeId);\n                    return vars;\n                }, { type: 'message', message_id });\n                console.info('[主题] 主题已切换并保存:', themeId);\n                toastr.success(`已切换至「${currentTheme.value.name}」主题`, '踏月寻仙');\n            }\n            catch (e) {\n                console.error('[主题] 保存主题失败', e);\n                toastr.warning('主题切换成功，但保存失败', '踏月寻仙');\n            }\n        }\n        else {\n            console.warn('[主题] 无效的主题ID:', themeId);\n        }\n    };\n    // 初始化\n    initTheme();\n    return {\n        currentThemeId,\n        currentTheme,\n        availableThemes,\n        setTheme,\n    };\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, toDisplayString as _toDisplayString, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeStyle as _normalizeStyle, createTextVNode as _createTextVNode, renderList as _renderList, withModifiers as _withModifiers, Transition as _Transition, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = { class: \"header\" };\nconst _hoisted_2 = { class: \"header-left\" };\nconst _hoisted_3 = [\"title\"];\nconst _hoisted_4 = { class: \"location-hierarchy\" };\nconst _hoisted_5 = { class: \"location-parent\" };\nconst _hoisted_6 = { class: \"location-current\" };\nconst _hoisted_7 = { class: \"theme-selector-header\" };\nconst _hoisted_8 = { class: \"theme-list\" };\nconst _hoisted_9 = [\"onClick\"];\nconst _hoisted_10 = { class: \"theme-info\" };\nconst _hoisted_11 = { class: \"theme-name\" };\nconst _hoisted_12 = { class: \"theme-desc\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"fa-solid fa-check theme-check\"\n};\nconst _hoisted_14 = { class: \"tab-nav\" };\nconst _hoisted_15 = [\"onClick\"];\nconst _hoisted_16 = { class: \"content\" };\nconst _hoisted_17 = {\n    key: 0,\n    class: \"panel cultivation-panel\"\n};\nconst _hoisted_18 = { class: \"identity-section\" };\nconst _hoisted_19 = { class: \"identity-name\" };\nconst _hoisted_20 = { class: \"identity-info\" };\nconst _hoisted_21 = { class: \"realm-section\" };\nconst _hoisted_22 = { class: \"realm-status\" };\nconst _hoisted_23 = { class: \"progress-section\" };\nconst _hoisted_24 = { class: \"progress-label\" };\nconst _hoisted_25 = { class: \"progress-bar\" };\nconst _hoisted_26 = { class: \"progress-percent\" };\nconst _hoisted_27 = { class: \"stats-grid\" };\nconst _hoisted_28 = { class: \"stat-item\" };\nconst _hoisted_29 = { class: \"stat-item\" };\nconst _hoisted_30 = { class: \"stat-value\" };\nconst _hoisted_31 = { class: \"stat-item\" };\nconst _hoisted_32 = { class: \"stat-value\" };\nconst _hoisted_33 = { class: \"stat-item\" };\nconst _hoisted_34 = { class: \"stat-value\" };\nconst _hoisted_35 = { class: \"stat-item\" };\nconst _hoisted_36 = { class: \"stat-value gold\" };\nconst _hoisted_37 = { class: \"stat-item\" };\nconst _hoisted_38 = { class: \"stat-value\" };\nconst _hoisted_39 = { class: \"panel skills-panel\" };\nconst _hoisted_40 = { class: \"skills-list\" };\nconst _hoisted_41 = {\n    key: 0,\n    class: \"skill-item\"\n};\nconst _hoisted_42 = { class: \"skill-header\" };\nconst _hoisted_43 = { class: \"skill-name\" };\nconst _hoisted_44 = { class: \"skill-rank\" };\nconst _hoisted_45 = { class: \"skill-desc\" };\nconst _hoisted_46 = { class: \"skill-proficiency\" };\nconst _hoisted_47 = {\n    key: 0,\n    class: \"empty-hint\"\n};\nconst _hoisted_48 = { class: \"panel inventory-panel\" };\nconst _hoisted_49 = { class: \"inventory-section\" };\nconst _hoisted_50 = { class: \"items-grid\" };\nconst _hoisted_51 = {\n    key: 0,\n    class: \"item-card treasure\"\n};\nconst _hoisted_52 = { class: \"item-name\" };\nconst _hoisted_53 = { class: \"item-rank\" };\nconst _hoisted_54 = { class: \"item-desc\" };\nconst _hoisted_55 = {\n    key: 0,\n    class: \"empty-hint\"\n};\nconst _hoisted_56 = { class: \"inventory-section\" };\nconst _hoisted_57 = { class: \"items-grid\" };\nconst _hoisted_58 = {\n    key: 0,\n    class: \"item-card\"\n};\nconst _hoisted_59 = { class: \"item-header\" };\nconst _hoisted_60 = { class: \"item-name\" };\nconst _hoisted_61 = { class: \"item-count\" };\nconst _hoisted_62 = { class: \"item-rank\" };\nconst _hoisted_63 = { class: \"item-desc\" };\nconst _hoisted_64 = {\n    key: 0,\n    class: \"empty-hint\"\n};\nconst _hoisted_65 = { class: \"panel companions-panel\" };\nconst _hoisted_66 = { class: \"companions-list\" };\nconst _hoisted_67 = { class: \"companion-header\" };\nconst _hoisted_68 = { class: \"companion-name\" };\nconst _hoisted_69 = { class: \"companion-relation\" };\nconst _hoisted_70 = { class: \"relation-value\" };\nconst _hoisted_71 = { class: \"companion-favor\" };\nconst _hoisted_72 = { class: \"favor-bar\" };\nconst _hoisted_73 = { class: \"favor-value\" };\nconst _hoisted_74 = {\n    key: 0,\n    class: \"empty-hint\"\n};\nconst _hoisted_75 = { class: \"panel map-panel\" };\nconst _hoisted_76 = { class: \"current-location\" };\nconst _hoisted_77 = { class: \"location-name\" };\nconst _hoisted_78 = { class: \"location-layer\" };\nconst _hoisted_79 = { class: \"location-desc\" };\nconst _hoisted_80 = { class: \"connections\" };\nconst _hoisted_81 = { class: \"connections-list\" };\nconst _hoisted_82 = {\n    key: 0,\n    class: \"empty-hint\",\n    style: { \"padding\": \"10px\" }\n};\nconst _hoisted_83 = { class: \"tasks-section\" };\nconst _hoisted_84 = { class: \"tasks-list\" };\nconst _hoisted_85 = { class: \"task-header\" };\nconst _hoisted_86 = { class: \"task-name\" };\nconst _hoisted_87 = { class: \"task-target\" };\nconst _hoisted_88 = { class: \"task-status\" };\nconst _hoisted_89 = {\n    key: 0,\n    class: \"empty-hint\"\n};\nconst _hoisted_90 = { class: \"reputation-section\" };\nconst _hoisted_91 = { class: \"reputation-list\" };\nconst _hoisted_92 = {\n    key: 0,\n    class: \"reputation-item\"\n};\nconst _hoisted_93 = { class: \"reputation-faction\" };\nconst _hoisted_94 = { class: \"reputation-bar\" };\nconst _hoisted_95 = { class: \"reputation-info\" };\nconst _hoisted_96 = { class: \"reputation-value\" };\nconst _hoisted_97 = { class: \"reputation-relation\" };\nconst _hoisted_98 = {\n    key: 0,\n    class: \"empty-hint\"\n};\nconst _hoisted_99 = { class: \"panel gallery-panel\" };\nconst _hoisted_100 = {\n    key: 0,\n    class: \"gallery-container\"\n};\nconst _hoisted_101 = [\"onClick\"];\nconst _hoisted_102 = { class: \"card-inner\" };\nconst _hoisted_103 = { class: \"card-face card-front\" };\nconst _hoisted_104 = [\"src\", \"alt\"];\nconst _hoisted_105 = { class: \"card-name-bar\" };\nconst _hoisted_106 = { class: \"card-face card-back\" };\nconst _hoisted_107 = { class: \"back-content\" };\nconst _hoisted_108 = [\"src\", \"alt\"];\nconst _hoisted_109 = { class: \"back-info-panel\" };\nconst _hoisted_110 = { class: \"back-name\" };\nconst _hoisted_111 = { class: \"back-text\" };\nconst _hoisted_112 = {\n    key: 1,\n    class: \"empty-hint\"\n};\nconst _hoisted_113 = { class: \"footer\" };\nconst _hoisted_114 = { class: \"footer-item\" };\nconst _hoisted_115 = { class: \"footer-center world-time\" };\nconst _hoisted_116 = { class: \"footer-item\" };\nimport { getDangerColor, getRealmColor, getRootColor } from './schema';\nimport { useDataStore, useThemeStore } from './store';\n\nimport { computed, ref } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'app',\n    setup(__props) {\n        const store = useDataStore();\n        const themeStore = useThemeStore();\n        // 计算可通往的地点（健壮性优先，向后兼容）\n        const availableConnections = computed(() => {\n            // 优先使用 本尊.行踪.可用通道（向后兼容旧数据）\n            const manualConnections = store.本尊.行踪.可用通道;\n            if (manualConnections && manualConnections.length > 0) {\n                return manualConnections;\n            }\n            // 如果没有手动设置的通道，则从世界地图中查找\n            const currentRegion = store.本尊.行踪.当前区域;\n            if (!currentRegion || !store.世界地图) {\n                return [];\n            }\n            const mapData = store.世界地图[currentRegion];\n            return mapData?.connections || [];\n        });\n        // 标签页配置\n        const tabs = [\n            { id: 'cultivation', label: '修炼', icon: 'fa-solid fa-yin-yang' },\n            { id: 'skills', label: '神通', icon: 'fa-solid fa-hand-sparkles' },\n            { id: 'inventory', label: '储物', icon: 'fa-solid fa-box-open' },\n            { id: 'companions', label: '红颜', icon: 'fa-solid fa-heart' },\n            { id: 'map', label: '行踪', icon: 'fa-solid fa-map' },\n            { id: 'gallery', label: '图鉴', icon: 'fa-solid fa-images' },\n        ];\n        const activeTab = ref('gallery'); // 初始显示图鉴\n        const isCollapsed = ref(false);\n        const showThemeSelector = ref(false);\n        // 切换折叠状态\n        const toggleCollapse = () => {\n            isCollapsed.value = !isCollapsed.value;\n        };\n        // 切换主题选择器\n        const toggleThemeSelector = () => {\n            showThemeSelector.value = !showThemeSelector.value;\n        };\n        // 选择主题\n        const selectTheme = (themeId) => {\n            themeStore.setTheme(themeId);\n            showThemeSelector.value = false;\n        };\n        // 应用主题的CSS变量\n        const themeStyles = computed(() => {\n            const theme = themeStore.currentTheme;\n            return {\n                '--bg-primary': theme.colors.bgPrimary,\n                '--bg-secondary': theme.colors.bgSecondary,\n                '--border-color': theme.colors.border,\n                '--border-active': theme.colors.borderActive,\n                '--text-primary': theme.colors.textPrimary,\n                '--text-secondary': theme.colors.textSecondary,\n                '--text-accent': theme.colors.textAccent,\n                '--accent-color': theme.colors.accent,\n                '--accent-glow': theme.colors.accentGlow,\n                '--button-bg': theme.colors.buttonBg,\n                '--button-hover': theme.colors.buttonHover,\n                '--button-active': theme.colors.buttonActive,\n                '--progress-bg': theme.colors.progressBg,\n                '--header-bg': theme.colors.headerBg,\n                '--tab-bg': theme.colors.tabBg,\n                '--tab-active': theme.colors.tabActive,\n                '--footer-bg': theme.colors.footerBg,\n                '--pattern-overlay': theme.patterns.overlay || 'none',\n            };\n        });\n        // 计算属性\n        // 计算父级区域（上级地域）\n        const parentRegion = computed(() => {\n            const currentRegion = store.本尊.行踪.当前区域;\n            // 从地点库中查找当前区域的信息\n            const locationInfo = store.地点库?.[currentRegion];\n            // 如果在地点库中找到了，返回其所属的域\n            if (locationInfo?.域) {\n                return locationInfo.域;\n            }\n            // 如果没找到，从世界地图中查找\n            const mapData = store.世界地图?.[currentRegion];\n            if (mapData?.layer) {\n                // 直接返回 layer 字段，不做任何映射\n                return mapData.layer;\n            }\n            // 最后根据行踪中的所属层级判断\n            const layer = store.本尊.行踪.所属层级;\n            return layer || '';\n        });\n        const realmColor = computed(() => getRealmColor(store.本尊.等级));\n        const rootColor = computed(() => getRootColor(store.本尊.灵根));\n        const dangerColor = computed(() => getDangerColor(store.本尊.行踪.危险度 ?? 10));\n        const locationColor = computed(() => {\n            const layer = store.本尊.行踪.所属层级;\n            if (layer === '天层')\n                return '#88ddff';\n            if (layer === '下层')\n                return '#ff4444';\n            return '#44aa44';\n        });\n        // 获取区域颜色\n        const getRegionColor = (region) => {\n            const map = store.世界地图;\n            const info = map[region];\n            if (!info)\n                return '#888888';\n            return getDangerColor(info.danger);\n        };\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"cultivation-status\", { collapsed: _unref(isCollapsed) }]),\n                style: _normalizeStyle(_unref(themeStyles))\n            }, [\n                _createCommentVNode(\" 背景图案层 \"),\n                _cache[27] || (_cache[27] = _createElementVNode(\"div\", { class: \"pattern-overlay\" }, null, -1 /* CACHED */)),\n                _createCommentVNode(\" 仙鹤装饰 - 顶部中央 \"),\n                _cache[28] || (_cache[28] = _createElementVNode(\"div\", { class: \"crane-decoration\" }, [\n                    _createElementVNode(\"img\", {\n                        src: \"https://pub-4d14ab94aa29488b977bc5be9f2a06ef.r2.dev/picgo/仙鹤.png\",\n                        alt: \"仙鹤\"\n                    })\n                ], -1 /* CACHED */)),\n                _createCommentVNode(\" 顶部：折叠按钮 + 世界时钟与位置 \"),\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _createElementVNode(\"button\", {\n                            class: \"collapse-btn\",\n                            onClick: toggleCollapse,\n                            title: _unref(isCollapsed) ? '展开状态栏' : '收起状态栏'\n                        }, [\n                            _createElementVNode(\"i\", {\n                                class: _normalizeClass(_unref(isCollapsed) ? 'fa-solid fa-chevron-down' : 'fa-solid fa-chevron-up')\n                            }, null, 2 /* CLASS */)\n                        ], 8 /* PROPS */, _hoisted_3),\n                        _createElementVNode(\"button\", {\n                            class: \"theme-btn\",\n                            onClick: toggleThemeSelector,\n                            title: \"切换主题\"\n                        }, [...(_cache[3] || (_cache[3] = [\n                                _createElementVNode(\"i\", { class: \"fa-solid fa-palette\" }, null, -1 /* CACHED */)\n                            ]))])\n                    ]),\n                    _createElementVNode(\"div\", {\n                        class: \"location\",\n                        style: _normalizeStyle({ color: _unref(locationColor) })\n                    }, [\n                        _cache[5] || (_cache[5] = _createElementVNode(\"i\", { class: \"fa-solid fa-location-dot\" }, null, -1 /* CACHED */)),\n                        _createElementVNode(\"span\", _hoisted_4, [\n                            _createCommentVNode(\" 只在上级地域存在且与当前区域不同时才显示上级 \"),\n                            (_unref(parentRegion) && _unref(parentRegion) !== _unref(store).本尊.行踪.当前区域)\n                                ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                    _createElementVNode(\"span\", _hoisted_5, _toDisplayString(_unref(parentRegion)), 1 /* TEXT */),\n                                    _cache[4] || (_cache[4] = _createElementVNode(\"span\", { class: \"location-separator\" }, \"·\", -1 /* CACHED */))\n                                ], 64 /* STABLE_FRAGMENT */))\n                                : _createCommentVNode(\"v-if\", true),\n                            _createElementVNode(\"span\", _hoisted_6, _toDisplayString(_unref(store).本尊.行踪.当前区域), 1 /* TEXT */)\n                        ]),\n                        _createElementVNode(\"span\", {\n                            class: \"danger-badge\",\n                            style: _normalizeStyle({ backgroundColor: _unref(dangerColor) })\n                        }, \" 危险度 \" + _toDisplayString(_unref(store).本尊.行踪.危险度 ?? 10), 5 /* TEXT, STYLE */)\n                    ], 4 /* STYLE */)\n                ]),\n                _createCommentVNode(\" 主题选择器弹窗 \"),\n                _createVNode(_Transition, { name: \"theme-selector-fade\" }, {\n                    default: _withCtx(() => [\n                        (_unref(showThemeSelector))\n                            ? (_openBlock(), _createElementBlock(\"div\", {\n                                key: 0,\n                                class: \"theme-selector-overlay\",\n                                onClick: _cache[2] || (_cache[2] = ($event) => (showThemeSelector.value = false))\n                            }, [\n                                _createElementVNode(\"div\", {\n                                    class: \"theme-selector\",\n                                    onClick: _cache[1] || (_cache[1] = _withModifiers(() => { }, [\"stop\"]))\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_7, [\n                                        _cache[7] || (_cache[7] = _createElementVNode(\"h3\", null, [\n                                            _createElementVNode(\"i\", { class: \"fa-solid fa-palette\" }),\n                                            _createTextVNode(\" 选择主题\")\n                                        ], -1 /* CACHED */)),\n                                        _createElementVNode(\"button\", {\n                                            class: \"close-btn\",\n                                            onClick: _cache[0] || (_cache[0] = ($event) => (showThemeSelector.value = false))\n                                        }, [...(_cache[6] || (_cache[6] = [\n                                                _createElementVNode(\"i\", { class: \"fa-solid fa-times\" }, null, -1 /* CACHED */)\n                                            ]))])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_8, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(themeStore).availableThemes, (theme) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: theme.id,\n                                                class: _normalizeClass([\"theme-item\", { active: theme.id === _unref(themeStore).currentThemeId }]),\n                                                onClick: ($event) => (selectTheme(theme.id))\n                                            }, [\n                                                _createElementVNode(\"div\", {\n                                                    class: \"theme-preview\",\n                                                    style: _normalizeStyle({ background: theme.colors.bgPrimary })\n                                                }, [\n                                                    _createElementVNode(\"div\", {\n                                                        class: \"theme-preview-border\",\n                                                        style: _normalizeStyle({ borderColor: theme.colors.border })\n                                                    }, null, 4 /* STYLE */)\n                                                ], 4 /* STYLE */),\n                                                _createElementVNode(\"div\", _hoisted_10, [\n                                                    _createElementVNode(\"div\", _hoisted_11, _toDisplayString(theme.name), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_12, _toDisplayString(theme.description), 1 /* TEXT */)\n                                                ]),\n                                                (theme.id === _unref(themeStore).currentThemeId)\n                                                    ? (_openBlock(), _createElementBlock(\"i\", _hoisted_13))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ], 10 /* CLASS, PROPS */, _hoisted_9));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ])\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _: 1 /* STABLE */\n                }),\n                _createCommentVNode(\" 主体：标签页导航 \"),\n                _createElementVNode(\"div\", _hoisted_14, [\n                    (_openBlock(), _createElementBlock(_Fragment, null, _renderList(tabs, (tab) => {\n                        return _createElementVNode(\"button\", {\n                            key: tab.id,\n                            class: _normalizeClass(['tab-btn', { active: _unref(activeTab) === tab.id }]),\n                            onClick: ($event) => (activeTab.value = tab.id)\n                        }, [\n                            _createElementVNode(\"i\", {\n                                class: _normalizeClass(tab.icon)\n                            }, null, 2 /* CLASS */),\n                            _createTextVNode(\" \" + _toDisplayString(tab.label), 1 /* TEXT */)\n                        ], 10 /* CLASS, PROPS */, _hoisted_15);\n                    }), 64 /* STABLE_FRAGMENT */))\n                ]),\n                _createCommentVNode(\" 内容区域 \"),\n                _createElementVNode(\"div\", _hoisted_16, [\n                    _createCommentVNode(\" 修炼面板 \"),\n                    (_unref(activeTab) === 'cultivation')\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [\n                            _createElementVNode(\"div\", _hoisted_18, [\n                                _createElementVNode(\"div\", _hoisted_19, _toDisplayString(_unref(store).本尊.身份.姓名), 1 /* TEXT */),\n                                _createElementVNode(\"div\", _hoisted_20, [\n                                    _createElementVNode(\"span\", null, _toDisplayString(_unref(store).本尊.身份.宗门), 1 /* TEXT */),\n                                    _cache[8] || (_cache[8] = _createElementVNode(\"span\", { class: \"divider\" }, \"·\", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", null, _toDisplayString(_unref(store).本尊.身份.出身), 1 /* TEXT */)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_21, [\n                                _createElementVNode(\"div\", {\n                                    class: \"realm-title\",\n                                    style: _normalizeStyle({ color: _unref(realmColor) })\n                                }, [\n                                    _cache[9] || (_cache[9] = _createElementVNode(\"i\", { class: \"fa-solid fa-yin-yang\" }, null, -1 /* CACHED */)),\n                                    _createTextVNode(\" \" + _toDisplayString(_unref(store).本尊.境界描述), 1 /* TEXT */)\n                                ], 4 /* STYLE */),\n                                _createElementVNode(\"div\", _hoisted_22, _toDisplayString(_unref(store).本尊.状态), 1 /* TEXT */)\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_23, [\n                                _createElementVNode(\"div\", _hoisted_24, [\n                                    _cache[10] || (_cache[10] = _createElementVNode(\"span\", null, \"修为进度\", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", null, _toDisplayString(_unref(store).本尊.修为) + \" / \" + _toDisplayString(_unref(store).本尊.突破阈值), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_25, [\n                                    _createElementVNode(\"div\", {\n                                        class: \"progress-fill\",\n                                        style: _normalizeStyle({ width: _unref(store).本尊.进度, backgroundColor: _unref(realmColor) })\n                                    }, null, 4 /* STYLE */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_26, _toDisplayString(_unref(store).本尊.进度), 1 /* TEXT */)\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_27, [\n                                _createElementVNode(\"div\", _hoisted_28, [\n                                    _cache[11] || (_cache[11] = _createElementVNode(\"div\", { class: \"stat-label\" }, \"灵根\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", {\n                                        class: \"stat-value\",\n                                        style: _normalizeStyle({ color: _unref(rootColor) })\n                                    }, _toDisplayString(_unref(store).本尊.灵根), 5 /* TEXT, STYLE */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_29, [\n                                    _cache[12] || (_cache[12] = _createElementVNode(\"div\", { class: \"stat-label\" }, \"体质\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_30, _toDisplayString(_unref(store).本尊.体质), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_31, [\n                                    _cache[13] || (_cache[13] = _createElementVNode(\"div\", { class: \"stat-label\" }, \"功法\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_32, _toDisplayString(_unref(store).本尊.功法), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_33, [\n                                    _cache[14] || (_cache[14] = _createElementVNode(\"div\", { class: \"stat-label\" }, \"本命兵器\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_34, _toDisplayString(_unref(store).本尊.本命兵器), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_35, [\n                                    _cache[15] || (_cache[15] = _createElementVNode(\"div\", { class: \"stat-label\" }, \"灵石\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_36, _toDisplayString(_unref(store).本尊.灵石), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_37, [\n                                    _cache[16] || (_cache[16] = _createElementVNode(\"div\", { class: \"stat-label\" }, \"寿元\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_38, _toDisplayString(_unref(store).本尊.寿元状态), 1 /* TEXT */)\n                                ])\n                            ])\n                        ]))\n                        : (_unref(activeTab) === 'skills')\n                            ? (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                _createCommentVNode(\" 神通面板 \"),\n                                _createElementVNode(\"div\", _hoisted_39, [\n                                    _createElementVNode(\"div\", _hoisted_40, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(store).本尊.神通列表, (skill, key) => {\n                                            return (_openBlock(), _createElementBlock(_Fragment, { key: key }, [\n                                                (key && String(key).trim())\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_41, [\n                                                        _createElementVNode(\"div\", _hoisted_42, [\n                                                            _createElementVNode(\"div\", _hoisted_43, _toDisplayString(skill?.名称 || key), 1 /* TEXT */),\n                                                            _createElementVNode(\"div\", _hoisted_44, _toDisplayString(skill?.品阶 || '未知'), 1 /* TEXT */)\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_45, _toDisplayString(skill?.描述 || '暂无描述'), 1 /* TEXT */),\n                                                        _createElementVNode(\"div\", _hoisted_46, \"熟练度: \" + _toDisplayString(skill?.熟练度 || '入门'), 1 /* TEXT */)\n                                                    ]))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ], 64 /* STABLE_FRAGMENT */));\n                                        }), 128 /* KEYED_FRAGMENT */)),\n                                        (!_unref(store).本尊.神通列表 || Object.keys(_unref(store).本尊.神通列表).length === 0)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_47, \" 尚未领悟任何神通 \"))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ])\n                                ])\n                            ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                            : (_unref(activeTab) === 'inventory')\n                                ? (_openBlock(), _createElementBlock(_Fragment, { key: 2 }, [\n                                    _createCommentVNode(\" 储物面板 \"),\n                                    _createElementVNode(\"div\", _hoisted_48, [\n                                        _createElementVNode(\"div\", _hoisted_49, [\n                                            _cache[17] || (_cache[17] = _createElementVNode(\"div\", { class: \"section-title\" }, [\n                                                _createElementVNode(\"i\", { class: \"fa-solid fa-gem\" }),\n                                                _createTextVNode(\" 法宝 \")\n                                            ], -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", _hoisted_50, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(store).本尊.法宝, (item, key) => {\n                                                    return (_openBlock(), _createElementBlock(_Fragment, { key: key }, [\n                                                        (key && String(key).trim())\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_51, [\n                                                                _createElementVNode(\"div\", _hoisted_52, _toDisplayString(item?.名称 || key), 1 /* TEXT */),\n                                                                _createElementVNode(\"div\", _hoisted_53, _toDisplayString(item?.品阶 || '未知'), 1 /* TEXT */),\n                                                                _createElementVNode(\"div\", _hoisted_54, _toDisplayString(item?.描述 || '暂无描述'), 1 /* TEXT */)\n                                                            ]))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ], 64 /* STABLE_FRAGMENT */));\n                                                }), 128 /* KEYED_FRAGMENT */)),\n                                                (!_unref(store).本尊.法宝 || Object.keys(_unref(store).本尊.法宝).length === 0)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_55, \"空空如也\"))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_56, [\n                                            _cache[18] || (_cache[18] = _createElementVNode(\"div\", { class: \"section-title\" }, [\n                                                _createElementVNode(\"i\", { class: \"fa-solid fa-box-open\" }),\n                                                _createTextVNode(\" 储物戒 \")\n                                            ], -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", _hoisted_57, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(store).本尊.背包, (item, key) => {\n                                                    return (_openBlock(), _createElementBlock(_Fragment, { key: key }, [\n                                                        (key && String(key).trim())\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_58, [\n                                                                _createElementVNode(\"div\", _hoisted_59, [\n                                                                    _createElementVNode(\"span\", _hoisted_60, _toDisplayString(item?.名称 || key), 1 /* TEXT */),\n                                                                    _createElementVNode(\"span\", _hoisted_61, \"×\" + _toDisplayString(item?.数量 || 1), 1 /* TEXT */)\n                                                                ]),\n                                                                _createElementVNode(\"div\", _hoisted_62, _toDisplayString(item?.品阶 || '未知'), 1 /* TEXT */),\n                                                                _createElementVNode(\"div\", _hoisted_63, _toDisplayString(item?.描述 || '暂无描述'), 1 /* TEXT */)\n                                                            ]))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ], 64 /* STABLE_FRAGMENT */));\n                                                }), 128 /* KEYED_FRAGMENT */)),\n                                                (!_unref(store).本尊.背包 || Object.keys(_unref(store).本尊.背包).length === 0)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_64, \"空空如也\"))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ])\n                                        ])\n                                    ])\n                                ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                                : (_unref(activeTab) === 'companions')\n                                    ? (_openBlock(), _createElementBlock(_Fragment, { key: 3 }, [\n                                        _createCommentVNode(\" 红颜面板 \"),\n                                        _createElementVNode(\"div\", _hoisted_65, [\n                                            _createElementVNode(\"div\", _hoisted_66, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(store).红颜, (companion, name) => {\n                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                        key: name,\n                                                        class: \"companion-card\"\n                                                    }, [\n                                                        _createElementVNode(\"div\", _hoisted_67, [\n                                                            _createElementVNode(\"span\", _hoisted_68, _toDisplayString(name), 1 /* TEXT */),\n                                                            _createElementVNode(\"span\", {\n                                                                class: \"companion-realm\",\n                                                                style: _normalizeStyle({ color: _unref(getRealmColor)(companion.等级) })\n                                                            }, _toDisplayString(companion.境界描述), 5 /* TEXT, STYLE */)\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_69, [\n                                                            _cache[19] || (_cache[19] = _createElementVNode(\"span\", { class: \"relation-label\" }, \"关系:\", -1 /* CACHED */)),\n                                                            _createElementVNode(\"span\", _hoisted_70, _toDisplayString(companion.关系), 1 /* TEXT */)\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_71, [\n                                                            _cache[20] || (_cache[20] = _createElementVNode(\"div\", { class: \"favor-label\" }, \"好感度\", -1 /* CACHED */)),\n                                                            _createElementVNode(\"div\", _hoisted_72, [\n                                                                _createElementVNode(\"div\", {\n                                                                    class: \"favor-fill\",\n                                                                    style: _normalizeStyle({\n                                                                        width: `${Math.abs(companion.好感度)}%`,\n                                                                        backgroundColor: companion.好感度 >= 0 ? '#ff6b9d' : '#6b7fff',\n                                                                    })\n                                                                }, null, 4 /* STYLE */)\n                                                            ]),\n                                                            _createElementVNode(\"div\", _hoisted_73, _toDisplayString(companion.好感度), 1 /* TEXT */)\n                                                        ])\n                                                    ]));\n                                                }), 128 /* KEYED_FRAGMENT */)),\n                                                (Object.keys(_unref(store).红颜).length === 0)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_74, \"孑然一身，尚无红颜知己\"))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ])\n                                        ])\n                                    ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                                    : (_unref(activeTab) === 'map')\n                                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 4 }, [\n                                            _createCommentVNode(\" 地图面板 \"),\n                                            _createElementVNode(\"div\", _hoisted_75, [\n                                                _createElementVNode(\"div\", _hoisted_76, [\n                                                    _createElementVNode(\"div\", _hoisted_77, _toDisplayString(_unref(store).本尊.行踪.当前区域), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_78, _toDisplayString(_unref(store).本尊.行踪.所属层级), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_79, _toDisplayString(_unref(store).本尊.行踪.环境描述), 1 /* TEXT */)\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_80, [\n                                                    _cache[21] || (_cache[21] = _createElementVNode(\"div\", { class: \"connections-title\" }, \"可通往：\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"div\", _hoisted_81, [\n                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(availableConnections), (conn) => {\n                                                            return (_openBlock(), _createElementBlock(\"span\", {\n                                                                key: conn,\n                                                                class: \"connection-item\",\n                                                                style: _normalizeStyle({ borderColor: getRegionColor(conn) })\n                                                            }, _toDisplayString(conn), 5 /* TEXT, STYLE */));\n                                                        }), 128 /* KEYED_FRAGMENT */)),\n                                                        (_unref(availableConnections).length === 0)\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_82, \" 尚未探明通道 \"))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ])\n                                                ]),\n                                                _createCommentVNode(\" 任务列表 \"),\n                                                _createElementVNode(\"div\", _hoisted_83, [\n                                                    _cache[22] || (_cache[22] = _createElementVNode(\"div\", { class: \"section-title\" }, [\n                                                        _createElementVNode(\"i\", { class: \"fa-solid fa-scroll\" }),\n                                                        _createTextVNode(\" 任务 \")\n                                                    ], -1 /* CACHED */)),\n                                                    _createElementVNode(\"div\", _hoisted_84, [\n                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(store).任务列表, (task, taskId) => {\n                                                            return (_openBlock(), _createElementBlock(_Fragment, { key: taskId }, [\n                                                                (taskId && String(taskId).trim())\n                                                                    ? (_openBlock(), _createElementBlock(\"div\", {\n                                                                        key: 0,\n                                                                        class: _normalizeClass([\"task-item\", `task-${task.状态}`])\n                                                                    }, [\n                                                                        _createElementVNode(\"div\", _hoisted_85, [\n                                                                            _createElementVNode(\"span\", _hoisted_86, _toDisplayString(task.名称 || taskId), 1 /* TEXT */),\n                                                                            _createElementVNode(\"span\", {\n                                                                                class: _normalizeClass([\"task-type\", `type-${task.类型}`])\n                                                                            }, _toDisplayString(task.类型), 3 /* TEXT, CLASS */)\n                                                                        ]),\n                                                                        _createElementVNode(\"div\", _hoisted_87, _toDisplayString(task.目标), 1 /* TEXT */),\n                                                                        _createElementVNode(\"div\", _hoisted_88, _toDisplayString(task.状态), 1 /* TEXT */)\n                                                                    ], 2 /* CLASS */))\n                                                                    : _createCommentVNode(\"v-if\", true)\n                                                            ], 64 /* STABLE_FRAGMENT */));\n                                                        }), 128 /* KEYED_FRAGMENT */)),\n                                                        (!_unref(store).任务列表 || Object.keys(_unref(store).任务列表).length === 0)\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_89, \" 暂无任务 \"))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ])\n                                                ]),\n                                                _createCommentVNode(\" 声望系统 \"),\n                                                _createElementVNode(\"div\", _hoisted_90, [\n                                                    _cache[23] || (_cache[23] = _createElementVNode(\"div\", { class: \"section-title\" }, [\n                                                        _createElementVNode(\"i\", { class: \"fa-solid fa-star\" }),\n                                                        _createTextVNode(\" 声望 \")\n                                                    ], -1 /* CACHED */)),\n                                                    _createElementVNode(\"div\", _hoisted_91, [\n                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(store).声望系统, (rep, faction) => {\n                                                            return (_openBlock(), _createElementBlock(_Fragment, { key: faction }, [\n                                                                (faction && String(faction).trim())\n                                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_92, [\n                                                                        _createElementVNode(\"div\", _hoisted_93, _toDisplayString(faction), 1 /* TEXT */),\n                                                                        _createElementVNode(\"div\", _hoisted_94, [\n                                                                            _createElementVNode(\"div\", {\n                                                                                class: \"reputation-fill\",\n                                                                                style: _normalizeStyle({\n                                                                                    width: `${Math.abs(rep.值)}%`,\n                                                                                    backgroundColor: rep.值 >= 0 ? '#44aa44' : '#ff4444',\n                                                                                })\n                                                                            }, null, 4 /* STYLE */)\n                                                                        ]),\n                                                                        _createElementVNode(\"div\", _hoisted_95, [\n                                                                            _createElementVNode(\"span\", _hoisted_96, _toDisplayString(rep.值), 1 /* TEXT */),\n                                                                            _createElementVNode(\"span\", _hoisted_97, _toDisplayString(rep.关系), 1 /* TEXT */)\n                                                                        ])\n                                                                    ]))\n                                                                    : _createCommentVNode(\"v-if\", true)\n                                                            ], 64 /* STABLE_FRAGMENT */));\n                                                        }), 128 /* KEYED_FRAGMENT */)),\n                                                        (!_unref(store).声望系统 || Object.keys(_unref(store).声望系统).length === 0)\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_98, \" 暂无声望记录 \"))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ])\n                                                ])\n                                            ])\n                                        ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                                        : (_unref(activeTab) === 'gallery')\n                                            ? (_openBlock(), _createElementBlock(_Fragment, { key: 5 }, [\n                                                _createCommentVNode(\" 图鉴面板 - 按比例展示卡片 \"),\n                                                _createElementVNode(\"div\", _hoisted_99, [\n                                                    (_unref(store).hasGalleryCards)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_100, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(store).galleryCards, (card, index) => {\n                                                                return (_openBlock(), _createElementBlock(\"div\", {\n                                                                    key: index,\n                                                                    class: _normalizeClass([\"gallery-card\", { flipped: card.isFlipped }]),\n                                                                    onClick: ($event) => (_unref(store).toggleCardFlip(index))\n                                                                }, [\n                                                                    _createElementVNode(\"div\", _hoisted_102, [\n                                                                        _createCommentVNode(\" 正面 \"),\n                                                                        _createElementVNode(\"div\", _hoisted_103, [\n                                                                            _createElementVNode(\"img\", {\n                                                                                src: card.front,\n                                                                                alt: card.frontName || card.name\n                                                                            }, null, 8 /* PROPS */, _hoisted_104),\n                                                                            _createElementVNode(\"div\", _hoisted_105, _toDisplayString(card.frontName || card.name), 1 /* TEXT */)\n                                                                        ]),\n                                                                        _createCommentVNode(\" 背面 \"),\n                                                                        _createElementVNode(\"div\", _hoisted_106, [\n                                                                            _createElementVNode(\"div\", _hoisted_107, [\n                                                                                _createElementVNode(\"img\", {\n                                                                                    src: card.back,\n                                                                                    alt: card.backName || card.name,\n                                                                                    class: \"back-image\"\n                                                                                }, null, 8 /* PROPS */, _hoisted_108),\n                                                                                _createElementVNode(\"div\", _hoisted_109, [\n                                                                                    _createElementVNode(\"div\", _hoisted_110, _toDisplayString(card.backName || card.name), 1 /* TEXT */),\n                                                                                    _createElementVNode(\"div\", _hoisted_111, \"「\" + _toDisplayString(card.backText) + \"」\", 1 /* TEXT */)\n                                                                                ])\n                                                                            ])\n                                                                        ])\n                                                                    ])\n                                                                ], 10 /* CLASS, PROPS */, _hoisted_101));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ]))\n                                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_112, \" 当前场景暂无角色卡片 \"))\n                                                ])\n                                            ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                                            : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createCommentVNode(\" 底部：快捷信息 \"),\n                _createElementVNode(\"div\", _hoisted_113, [\n                    _createElementVNode(\"div\", _hoisted_114, [\n                        _cache[24] || (_cache[24] = _createElementVNode(\"i\", { class: \"fa-solid fa-coins\" }, null, -1 /* CACHED */)),\n                        _createElementVNode(\"span\", null, _toDisplayString(_unref(store).本尊.灵石) + \" 灵石\", 1 /* TEXT */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_115, [\n                        _cache[25] || (_cache[25] = _createElementVNode(\"i\", { class: \"fa-solid fa-moon moon-twinkle\" }, null, -1 /* CACHED */)),\n                        _createElementVNode(\"span\", null, _toDisplayString(_unref(store).世界时钟.纪元) + \" · 第\" + _toDisplayString(_unref(store).世界时钟.年份) + \"年\", 1 /* TEXT */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_116, [\n                        _cache[26] || (_cache[26] = _createElementVNode(\"i\", { class: \"fa-solid fa-heart\" }, null, -1 /* CACHED */)),\n                        _createElementVNode(\"span\", null, _toDisplayString(_unref(store).本尊.寿元状态), 1 /* TEXT */)\n                    ])\n                ])\n            ], 6 /* CLASS, STYLE */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./app.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./app.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./app.vue?vue&type=style&index=0&id=2db111fa&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-2db111fa\"]])\n\nexport default __exports__","import { createPinia } from 'pinia';\nimport { createApp } from 'vue';\nimport App from './app.vue';\n\n$(() => {\n  const pinia = createPinia();\n  const app = createApp(App);\n\n  app.use(pinia);\n  app.mount('#app');\n\n  console.info('[踏月寻仙] 状态栏界面已加载');\n});\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","n","getter","__esModule","d","a","definition","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Vue","z","REALM_NAMES","REALM_STAGES","REALM_THRESHOLDS","REALM_LIFESPANS","ItemSchema","object","string","prefault","coerce","number","transform","v","Math","max","FactionSchema","describe","enum","TechniqueSchema","TreasureSchema","data","LocationSchema","_","clamp","array","SpiritRootSchema","PhysiqueSchema","Schema","record","layer","danger","desc","connections","catch","Date","now","optional","skill","boolean","pickBy","level","majorIdx","floor","toFixed","tasks","sorted","entries","sortBy","t","active","filter","value","completed","take","fromPairs","factions","mapValues","faction","CONFIG","effect","visual","nature","color","getRealmColor","getDangerColor","CHARACTER_ASSETS","normal","front","back","shy","smile","angry","cry","surprise","CHARACTER_IMAGE_POOLS","DEFAULT_EXPRESSION","DEFAULT_PLACEHOLDER","cachedDualSoul","dualSoulSessionUsed","getRandomImage","characterName","type","pool","console","warn","images","length","random","getDualSoulImage","url","soulName","info","soul","randomIndex","error","normalizeExpressionImages","config","frontResult","backResult","frontName","backName","getCharacterImages","imgCode","backImgCode","character","frontConfig","frontNormalized","backUrl","backConfig","backNormalized","patterns","cloudImage","cloudsMulti","cloudsWithStars","stars","texture","landscape","lotus","themes","id","name","description","colors","bgPrimary","bgSecondary","border","borderActive","textPrimary","textSecondary","textAccent","accent","accentGlow","buttonBg","buttonHover","buttonActive","progressBg","headerBg","tabBg","tabActive","footerBg","overlay","getThemeById","find","convertToGalleryCards","visualCards","result","card","img_code","back_img_code","push","backText","back_text","isFlipped","useDataStore","errorCatched","message_id","getCurrentMessageId","rawData","ref","galleryCards","cardCache","Map","initData","retryCount","variables","getVariables","statData","keys","parse","defaultData","toastr","parseCurrentMessageCards","e","setTimeout","tryManualParseMvuMessage","async","waitGlobalInitialized","messages","getChatMessages","fallbackToInheritOrDefault","content","message","currentMvuData","Mvu","getMvuData","newMvuData","parseMessage","replaceMvuData","success","inheritedData","tryInheritFromPreviousFloor","chatMessages","currentIndex","findIndex","msg","i","prevMessageId","prevVariables","prevStatData","parsedData","cacheKey","has","match","jsonStr","trim","cards","JSON","Array","isArray","parseVisualCards","set","preloadImages","warning","Error","forEach","Image","src","then","updateDebounceTimer","debouncedInitData","delay","clearTimeout","eventOn","tavern_events","MESSAGE_UPDATED","MESSAGE_DELETED","MESSAGE_RECEIVED","events","VARIABLE_UPDATE_ENDED","new_variables","_old_variables","variable_option","debug","event_message_id","current_message_id","has_stat_data","parseError","computed","hasData","hasGalleryCards","refresh","toggleCardFlip","index","useThemeStore","currentThemeId","currentTheme","availableThemes","savedThemeId","initTheme","setTheme","themeId","updateVariablesWith","vars","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_76","_hoisted_77","_hoisted_78","_hoisted_79","_hoisted_80","_hoisted_81","_hoisted_82","style","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_hoisted_88","_hoisted_89","_hoisted_90","_hoisted_91","_hoisted_92","_hoisted_93","_hoisted_94","_hoisted_95","_hoisted_96","_hoisted_97","_hoisted_98","_hoisted_99","_hoisted_100","_hoisted_101","_hoisted_102","_hoisted_103","_hoisted_104","_hoisted_105","_hoisted_106","_hoisted_107","_hoisted_108","_hoisted_109","_hoisted_110","_hoisted_111","_hoisted_112","_hoisted_113","_hoisted_114","_hoisted_115","_hoisted_116","__name","setup","__props","store","themeStore","availableConnections","manualConnections","currentRegion","mapData","tabs","label","icon","activeTab","isCollapsed","showThemeSelector","toggleCollapse","toggleThemeSelector","themeStyles","theme","parentRegion","locationInfo","realmColor","rootColor","root","elem","includes","getRootColor","dangerColor","locationColor","getRegionColor","region","_ctx","_cache","collapsed","alt","onClick","title","backgroundColor","default","$event","background","borderColor","tab","width","String","item","companion","abs","conn","task","taskId","rep","flipped","$","pinia","app","createApp","use","mount"],"ignoreList":[],"sourceRoot":""}