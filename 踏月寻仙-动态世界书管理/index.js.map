{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/踏月寻仙-测试版/schema.ts","src://tavern_helper_template/src/踏月寻仙-动态世界书管理/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","// ============================================================================\n// 踏月寻仙 - MVU 变量结构定义 (Zod Schema for MVU Variables)\n// ============================================================================\n// 修炼境界等级与境界描述映射\n// 等级 1-4:   练气（初期、中期、后期、大圆满）\n// 等级 5-8:   筑基（初期、中期、后期、大圆满）\n// 等级 9-12:  金丹（初期、中期、后期、大圆满）\n// 等级 13-16: 元婴（初期、中期、后期、大圆满）\n// 等级 17-20: 化神（初期、中期、后期、大圆满）\n// 等级 21-24: 炼虚（初期、中期、后期、大圆满）\n// 等级 25-28: 合体（初期、中期、后期、大圆满）\n// 等级 29-32: 大乘（初期、中期、后期、大圆满）\n// 等级 33-36: 渡劫（初期、中期、后期、大圆满）\nconst REALM_NAMES = ['练气', '筑基', '金丹', '元婴', '化神', '炼虚', '合体', '大乘', '渡劫'];\nconst REALM_STAGES = ['初期', '中期', '后期', '大圆满'];\n// 修炼境界等级与突破阈值映射\nconst REALM_THRESHOLDS = [100, 100, 100, 100, 200, 200, 200, 200, 400, 400, 400, 400, 800, 800, 800, 800, 1600, 1600, 1600, 1600, 3200, 3200, 3200, 3200, 6400, 6400, 6400, 6400, 12800, 12800, 12800, 12800, 25600, 25600, 25600, 25600];\n// 修炼境界等级与寿元上限映射\nconst REALM_LIFESPANS = [100, 100, 100, 100, 200, 200, 200, 200, 500, 500, 500, 500, 1000, 1000, 1000, 1000, 2000, 2000, 2000, 2000, 5000, 5000, 5000, 5000, 10000, 10000, 10000, 10000, 50000, 50000, 50000, 50000, 100000, 100000, 100000, 100000];\n// 物品 Schema\nconst ItemSchema = z.object({\n    名称: z.string().prefault(''),\n    描述: z.string().prefault(''),\n    品阶: z.string().prefault(''),\n    数量: z.coerce.number().transform(v => Math.max(1, v)).prefault(1), // 默认为 1 且最小为 1，避免被过滤\n});\n// 宗门势力 Schema\nconst FactionSchema = z.object({\n    所在地: z.string(),\n    核心特点: z.string(),\n    最高战力: z.string(),\n    阵营: z.enum(['正道', '魔道', '中立']),\n    规模: z.enum(['超大宗门', '大宗门', '小宗门', '微型宗门', '特殊势力']),\n    备注: z.string().optional(),\n});\n// 功法 Schema\nconst TechniqueSchema = z.object({\n    品阶: z.enum(['凡阶', '黄阶', '玄阶', '地阶', '天阶', '仙阶', '圣阶']),\n    属性: z.string().describe('如:金系、木系、火系等'),\n    效果描述: z.string(),\n    修炼要求: z.string().optional(),\n});\n// 法宝兵器 Schema\nconst TreasureSchema = z.object({\n    品阶: z.enum(['凡器', '法器', '灵器', '法宝', '灵宝', '仙器', '圣器', '道器']),\n    类型: z.string().describe('如:剑、刀、枪、防御、飞行、储物等'),\n    特性: z.string(),\n    当前持有者: z.string().optional(),\n});\n// 地点 Schema\nconst LocationSchema = z.object({\n    所属区域: z.enum(['天层', '神州', '东苍', '南炎', '西庚', '北冥', '下层', '四海']),\n    类型: z.enum(['秘境', '城镇', '宗门', '禁地', '遗迹', '自然地形']),\n    危险度: z.coerce.number().transform(v => _.clamp(v, 0, 100)),\n    特点: z.string(),\n    可获得资源: z.array(z.string()).prefault([]),\n});\n// 灵根 Schema\nconst SpiritRootSchema = z.object({\n    品质: z.enum(['劣等', '下品', '中品', '上品', '极品', '天灵根', '变异']),\n    属性: z.string().describe('如:金、木、水、火、土、冰、雷、风、光、暗等'),\n    修炼速度: z.string().describe('如:0.5倍、1倍、2倍、5倍等'),\n    特性描述: z.string(),\n    稀有度: z.enum(['常见', '少见', '罕见', '稀有', '传说']),\n});\n// 体质 Schema\nconst PhysiqueSchema = z.object({\n    品质: z.enum(['凡体', '灵体', '道体', '圣体', '神体']),\n    特性描述: z.string(),\n    优势: z.string(),\n    劣势: z.string().optional(),\n    稀有度: z.enum(['常见', '少见', '罕见', '稀有', '传说']),\n});\n// 完整的 MVU 变量结构 - 完全参考角色卡示例的结构\nexport const Schema = z.object({\n    世界时钟: z.object({\n        纪元: z.string().prefault('末法时代'),\n        年份: z.coerce.number().prefault(1),\n        月份: z.coerce.number().transform(v => _.clamp(v, 1, 12)).prefault(1),\n        日期: z.coerce.number().transform(v => _.clamp(v, 1, 30)).prefault(1),\n        时辰: z.string().prefault('子时'),\n    }),\n    世界地图: z.record(z.string().describe('区域名'), z.object({\n        layer: z.enum(['天层', '地层', '下层']).prefault('地层'),\n        danger: z.coerce.number().transform(v => _.clamp(v, 0, 100)),\n        desc: z.string().prefault(''),\n        connections: z.array(z.string()).prefault([]),\n    })).prefault({}),\n    世界图志: z.record(z.string().describe('事件名'), z.object({\n        状态: z.string().prefault(''),\n        事件: z.string().prefault(''),\n    })).prefault({}),\n    宗门势力库: z.record(z.string().describe('宗门名'), FactionSchema).prefault({\n        // 正道超大宗门\n        剑阁: { 所在地: '神州·剑门关', 核心特点: '剑修圣地，天下剑道源头', 最高战力: '剑仙·南宫秋水（渡劫后期）', 阵营: '正道', 规模: '超大宗门', 备注: '宗门悬空于万仞天堑之上，非剑心通明者不可登门，与魔道抗衡千年' },\n        万法宗: { 所在地: '神州·问道峰', 核心特点: '包容并蓄，研究万法本源', 最高战力: '道主·尘微散人（渡劫初期）', 阵营: '正道', 规模: '超大宗门', 备注: '坐拥天下第一藏经阁，不论出身皆可入内求法，号称万流归宗，是修仙界理论与知识的最高殿堂，与剑宗交好' },\n        // 正道大宗门\n        金刚寺: { 所在地: '神州·西天佛山', 核心特点: '佛修圣地，炼体神通', 最高战力: '方丈·玄悲（大乘中期）', 阵营: '正道', 规模: '大宗门', 备注: '佛门魁首，镇压魔道' },\n        药王谷: { 所在地: '神农架', 核心特点: '医修圣地，炼丹术独步天下', 最高战力: '药王·孙思邈（大乘初期）', 阵营: '正道', 规模: '大宗门', 备注: '人脉极广，正魔皆求其丹药' },\n        儒门: { 所在地: '神州·文圣山', 核心特点: '修浩然正气，以文入道', 最高战力: '文圣·孔夫子（大乘中期）', 阵营: '正道', 规模: '大宗门', 备注: '影响力巨大，掌控世俗文脉' },\n        青龙殿: { 所在地: '东苍·青龙山脉', 核心特点: '守护青龙遗脉，镇守青帝陵', 最高战力: '青龙使·敖广（大乘初期）', 阵营: '正道', 规模: '大宗门', 备注: '半人半妖，与妖族关系微妙' },\n        玄武宗: { 所在地: '北冥·玄冰山', 核心特点: '镇守北冥，守护玄武圣兽', 最高战力: '宗主·玄冥子（大乘后期）', 阵营: '正道', 规模: '大宗门', 备注: '常年镇守归墟，极少外出' },\n        // 正道小宗门\n        建木宗: { 所在地: '东苍·建木神树', 核心特点: '崇拜建木，擅木系道法', 最高战力: '木长老（合体中期）', 阵营: '正道', 规模: '小宗门', 备注: '东苍实际管理者之一' },\n        百花谷: { 所在地: '百花秘境', 核心特点: '全为女修，以花入道', 最高战力: '花主·牡丹（合体后期）', 阵营: '正道', 规模: '小宗门', 备注: '与各大宗门联姻众多' },\n        // 魔道超大宗门\n        血神教: { 所在地: '血魔渊', 核心特点: '修炼血道，以血炼法', 最高战力: '血神老祖（渡劫中期）', 阵营: '魔道', 规模: '超大宗门', 备注: '与剑阁对峙千年，死敌' },\n        // 魔道大宗门\n        天魔宗: { 所在地: '天魔山', 核心特点: '正统魔修，修炼天魔大道', 最高战力: '天魔宗主（大乘中期）', 阵营: '魔道', 规模: '大宗门', 备注: '魔道中相对守规矩的一派' },\n        // 中立超大宗门\n        妖盟: { 所在地: '万妖森林', 核心特点: '妖族联盟，与人类和平共处', 最高战力: '妖王·白泽（渡劫中期）', 阵营: '中立', 规模: '超大宗门', 备注: '维护妖族利益，不参与人族内斗' },\n        // 中立大宗门\n        大夏王朝: { 所在地: '神州·中州皇城', 核心特点: '世俗统治，皇室修仙', 最高战力: '夏皇（大乘初期）', 阵营: '中立', 规模: '大宗门', 备注: '名义上统御神州，实际受宗门制约' },\n        九州商会: { 所在地: '神州九大主城', 核心特点: '商业联盟，掌控经济命脉', 最高战力: '财神爷（大乘初期）', 阵营: '中立', 规模: '大宗门', 备注: '只做生意，不问正魔' },\n        // 中立小宗门\n        离火宫: { 所在地: '南炎·不灭火山', 核心特点: '供奉朱雀圣兽，亦正亦邪', 最高战力: '宫主·离天火（合体大圆满）', 阵营: '中立', 规模: '小宗门', 备注: '态度摇摆，谁给好处帮谁' },\n        铸剑山庄: { 所在地: '南炎·地火熔炉', 核心特点: '天下第一炼器宗门', 最高战力: '庄主·欧冶子（合体后期）', 阵营: '中立', 规模: '小宗门', 备注: '只认材料不认人，正魔客户都接' },\n    }),\n    功法库: z.record(z.string().describe('功法名'), TechniqueSchema).prefault({\n        // 通用基础功法\n        引气诀: { 品阶: '凡阶', 属性: '通用', 效果描述: '基础引气，各宗门入门功法' },\n        五行诀: { 品阶: '黄阶', 属性: '五行', 效果描述: '平衡五行，稳扎稳打' },\n        筑基真解: { 品阶: '玄阶', 属性: '通用', 效果描述: '完美筑基之法' },\n        金丹大道: { 品阶: '地阶', 属性: '通用', 效果描述: '凝结金丹的秘法' },\n        // 金系功法\n        万剑归宗诀: { 品阶: '天阶', 属性: '金系·剑道', 效果描述: '剑阁镇宗功法，御万剑', 修炼要求: '剑心通明' },\n        庚金神雷: { 品阶: '天阶', 属性: '金系·雷系', 效果描述: '金雷双修，威力巨大' },\n        // 木系功法\n        百花真经: { 品阶: '地阶', 属性: '木系', 效果描述: '百花谷核心，以花入道' },\n        建木通天诀: { 品阶: '天阶', 属性: '木系', 效果描述: '建木宗镇宗，直达天听' },\n        万木朝宗: { 品阶: '仙阶', 属性: '木系', 效果描述: '青帝遗留，掌控万木', 修炼要求: '残卷，需特殊传承' },\n        // 水系功法\n        玄冰诀: { 品阶: '地阶', 属性: '水系·冰系', 效果描述: '万法宗冰系基础功法，心如冰清' },\n        北冥真经: { 品阶: '天阶', 属性: '水系', 效果描述: '玄武宗镇宗，吞噬转化' },\n        海纳百川: { 品阶: '仙阶', 属性: '水系', 效果描述: '归墟感悟，容纳万物', 修炼要求: '残卷' },\n        // 火系功法\n        朱雀涅槃经: { 品阶: '天阶', 属性: '火系', 效果描述: '离火宫镇宫，涅槃重生' },\n        太阳真火: { 品阶: '天阶', 属性: '火系', 效果描述: '极致阳火，焚尽万物' },\n        祝融神火: { 品阶: '仙阶', 属性: '火系', 效果描述: '火神遗留，威力无穷', 修炼要求: '残卷' },\n        // 土系功法\n        不动明王身: { 品阶: '天阶', 属性: '土系·佛门', 效果描述: '金刚寺镇寺，防御无敌' },\n        // 变异属性功法\n        九天雷神诀: { 品阶: '天阶', 属性: '雷系', 效果描述: '雷系顶级，代天行罚' },\n        虚空经: { 品阶: '天阶', 属性: '空间', 效果描述: '空间属性，罕见难修' },\n        轮回经: { 品阶: '仙阶', 属性: '轮回', 效果描述: '涉及轮回，因果重大', 修炼要求: '残卷，{{user}}专属' },\n        // 特殊功法\n        万法归宗: { 品阶: '天阶', 属性: '通用', 效果描述: '万法宗镇宗，模拟万法' },\n        医仙宝典: { 品阶: '天阶', 属性: '医道', 效果描述: '药王谷镇谷，活死人肉白骨' },\n        天魔策: { 品阶: '天阶', 属性: '魔道', 效果描述: '魔道至高，速成但隐患大' },\n        // 剑道专属\n        斩轮回剑典: { 品阶: '仙阶', 属性: '剑道·轮回', 效果描述: '{{user}}前世所创，斩断因果', 修炼要求: '残卷，{{user}}专属' },\n        剑意通神: { 品阶: '仙阶', 属性: '剑道', 效果描述: '剑道至高，意即为剑', 修炼要求: '剑道顿悟' },\n    }),\n    法宝库: z.record(z.string().describe('法宝名'), TreasureSchema).prefault({\n        // 剑类\n        青锋剑: { 品阶: '法器', 类型: '剑', 特性: '制式长剑，锋利耐用', 当前持有者: '各宗门弟子标配' },\n        秋水剑: { 品阶: '灵器', 类型: '剑', 特性: '剑身如水，适合水系剑修', 当前持有者: '玄武宗内门弟子' },\n        离火剑: { 品阶: '法宝', 类型: '剑', 特性: '蕴含离火，挥出火焰剑气', 当前持有者: '离火宫真传弟子' },\n        寒镜剑: { 品阶: '法宝', 类型: '剑', 特性: '心镜能力，可映照人心', 当前持有者: '凌寒镜' },\n        红绡枪: { 品阶: '法宝', 类型: '枪', 特性: '红绡舞天，破军杀阵', 当前持有者: '战红绡' },\n        青龙剑: { 品阶: '灵宝', 类型: '剑', 特性: '蕴含青龙之魂，木属性', 当前持有者: '青龙殿镇殿之宝' },\n        白虎剑: { 品阶: '灵宝', 类型: '剑', 特性: '杀伐之气冲天，金属性', 当前持有者: '白虎圣殿镇殿' },\n        朱雀剑: { 品阶: '灵宝', 类型: '剑', 特性: '火焰化形，火属性', 当前持有者: '离火宫镇宫之宝' },\n        玄武剑: { 品阶: '灵宝', 类型: '剑', 特性: '厚重防御，水属性', 当前持有者: '玄武宗镇宗之宝' },\n        斩轮回: { 品阶: '仙器', 类型: '剑', 特性: '可斩因果（残破）', 当前持有者: '{{user}}（需重铸）' },\n        镇渊剑: { 品阶: '仙器', 类型: '剑', 特性: '{{user}}本命剑，可随修为成长（未完成）', 当前持有者: '{{user}}需自行炼制' },\n        双鱼佩: { 品阶: '仙器', 类型: '法宝·护身', 特性: '稳定时空法则，内藏小世界，可庇护神魂', 当前持有者: '{{user}}（需认主）' },\n        // 特殊兵器\n        绯月神弓: { 品阶: '法宝', 类型: '弓', 特性: '朱雀之力，远程攻击极强', 当前持有者: '焰绯月' },\n        碧玉瑶琴: { 品阶: '法宝', 类型: '琴', 特性: '天籁之音，可治愈心魔', 当前持有者: '叶挽歌' },\n        千丝罗网: { 品阶: '灵宝', 类型: '法器', 特性: '织梦控心，幻术神器', 当前持有者: '幻千丝' },\n        雪魄琉璃炉: { 品阶: '灵宝', 类型: '丹炉', 特性: '冰雪之力加持，炼丹神器', 当前持有者: '苏雪魄' },\n        龙鳞护甲: { 品阶: '灵宝', 类型: '防御', 特性: '真龙鳞片，防御极强', 当前持有者: '敖清霜' },\n        // 储物类\n        储物袋: { 品阶: '法器', 类型: '储物', 特性: '基础储物，空间较小' },\n        储物戒指: { 品阶: '灵器', 类型: '储物', 特性: '空间较大，便于携带' },\n        乾坤袋: { 品阶: '法宝', 类型: '储物', 特性: '空间巨大，可装活物' },\n        洞天法宝: { 品阶: '灵宝', 类型: '储物', 特性: '内含小世界，可居住修炼' },\n    }),\n    地点库: z.record(z.string().describe('地点名'), LocationSchema).prefault({\n        // 天层\n        天渊: { 所属区域: '天层', 类型: '禁地', 危险度: 95, 特点: '悬浮裂隙，星辰坠落，连接域外', 可获得资源: ['星辰碎片', '域外陨铁'] },\n        九天罡风带: { 所属区域: '天层', 类型: '禁地', 危险度: 90, 特点: '狂暴罡风，元婴以下无法穿越', 可获得资源: ['罡风精华'] },\n        // 神州\n        问道峰: { 所属区域: '神州', 类型: '宗门', 危险度: 10, 特点: '万法宗所在，天下问道大会举办地，高九千丈', 可获得资源: ['功法典籍', '灵药'] },\n        剑门关: { 所属区域: '神州', 类型: '宗门', 危险度: 15, 特点: '剑阁山门，悬空于万仞天堑之上', 可获得资源: ['剑意感悟', '飞剑'] },\n        藏书阁: { 所属区域: '神州', 类型: '宗门', 危险度: 5, 特点: '万法宗九层古籍收藏，每层有守护灵', 可获得资源: ['功法', '典籍', '秘术'] },\n        酆都城: { 所属区域: '神州', 类型: '城镇', 危险度: 30, 特点: '引魂司总部，阴阳交汇，白日人市夜晚鬼市', 可获得资源: ['幽冥材料', '鬼修功法'] },\n        龙门瀑布: { 所属区域: '神州', 类型: '秘境', 危险度: 40, 特点: '鲤鱼跃龙门之地，蕴含造化', 可获得资源: ['龙气', '化龙机缘'] },\n        // 东苍\n        建木森林: { 所属区域: '东苍', 类型: '自然地形', 危险度: 50, 特点: '无边原始森林，古树成精', 可获得资源: ['灵木', '木系材料', '妖兽内丹'] },\n        青帝陵: { 所属区域: '东苍', 类型: '遗迹', 危险度: 85, 特点: '青帝遗迹，内有传承考验', 可获得资源: ['青帝传承', '木系至宝'] },\n        百花秘境: { 所属区域: '东苍', 类型: '秘境', 危险度: 20, 特点: '百花谷所在，四季花开', 可获得资源: ['灵花', '花粉', '花系功法'] },\n        // 南炎\n        不灭火山: { 所属区域: '南炎', 类型: '自然地形', 危险度: 80, 特点: '中央火山，朱雀涅槃处', 可获得资源: ['朱雀真火', '火系至宝'] },\n        地火窟: { 所属区域: '南炎', 类型: '自然地形', 危险度: 60, 特点: '地火喷涌，适合炼器', 可获得资源: ['地心火', '炼器材料'] },\n        涅槃台: { 所属区域: '南炎', 类型: '遗迹', 危险度: 70, 特点: '朱雀涅槃留下的石台，蕴含涅槃真意', 可获得资源: ['涅槃感悟', '不死鸟羽毛'] },\n        // 西庚\n        万剑冢: { 所属区域: '西庚', 类型: '禁地', 危险度: 85, 特点: '上古战场遗址，剑意千年不散', 可获得资源: ['剑意感悟', '古剑', '剑修传承'] },\n        庚金矿脉: { 所属区域: '西庚', 类型: '自然地形', 危险度: 40, 特点: '盛产庚金之精，炼制飞剑最佳', 可获得资源: ['庚金', '金属矿石'] },\n        // 北冥\n        玄冰山: { 所属区域: '北冥', 类型: '宗门', 危险度: 50, 特点: '玄武宗所在，黑色冰山永不融化', 可获得资源: ['玄冰', '寒冰材料'] },\n        归墟海眼: { 所属区域: '北冥', 类型: '禁地', 危险度: 99, 特点: '吞噬一切的漩涡，万物终结', 可获得资源: ['归墟感悟', '混沌之力'] },\n        // 下层\n        黄泉古迹: { 所属区域: '下层', 类型: '遗迹', 危险度: 90, 特点: '九曲天河源头，通往幽冥', 可获得资源: ['黄泉水', '幽冥宝物'] },\n        无尽炎渊: { 所属区域: '下层', 类型: '禁地', 危险度: 95, 特点: '南炎地心火狱，火焰分层', 可获得资源: ['地心火', '炎魔材料'] },\n    }),\n    灵根库: z.record(z.string().describe('灵根名'), SpiritRootSchema).prefault({\n        // ===== 五行灵根 =====\n        // 单灵根（天灵根）\n        金天灵根: { 品质: '天灵根', 属性: '金', 修炼速度: '5倍', 特性描述: '纯粹金属性，锋锐无双，攻击力极强', 稀有度: '传说' },\n        木天灵根: { 品质: '天灵根', 属性: '木', 修炼速度: '5倍', 特性描述: '纯粹木属性，生生不息，恢复力极强', 稀有度: '传说' },\n        水天灵根: { 品质: '天灵根', 属性: '水', 修炼速度: '5倍', 特性描述: '纯粹水属性，柔韧包容，适应力极强', 稀有度: '传说' },\n        火天灵根: { 品质: '天灵根', 属性: '火', 修炼速度: '5倍', 特性描述: '纯粹火属性，爆发力极强，威力巨大', 稀有度: '传说' },\n        土天灵根: { 品质: '天灵根', 属性: '土', 修炼速度: '5倍', 特性描述: '纯粹土属性，厚重稳固，防御力极强', 稀有度: '传说' },\n        // 双灵根（极品）\n        金木双灵根: { 品质: '极品', 属性: '金木', 修炼速度: '3倍', 特性描述: '金木相克又相生，适合修炼特殊功法', 稀有度: '稀有' },\n        水火双灵根: { 品质: '极品', 属性: '水火', 修炼速度: '3倍', 特性描述: '水火既济，阴阳调和，平衡发展', 稀有度: '稀有' },\n        金火双灵根: { 品质: '极品', 属性: '金火', 修炼速度: '3倍', 特性描述: '火炼真金，适合炼器和战斗', 稀有度: '稀有' },\n        木水双灵根: { 品质: '极品', 属性: '木水', 修炼速度: '3倍', 特性描述: '水生木，生机勃勃，恢复力强', 稀有度: '稀有' },\n        // 三灵根（上品）\n        金木水三灵根: { 品质: '上品', 属性: '金木水', 修炼速度: '2倍', 特性描述: '三属性均衡，可修炼多种功法', 稀有度: '罕见' },\n        火土金三灵根: { 品质: '上品', 属性: '火土金', 修炼速度: '2倍', 特性描述: '火生土、土生金，攻守兼备', 稀有度: '罕见' },\n        // 四灵根（中品）\n        金木水火四灵根: { 品质: '中品', 属性: '金木水火', 修炼速度: '1倍', 特性描述: '四属性修炼，进度较慢但全面', 稀有度: '少见' },\n        // 五行杂灵根（下品）\n        五行杂灵根: { 品质: '下品', 属性: '金木水火土', 修炼速度: '0.5倍', 特性描述: '五行俱全但杂乱，修炼缓慢', 稀有度: '常见' },\n        // ===== 变异灵根 =====\n        变异冰灵根: { 品质: '变异', 属性: '冰', 修炼速度: '4倍', 特性描述: '水属性变异，极寒之力，冻结万物', 稀有度: '传说' },\n        变异雷灵根: { 品质: '变异', 属性: '雷', 修炼速度: '4倍', 特性描述: '金属性变异，雷霆之力，毁灭一切', 稀有度: '传说' },\n        变异风灵根: { 品质: '变异', 属性: '风', 修炼速度: '4倍', 特性描述: '木属性变异，御风而行，速度无双', 稀有度: '传说' },\n        变异暗灵根: { 品质: '变异', 属性: '暗', 修炼速度: '4倍', 特性描述: '水属性变异，幽暗侵蚀，诡异莫测', 稀有度: '传说' },\n        变异光灵根: { 品质: '变异', 属性: '光', 修炼速度: '4倍', 特性描述: '火属性变异，圣光净化，克制邪祟', 稀有度: '传说' },\n        变异离火灵根: { 品质: '变异', 属性: '离火', 修炼速度: '4倍', 特性描述: '火属性变异，朱雀之火，涅槃重生', 稀有度: '传说' },\n        变异空间灵根: { 品质: '变异', 属性: '空间', 修炼速度: '5倍', 特性描述: '至高变异，掌控空间，极为稀有', 稀有度: '传说' },\n        变异时间灵根: { 品质: '变异', 属性: '时间', 修炼速度: '5倍', 特性描述: '至高变异，操控时间，万古难遇', 稀有度: '传说' },\n        变异混沌灵根: { 品质: '变异', 属性: '混沌', 修炼速度: '5倍', 特性描述: '至高变异，回归混沌，包容万物', 稀有度: '传说' },\n        变异轮回灵根: { 品质: '变异', 属性: '轮回', 修炼速度: '5倍', 特性描述: '至高变异，轮回之力，{{user}}专属', 稀有度: '传说' },\n        // 复合变异\n        冰火双灵根: { 品质: '变异', 属性: '冰火', 修炼速度: '3.5倍', 特性描述: '冰火两极，极致对立又统一', 稀有度: '传说' },\n        冰雷双灵根: { 品质: '变异', 属性: '冰雷', 修炼速度: '3.5倍', 特性描述: '寒冰与雷霆，冻结后粉碎', 稀有度: '传说' },\n        暗幻双灵根: { 品质: '变异', 属性: '暗幻', 修炼速度: '3.5倍', 特性描述: '暗影与幻术，诡异莫测', 稀有度: '传说' },\n        水龙双灵根: { 品质: '变异', 属性: '水龙', 修炼速度: '4倍', 特性描述: '蕴含龙族血脉，掌控水系', 稀有度: '传说' },\n        冰丹双灵根: { 品质: '变异', 属性: '冰丹', 修炼速度: '3.5倍', 特性描述: '冰系与丹道，独特组合', 稀有度: '传说' },\n    }),\n    体质库: z.record(z.string().describe('体质名'), PhysiqueSchema).prefault({\n        // ===== 凡体 =====\n        凡体: { 品质: '凡体', 特性描述: '普通凡人体质，无特殊之处', 优势: '无', 稀有度: '常见' },\n        // ===== 灵体 =====\n        玄冰灵体: { 品质: '灵体', 特性描述: '天生亲近冰属性，修炼冰系功法事半功倍', 优势: '冰系法术威力+50%，冰系抗性+80%', 劣势: '火系抗性-30%', 稀有度: '罕见' },\n        离火之体: { 品质: '灵体', 特性描述: '天生火焰体质，修炼火系功法速度极快', 优势: '火系法术威力+50%，火系抗性+80%', 劣势: '水系抗性-30%', 稀有度: '罕见' },\n        木灵之体: { 品质: '灵体', 特性描述: '亲近草木，拥有强大恢复能力', 优势: '恢复速度+100%，木系法术威力+50%', 劣势: '金系抗性-30%', 稀有度: '罕见' },\n        天籁之体: { 品质: '灵体', 特性描述: '天生音律体质，可用音律治愈心魔', 优势: '音律神通，治愈心魔', 劣势: '战斗力较弱', 稀有度: '罕见' },\n        花妖之体: { 品质: '灵体', 特性描述: '花妖化形，容貌倾城，天生魅惑', 优势: '魅惑能力，控制花草', 劣势: '离开灵气充沛之地会虚弱', 稀有度: '稀有' },\n        // ===== 道体 =====\n        朱雀血脉: { 品质: '道体', 特性描述: '朱雀神兽血脉，可涅槃重生', 优势: '火系法术威力+100%，涅槃能力', 劣势: '过于骄傲容易轻敌', 稀有度: '传说' },\n        真龙血脉: { 品质: '道体', 特性描述: '真龙血脉，身体素质远超常人', 优势: '身体素质+200%，龙族神通', 劣势: '容易被龙族克制', 稀有度: '传说' },\n        先天战体: { 品质: '道体', 特性描述: '天生战斗体质，战斗天赋极高', 优势: '战斗力+100%，战意凌厉', 劣势: '不擅长其他方面', 稀有度: '传说' },\n        梦魇之体: { 品质: '道体', 特性描述: '可操控梦境，擅长幻术', 优势: '幻术神通，情报收集', 劣势: '正面战斗力一般，怕光明属性', 稀有度: '传说' },\n        雪魂之体: { 品质: '道体', 特性描述: '雪域神兽转世，冰系至强', 优势: '冰系法术威力+150%，雪域神通', 劣势: '前世道伤，修为受限', 稀有度: '传说' },\n        // ===== 圣体 =====\n        混沌圣体: { 品质: '圣体', 特性描述: '回归混沌本源，包容万物', 优势: '可修炼任何功法，无属性限制', 劣势: '修炼初期缓慢', 稀有度: '传说' },\n        先天道体: { 品质: '圣体', 特性描述: '先天与道合一，悟性无双', 优势: '悟性+300%，修炼速度+200%', 劣势: '容易遭天妒', 稀有度: '传说' },\n        不灭金身: { 品质: '圣体', 特性描述: '肉身不灭，防御无敌', 优势: '防御力+500%，几乎不死', 劣势: '速度较慢', 稀有度: '传说' },\n        // ===== 神体 =====\n        轮回之体: { 品质: '神体', 特性描述: '掌控轮回，{{user}}专属体质', 优势: '轮回神通，可斩因果', 劣势: '遭天道忌惮', 稀有度: '传说' },\n        时空之体: { 品质: '神体', 特性描述: '掌控时空，万古难遇', 优势: '时空神通，逆转因果', 劣势: '消耗极大', 稀有度: '传说' },\n    }),\n    本尊: z\n        .object({\n        等级: z.coerce.number().transform(v => _.clamp(v, 1, 36)),\n        修为: z.coerce.number().transform(v => Math.max(0, v)),\n        灵根: z.string().prefault('五行杂灵根'),\n        体质: z.string().prefault('凡体'),\n        功法: z.string().prefault('无'),\n        本命兵器: z.string().prefault('无'),\n        神通列表: z.record(z.string().describe('神通名'), z.string().describe('神通描述')).prefault({}),\n        灵石: z.coerce.number().transform(v => Math.max(0, v)),\n        已活岁月: z.coerce.number().transform(v => Math.max(0, v)),\n        尝试突破: z.boolean().prefault(false),\n        行踪: z.object({\n            当前区域: z.string().prefault('未知之地'),\n            所属层级: z.string().optional(),\n            环境描述: z.string().optional(),\n            危险度: z.coerce.number().optional(),\n            可用通道: z.array(z.string()).optional(),\n            导航信息: z.string().optional(),\n        }),\n        身份: z.object({\n            姓名: z.string().prefault('无名氏'),\n            宗门: z.string().prefault('散修'),\n            出身: z.string().prefault('凡人'),\n        }),\n        背包: z\n            .record(z.string().describe('物品名'), ItemSchema)\n            .prefault({})\n            .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),\n        法宝: z\n            .record(z.string().describe('法宝名'), ItemSchema)\n            .prefault({})\n            .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),\n        杂物袋: z\n            .record(z.string().describe('杂物名'), ItemSchema)\n            .prefault({})\n            .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),\n    })\n        .transform(data => {\n        const level = data.等级;\n        const 突破阈值 = REALM_THRESHOLDS[level - 1] ?? 100;\n        const 寿元上限 = REALM_LIFESPANS[level - 1] ?? 100;\n        const majorIdx = Math.floor((level - 1) / 4);\n        const minorIdx = (level - 1) % 4;\n        const 境界描述 = `${REALM_NAMES[majorIdx] ?? '练气'}${REALM_STAGES[minorIdx] ?? '初期'}`;\n        const 寿元状态 = `${data.已活岁月}/${寿元上限}`;\n        const 状态 = data.尝试突破 ? '突破中' : data.修为 >= 突破阈值 ? '瓶颈期' : '修炼中';\n        const 进度 = `${((data.修为 / 突破阈值) * 100).toFixed(1)}%`;\n        return {\n            ...data,\n            突破阈值,\n            寿元上限,\n            境界描述,\n            寿元状态,\n            状态,\n            进度,\n        };\n    }),\n    红颜角色库: z.record(z.string().describe('角色名'), z.object({\n        等级: z.coerce.number().transform(v => _.clamp(v, 1, 36)),\n        灵根: z.string(),\n        体质: z.string(),\n        年龄: z.string().describe('如: 24岁 或 外表26岁,实际218岁'),\n        所属: z.string(),\n        功法: z.string(),\n        本命兵器: z.string(),\n        神通: z.array(z.string()).prefault([]),\n        性格: z.string(),\n        背景: z.string(),\n        特殊设定: z.string().optional(),\n        角色类型: z.enum(['核心红颜', '重要红颜', '次要红颜']),\n    })).prefault({\n        凌寒镜: {\n            等级: 11,\n            灵根: '变异冰灵根(极品)',\n            体质: '玄冰灵体',\n            年龄: '24岁',\n            所属: '万法宗·问道峰真传弟子',\n            功法: '《玄冰诀》(地阶上品)、《心镜明悟诀》(天阶下品)',\n            本命兵器: '北冥天晶弓（灵器上品）',\n            神通: ['冰镜映心', '千里冰封', '心如明镜'],\n            性格: '清冷孤绝 | 心如明镜 | 不染尘埃 | 内心细腻 | 重情重义',\n            背景: '玄冰门世家覆灭后投奔万法宗,天生心镜能力可看穿人心虚伪,二十岁突破金丹成为问道峰百年来最年轻真传',\n            特殊设定: '心镜能力让她看透太多人心险恶导致内心孤独,心镜若被情绪波动影响会失效',\n            角色类型: '核心红颜',\n        },\n        虞汐颜: {\n            等级: 12,\n            灵根: '水/阴阳变异灵根',\n            体质: '阴阳双鱼体',\n            年龄: '化形3年(本体存在万载)',\n            所属: '散修(实为{{user}}的随身玉佩)',\n            功法: '《双生造化诀》(天阶极品)、《阴阳流转经》',\n            本命兵器: '阴阳双鱼佩(本体,可化作护盾或利刃)',\n            神通: ['枯木逢春(虞汐)', '夺命红妆(虞颜)', '双鱼游梦', '阴阳轮转'],\n            性格: '虞汐:温柔治愈|天真纯善|胆小软萌; 虞颜:腹黑毒舌|傲娇护短|杀伐果断',\n            背景: '上古大能遗留的阴阳双鱼佩,吸纳天地灵气万载化形,一体双魂(虞汐/虞颜),被{{user}}唤醒后认主',\n            特殊设定: '一体双魂可自由切换,虞汐代表生与善擅长治愈,虞颜代表死与恶擅长杀伐,本体双鱼佩是上古仙府钥匙,可在玉佩形态和人形态间切换',\n            角色类型: '核心红颜',\n        },\n        白清弦: {\n            等级: 29,\n            灵根: '金天灵根(天灵根)',\n            体质: '先天剑体',\n            年龄: '外表30岁,实际328岁',\n            所属: '散修·剑道宗师(可设定为任意宗门长老或客卿)',\n            功法: '《剑意通神》(仙阶)、《天音剑诀》(天阶上品)',\n            本命兵器: '清弦琴剑(灵宝上品,琴剑合一)',\n            神通: ['琴剑双杀', '剑意如歌', '万剑归心'],\n            性格: '清冷出尘 | 琴心剑胆 | 慈悲温柔 | 护短深情 | 暗藏执念',\n            背景: '修仙界闻名的白衣剑仙,琴剑双修的传奇人物,年少成名百岁化神,剑道天赋冠绝当代,白衣如雪抱琴持剑飘然若仙',\n            特殊设定: '真实境界为大乘初期(等级29),但隐藏实力显示为化神后期(等级19);琴剑双绝剑道造诣极高,琴音可辅助可杀敌,抚琴时眼神温柔拔剑时杀意凛然,对{{user}}有禁忌之情,身份灵活可为任意宗门长老或散修',\n            角色类型: '核心红颜',\n        },\n        焰绯月: {\n            等级: 12,\n            灵根: '变异离火灵根(极品)',\n            体质: '朱雀血脉',\n            年龄: '25岁',\n            所属: '南炎离火宫·圣女',\n            功法: '《朱雀涅槃经》(天阶上品)',\n            本命兵器: '绯月神弓(法宝上品)',\n            神通: ['离火焚天', '朱雀真身', '凤凰涅槃'],\n            性格: '骄傲自信 | 热情如火 | 直来直去 | 好胜心强 | 重视荣誉',\n            背景: '南炎离火宫圣女,朱雀血脉觉醒者,天生骄傲自视甚高,好胜心强',\n            特殊设定: '火系法术威力极强远程攻击冠绝同辈,但过于骄傲容易轻敌且防御相对较弱',\n            角色类型: '重要红颜',\n        },\n        幻千丝: {\n            等级: 13,\n            灵根: '暗幻双灵根',\n            体质: '梦魇之体',\n            年龄: '外表20岁,实际未知',\n            所属: '散修·幽冥修士',\n            功法: '《织梦天罗》(天阶中品)',\n            本命兵器: '千丝罗网(灵宝下品)',\n            神通: ['织梦为笼', '心魔幻境', '千丝束缚'],\n            性格: '神秘莫测 | 亦正亦邪 | 难以捉摸 | 玩世不恭 | 好奇心强',\n            背景: '身份神秘的幽冥修士,擅长幻术和梦境操控,行踪不定立场不明',\n            特殊设定: '擅长幻术心理战情报收集暗杀和潜入,但正面战斗力一般且怕光明属性克制',\n            角色类型: '重要红颜',\n        },\n        花想容: {\n            等级: 8,\n            灵根: '木灵根',\n            体质: '花妖之体',\n            年龄: '外表12岁',\n            所属: '建木宗·弟子',\n            功法: '《百花真经》(地阶下品)',\n            本命兵器: '牡丹花瓣(法器)',\n            神通: ['花海领域', '治愈花粉', '魅惑之香'],\n            性格: '天真烂漫 | 容色倾城 | 单纯可爱 | 好奇心强 | 依赖性强',\n            背景: '千年牡丹花妖化形因缘际会拜入建木宗,天性单纯不知人心险恶,容貌倾城',\n            特殊设定: '控制花草治愈能力容貌倾城天生魅惑,但战斗经验不足过于单纯容易被骗离开灵气充沛之地会虚弱',\n            角色类型: '次要红颜',\n        },\n        敖清霜: {\n            等级: 14,\n            灵根: '水龙双灵根',\n            体质: '真龙血脉',\n            年龄: '150岁(外表20岁)',\n            所属: '北冥龙宫·三公主',\n            功法: '《沧海龙吟》(天阶上品)',\n            本命兵器: '龙鳞护甲(灵宝中品)',\n            神通: ['龙族变化', '呼风唤雨', '龙威震慑'],\n            性格: '高贵优雅 | 腹黑狡黠 | 好奇心强 | 向往自由 | 喜欢冒险',\n            背景: '北冥龙宫三公主真龙血脉,厌倦宫廷生活化名敖灵儿混入人间历练',\n            特殊设定: '龙族神通水系法术身体素质远超人类寿元极长,但害怕身份暴露且不擅长隐藏情绪容易露馅',\n            角色类型: '次要红颜',\n        },\n    }),\n    红颜: z.record(z.string().describe('红颜名'), z.object({\n        等级: z.coerce.number().transform(v => _.clamp(v, 1, 36)).prefault(1),\n        修为: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        灵根: z.string().prefault('五行杂灵根'),\n        体质: z.string().prefault('凡体'),\n        功法: z.string().prefault('无'),\n        本命兵器: z.string().prefault('无'),\n        神通列表: z.record(z.string().describe('神通名'), z.string().describe('神通描述')).prefault({}),\n        灵石: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        已活岁月: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        尝试突破: z.boolean().prefault(false),\n        好感度: z.coerce.number().transform(v => _.clamp(v, -100, 100)).prefault(0),\n        关系: z.string().prefault('陌生人'),\n        重要性: z.string().prefault('路人'),\n    })\n        .transform(data => {\n        const level = data.等级;\n        const 突破阈值 = REALM_THRESHOLDS[level - 1] ?? 100;\n        const 寿元上限 = REALM_LIFESPANS[level - 1] ?? 100;\n        const majorIdx = Math.floor((level - 1) / 4);\n        const minorIdx = (level - 1) % 4;\n        const 境界描述 = `${REALM_NAMES[majorIdx] ?? '练气'}${REALM_STAGES[minorIdx] ?? '初期'}`;\n        const 寿元状态 = `${data.已活岁月}/${寿元上限}`;\n        const 状态 = data.尝试突破 ? '突破中' : data.修为 >= 突破阈值 ? '瓶颈期' : '修炼中';\n        const 进度 = `${((data.修为 / 突破阈值) * 100).toFixed(1)}%`;\n        return {\n            ...data,\n            突破阈值,\n            寿元上限,\n            境界描述,\n            寿元状态,\n            状态,\n            进度,\n        };\n    })).prefault({}),\n    NPC图鉴: z.record(z.string().describe('NPC名'), z.object({\n        等级: z.coerce.number().transform(v => _.clamp(v, 1, 36)).prefault(1),\n        修为: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        灵根: z.string().prefault('五行杂灵根'),\n        体质: z.string().prefault('凡体'),\n        功法: z.string().prefault('无'),\n        本命兵器: z.string().prefault('无'),\n        神通列表: z.record(z.string().describe('神通名'), z.string().describe('神通描述')).prefault({}),\n        灵石: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        已活岁月: z.coerce.number().transform(v => Math.max(0, v)).prefault(0),\n        尝试突破: z.boolean().prefault(false),\n        所在宗门: z.string().prefault('散修'),\n    })).prefault({}),\n    任务列表: z.record(z.string().describe('任务名'), z.object({\n        类型: z.enum(['主线', '支线', '每日', '临危受命']),\n        说明: z.string().describe('面向{{user}}的任务背景或细则'),\n        目标: z.string().describe('明确可执行的目标描述'),\n        奖励: z.string(),\n        惩罚: z.string().describe('失败后触发的负面效果'),\n        状态: z.enum(['进行中', '已完成', '已失败']).prefault('进行中'),\n    })).prefault({}),\n    声望系统: z.record(z.string().describe('势力名'), z.object({\n        声望值: z.coerce.number().transform(v => _.clamp(v, -100, 100)),\n        称号: z.string().optional(),\n        关系描述: z.string(),\n    })).prefault({}),\n});\n// 配置常量\nexport const CONFIG = {\n    REALMS: {\n        MAJOR: REALM_NAMES,\n        MINOR: REALM_STAGES,\n    },\n    ELEMENTS: {\n        火: { effect: '灼烧', visual: '烈焰', nature: '爆裂', color: '#ff4444' },\n        水: { effect: '缠绕', visual: '激流', nature: '柔韧', color: '#4488ff' },\n        冰: { effect: '冻结', visual: '寒霜', nature: '极寒', color: '#88ddff' },\n        雷: { effect: '麻痹', visual: '紫电', nature: '狂暴', color: '#aa44ff' },\n        风: { effect: '切割', visual: '罡风', nature: '无形', color: '#88ff88' },\n        土: { effect: '镇压', visual: '岩铠', nature: '厚重', color: '#aa8844' },\n        木: { effect: '寄生', visual: '藤蔓', nature: '生生不息', color: '#44aa44' },\n        金: { effect: '穿透', visual: '锐金', nature: '锋利', color: '#ffdd44' },\n        暗: { effect: '腐蚀', visual: '黑雾', nature: '诡谲', color: '#442244' },\n        光: { effect: '净化', visual: '圣辉', nature: '神圣', color: '#ffffaa' },\n        混沌: { effect: '湮灭', visual: '灰光', nature: '虚无', color: '#888888' },\n    },\n};\n// 获取灵根元素颜色\nexport function getRootColor(root) {\n    for (const [elem, data] of Object.entries(CONFIG.ELEMENTS)) {\n        if (root.includes(elem)) {\n            return data.color;\n        }\n    }\n    return '#aaaaaa'; // 默认灰色\n}\n// 获取境界等级颜色\nexport function getRealmColor(level) {\n    const majorIdx = Math.floor((level - 1) / 4);\n    const colors = [\n        '#888888', // 练气 - 灰色\n        '#44aa44', // 筑基 - 绿色\n        '#4488ff', // 金丹 - 蓝色\n        '#aa44ff', // 元婴 - 紫色\n        '#ff4444', // 化神 - 红色\n        '#ffaa00', // 炼虚 - 橙色\n        '#ffdd44', // 合体 - 金色\n        '#ffffff', // 大乘 - 白色\n        '#ff88ff', // 渡劫 - 粉色\n    ];\n    return colors[majorIdx] || '#888888';\n}\n// 获取危险度颜色\nexport function getDangerColor(danger) {\n    if (danger >= 90)\n        return '#ff0000';\n    if (danger >= 70)\n        return '#ff4400';\n    if (danger >= 50)\n        return '#ff8800';\n    if (danger >= 30)\n        return '#ffcc00';\n    return '#44aa44';\n}\n","// ============================================================================\n// 动态世界书管理脚本 - 根据上下文智能启用/禁用世界书条目\n//\n// 功能：根据当前区域、境界、人物等上下文自动启用/禁用世界书条目，节省 token\n// ============================================================================\n\nimport { Schema } from '../踏月寻仙-测试版/schema';\n\n// ============================================================================\n// 配置项\n// ============================================================================\n\nconst CONFIG = {\n    // 要管理的世界书名称（修改为你的世界书名）\n    WORLDBOOK_NAME: 'current',  // 'current' 表示当前角色卡的主世界书\n\n    // 是否启用调试日志\n    DEBUG: true,\n\n    // 上下文窗口（检查最近几条消息）\n    CONTEXT_WINDOW: 5,\n\n    // 策略模式：\n    // - 'aggressive': 激进模式 - 用户输入时开启，AI回复后立即关闭大部分（最省token）\n    // - 'balanced': 平衡模式 - 用户输入时开启，AI回复后保留核心条目（推荐）\n    // - 'conservative': 保守模式 - 始终保持相关条目开启（最安全但最费token）\n    STRATEGY: 'balanced' as 'aggressive' | 'balanced' | 'conservative',\n\n    // 在 AI 回复后保持开启的条目类型（仅在 balanced 模式下生效）\n    KEEP_ENABLED_AFTER_REPLY: [\n        /^\\[系统\\]/,\n        /^\\[mvu_update\\]/,\n        /^\\[mvu\\]变量列表$/,\n        /^\\[红颜索引\\]$/,\n        /^\\[地图\\]/,  // 保持当前地图开启\n        /^\\[境界\\]/,  // 保持当前境界开启\n    ],\n};\n\n// ============================================================================\n// 规则定义 - 根据你的角色卡自定义这些规则\n// ============================================================================\n\ninterface WorldbookRule {\n    /** 条目名称匹配模式 */\n    entryPattern: string | RegExp;\n    /** 启用条件（context: 上下文, entryName: 条目名称） */\n    shouldEnable: (context: Context, entryName?: string) => boolean;\n    /** 优先级（数字越大越优先，默认 0） */\n    priority?: number;\n}\n\ninterface Context {\n    /** 当前所在区域 */\n    currentRegion: string;\n    /** 最近消息内容 */\n    recentMessages: string[];\n    /** MVU 变量数据 */\n    mvuData: ReturnType<typeof Schema.parse> | null;\n    /** 当前聊天 ID */\n    chatId: string;\n}\n\nconst RULES: WorldbookRule[] = [\n    // ============================================================================\n    // 系统设定 - 始终启用（蓝灯）\n    // ============================================================================\n    {\n        entryPattern: /^\\[系统\\]/,\n        shouldEnable: () => true,\n        priority: 100,\n    },\n    {\n        entryPattern: /^\\[mvu_update\\]/,\n        shouldEnable: () => true,\n        priority: 100,\n    },\n    {\n        entryPattern: /^\\[mvu\\]变量列表$/,\n        shouldEnable: () => true,\n        priority: 100,\n    },\n\n    // ============================================================================\n    // 地图相关 - 精确匹配当前区域\n    // ============================================================================\n    {\n        entryPattern: /^\\[地图\\]\\s*(.+)$/,\n        shouldEnable: (ctx, entryName) => {\n            if (!entryName || !ctx.currentRegion) return false;\n            const match = entryName.match(/^\\[地图\\]\\s*(.+)$/);\n            if (!match) return false;\n            const regionName = match[1].trim();\n\n            // 精确匹配：当前区域必须完全等于地图名称\n            const isMatch = ctx.currentRegion === regionName;\n\n            if (CONFIG.DEBUG && isMatch) {\n                console.log(`[动态世界书] 地图匹配成功: ${regionName} === ${ctx.currentRegion}`);\n            }\n\n            return isMatch;\n        },\n        priority: 10,\n    },\n\n    // ============================================================================\n    // 角色相关 - 精确匹配角色名和阶段\n    // ============================================================================\n    // 1. 带阶段的角色条目（如：[角色] 凌寒镜 - 心动期）\n    {\n        entryPattern: /^\\[角色\\]\\s*(.+?)\\s*-\\s*(陌生期|好感期|心动期|确认期|深爱期)$/,\n        shouldEnable: (ctx, entryName) => {\n            if (!entryName) return false;\n            const match = entryName.match(/^\\[角色\\]\\s*(.+?)\\s*-\\s*(陌生期|好感期|心动期|确认期|深爱期)$/);\n            if (!match) return false;\n\n            const characterName = match[1].trim();\n            const stageName = match[2];\n\n            // 检查角色是否在红颜列表中\n            const hongyanData = ctx.mvuData?.红颜?.[characterName];\n            if (!hongyanData) {\n                if (CONFIG.DEBUG) {\n                    console.log(`[动态世界书] 角色不在红颜列表中: ${characterName}`);\n                }\n                return false;\n            }\n\n            // 精确匹配：角色名必须作为独立词出现\n            // 使用更严格的匹配：前后必须是非中文字符、标点或边界\n            const escaped = characterName.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n            const nameRegex = new RegExp(\n                `(?:^|[\\\\s\\\\p{P}，。！？；：\"\"''「」『』【】《》〈〉（）])(${escaped})(?:[\\\\s\\\\p{P}，。！？；：\"\"''「」『』【】《》〈〉（）]|$)`,\n                'u'\n            );\n            const isMentioned = ctx.recentMessages.some(msg => nameRegex.test(msg));\n\n            if (!isMentioned) {\n                if (CONFIG.DEBUG) {\n                    console.log(`[动态世界书] 角色未在近期消息中提及: ${characterName}`);\n                }\n                return false;\n            }\n\n            // 好感度阶段精确映射\n            const favorStages: Record<string, [number, number]> = {\n                '陌生期': [-100, 20],\n                '好感期': [21, 40],\n                '心动期': [41, 60],\n                '确认期': [61, 80],\n                '深爱期': [81, 100],\n            };\n\n            const range = favorStages[stageName];\n            if (!range) return false;\n\n            const favor = hongyanData.好感度 ?? 0;\n            const isInRange = favor >= range[0] && favor <= range[1];\n\n            if (CONFIG.DEBUG) {\n                console.log(`[动态世界书] 角色阶段匹配: ${characterName} - ${stageName}, 好感度=${favor}, 范围=[${range[0]}, ${range[1]}], 匹配=${isInRange}`);\n            }\n\n            return isInRange;\n        },\n        priority: 9,\n    },\n\n    // 2. 基础角色条目（如：[角色] 凌寒镜）\n    {\n        entryPattern: /^\\[角色\\]\\s*([^-]+)$/,\n        shouldEnable: (ctx, entryName) => {\n            if (!entryName) return false;\n            const match = entryName.match(/^\\[角色\\]\\s*([^-]+)$/);\n            if (!match) return false;\n            const characterName = match[1].trim();\n\n            // 检查是否在红颜列表或红颜角色库中\n            const isInHongyan = ctx.mvuData?.红颜?.[characterName] !== undefined;\n            const isInLibrary = ctx.mvuData?.红颜角色库?.[characterName] !== undefined;\n\n            // 精确匹配：角色名必须作为独立词出现\n            const escaped = characterName.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n            const nameRegex = new RegExp(\n                `(?:^|[\\\\s\\\\p{P}，。！？；：\"\"''「」『』【】《》〈〉（）])(${escaped})(?:[\\\\s\\\\p{P}，。！？；：\"\"''「」『』【】《》〈〉（）]|$)`,\n                'u'\n            );\n            const mentionCount = ctx.recentMessages.filter(msg => nameRegex.test(msg)).length;\n\n            // 红颜列表中的角色：至少提到1次\n            // 红颜角色库中的角色：至少提到1次\n            // 其他角色：至少提到2次（避免误触发）\n            let threshold = 2;\n            if (isInHongyan || isInLibrary) {\n                threshold = 1;\n            }\n\n            const shouldEnable = mentionCount >= threshold;\n\n            if (CONFIG.DEBUG && mentionCount > 0) {\n                console.log(`[动态世界书] 角色提及检测: ${characterName}, 提及次数=${mentionCount}, 阈值=${threshold}, 启用=${shouldEnable}`);\n            }\n\n            return shouldEnable;\n        },\n        priority: 8,\n    },\n\n    // ============================================================================\n    // 境界相关 - 精确匹配当前境界等级\n    // ============================================================================\n    {\n        entryPattern: /^\\[境界\\]\\s*(.+)$/,\n        shouldEnable: (ctx, entryName) => {\n            if (!entryName) return false;\n            const match = entryName.match(/^\\[境界\\]\\s*(.+)$/);\n            if (!match) return false;\n            const realmName = match[1].trim();\n            const level = ctx.mvuData?.本尊?.等级 ?? 1;\n\n            // 境界等级映射（根据踏月寻仙设定，与 schema.ts 保持一致）\n            const realmRanges: Record<string, [number, number]> = {\n                '练气': [1, 4],\n                '筑基': [5, 8],\n                '金丹': [9, 12],\n                '元婴': [13, 16],\n                '化神': [17, 20],\n                '炼虚': [21, 24],  // 修正：schema 中是\"炼虚\"而非\"合体\"\n                '合体': [25, 28],\n                '大乘': [29, 32],\n                '渡劫': [33, 36],\n            };\n\n            const range = realmRanges[realmName];\n            if (!range) {\n                if (CONFIG.DEBUG) {\n                    console.log(`[动态世界书] 未知境界名称: ${realmName}`);\n                }\n                return false;\n            }\n\n            const isInRange = level >= range[0] && level <= range[1];\n\n            if (CONFIG.DEBUG) {\n                console.log(`[动态世界书] 境界匹配: ${realmName}, 等级=${level}, 范围=[${range[0]}, ${range[1]}], 匹配=${isInRange}`);\n            }\n\n            return isInRange;\n        },\n        priority: 7,\n    },\n\n    // ============================================================================\n    // 事件相关 - 精确匹配事件关键词\n    // ============================================================================\n    {\n        entryPattern: /^\\[事件\\]\\s*(.+)$/,\n        shouldEnable: (ctx, entryName) => {\n            if (!entryName) return false;\n            const match = entryName.match(/^\\[事件\\]\\s*(.+)$/);\n            if (!match) return false;\n            const eventName = match[1].trim();\n\n            // 精确匹配：事件名必须作为独立词出现\n            const escaped = eventName.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n            const eventRegex = new RegExp(\n                `(?:^|[\\\\s\\\\p{P}，。！？；：\"\"''「」『』【】《》〈〉（）])(${escaped})(?:[\\\\s\\\\p{P}，。！？；：\"\"''「」『』【】《》〈〉（）]|$)`,\n                'u'\n            );\n\n            const isMentioned = ctx.recentMessages.some(msg => eventRegex.test(msg));\n\n            if (CONFIG.DEBUG && isMentioned) {\n                console.log(`[动态世界书] 事件匹配成功: ${eventName}`);\n            }\n\n            return isMentioned;\n        },\n        priority: 3,\n    },\n\n    // ============================================================================\n    // 红颜索引 - 始终启用\n    // ============================================================================\n    {\n        entryPattern: /^\\[红颜索引\\]$/,\n        shouldEnable: () => true,\n        priority: 100,\n    },\n\n    // ============================================================================\n    // 物品/法宝/功法/势力/地点库 - 精确匹配条目\n    // ============================================================================\n    {\n        entryPattern: /^\\[(物品|法宝|功法|势力|地点|灵根|体质)\\]\\s*(.+)$/,\n        shouldEnable: (ctx, entryName) => {\n            if (!entryName) return false;\n            const match = entryName.match(/^\\[(物品|法宝|功法|势力|地点|灵根|体质)\\]\\s*(.+)$/);\n            if (!match) return false;\n\n            const category = match[1];\n            const itemName = match[2].trim();\n\n            // 精确匹配：物品名必须在消息中完整出现\n            const escaped = itemName.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n            const itemRegex = new RegExp(escaped, 'u');\n\n            // 检查最近消息中是否提到\n            const mentionCount = ctx.recentMessages.filter(msg => itemRegex.test(msg)).length;\n\n            // 至少提到2次才启用（避免误触发）\n            const shouldEnable = mentionCount >= 2;\n\n            if (CONFIG.DEBUG && mentionCount > 0) {\n                console.log(`[动态世界书] ${category}匹配: ${itemName}, 提及次数=${mentionCount}, 启用=${shouldEnable}`);\n            }\n\n            return shouldEnable;\n        },\n        priority: 5,\n    },\n];\n\n// ============================================================================\n// 核心逻辑\n// ============================================================================\n\nlet isProcessing = false;\n\nasync function getContext(): Promise<Context> {\n    // 等待 MVU 初始化\n    await waitGlobalInitialized('Mvu');\n\n    // 获取最近的消息（安全地获取，避免消息数不足导致错误）\n    let recentMessages: string[] = [];\n    try {\n        // 获取最后消息 ID\n        const lastMessageId = getLastMessageId();\n        if (lastMessageId >= 0) {\n            // 有消息，获取所有消息\n            const allMessages = getChatMessages(`0-${lastMessageId}`);\n            if (allMessages && allMessages.length > 0) {\n                // 取最近的 N 条消息\n                recentMessages = allMessages.slice(-CONFIG.CONTEXT_WINDOW).map(m => m.message || '');\n            }\n        } else {\n            // 没有消息\n            if (CONFIG.DEBUG) {\n                console.log('[动态世界书] 当前聊天还没有消息');\n            }\n        }\n    } catch (e) {\n        // 获取失败，使用空数组\n        if (CONFIG.DEBUG) {\n            console.warn('[动态世界书] 获取消息失败，可能是新聊天', e);\n        }\n        recentMessages = [];\n    }\n\n    // 获取 MVU 数据\n    let mvuData: ReturnType<typeof Schema.parse> | null = null;\n    try {\n        // 先尝试从最后一楼获取\n        const variables = getVariables({ type: 'message', message_id: -1 });\n        const statData = _.get(variables, 'stat_data', null);\n        if (statData) {\n            mvuData = Schema.parse(statData);\n        } else {\n            // 如果最后一楼没有数据，尝试从聊天变量获取（可能是新聊天）\n            if (CONFIG.DEBUG) {\n                console.log('[动态世界书] 最后一楼没有 MVU 数据，尝试从聊天变量获取');\n            }\n            const chatVariables = getVariables({ type: 'chat' });\n            const chatStatData = _.get(chatVariables, 'stat_data', null);\n            if (chatStatData) {\n                mvuData = Schema.parse(chatStatData);\n            }\n        }\n    } catch (e) {\n        if (CONFIG.DEBUG) {\n            console.warn('[动态世界书] 无法获取 MVU 数据，可能是新聊天还未初始化', e);\n        }\n    }\n\n    const currentRegion = mvuData?.本尊?.行踪?.当前区域 ?? '未知';\n    const chatId = SillyTavern.getCurrentChatId();\n\n    if (CONFIG.DEBUG) {\n        console.log(`[动态世界书] 上下文获取完成: 区域=\"${currentRegion}\", 消息数=${recentMessages.length}, MVU数据=${mvuData ? '有' : '无'}`);\n    }\n\n    return {\n        currentRegion,\n        recentMessages,\n        mvuData,\n        chatId,\n    };\n}\n\n/**\n * 更新世界书条目\n * @param mode 'enable' - 用户输入前启用相关条目; 'disable' - AI回复后禁用非核心条目\n */\nasync function updateWorldbookEntries(mode: 'enable' | 'disable' = 'enable') {\n    if (isProcessing) {\n        if (CONFIG.DEBUG) {\n            console.log('[动态世界书] 正在处理中，跳过本次更新');\n        }\n        return;\n    }\n    isProcessing = true;\n\n    try {\n        const context = await getContext();\n\n        // 获取世界书名称\n        let worldbookName = CONFIG.WORLDBOOK_NAME;\n        if (worldbookName === 'current') {\n            const charWorldbooks = getCharWorldbookNames('current');\n            worldbookName = charWorldbooks.primary || '';\n            if (!worldbookName) {\n                console.warn('[动态世界书] 当前角色卡没有绑定主世界书');\n                return;\n            }\n        }\n\n        let enabledCount = 0;\n        let disabledCount = 0;\n        let totalProcessed = 0;\n\n        // 按优先级排序规则\n        const sortedRules = [...RULES].sort((a, b) => (b.priority ?? 0) - (a.priority ?? 0));\n\n        // 使用 updateWorldbookWith 更新世界书\n        await updateWorldbookWith(worldbookName, worldbook => {\n            if (CONFIG.DEBUG) {\n                console.log(`[动态世界书] 开始处理世界书 [${mode}模式]: ${worldbookName}, 共 ${worldbook.length} 个条目`);\n                console.log(`[动态世界书] 当前上下文: 区域=\"${context.currentRegion}\", 等级=${context.mvuData?.本尊?.等级 ?? '未知'}, 消息数=${context.recentMessages.length}`);\n            }\n\n            for (const entry of worldbook) {\n                // 跳过未启用的条目\n                if (!entry.enabled) {\n                    continue;\n                }\n\n                const entryName = entry.name || '';\n                if (!entryName) {\n                    if (CONFIG.DEBUG) {\n                        console.warn('[动态世界书] 发现无名称条目，跳过');\n                    }\n                    continue;\n                }\n\n                let matchedRule: WorldbookRule | null = null;\n\n                // 查找匹配的规则（按优先级从高到低）\n                for (const rule of sortedRules) {\n                    const matches =\n                        typeof rule.entryPattern === 'string'\n                            ? entryName.includes(rule.entryPattern)\n                            : rule.entryPattern.test(entryName);\n\n                    if (matches) {\n                        matchedRule = rule;\n                        break; // 找到第一个匹配的规则就停止\n                    }\n                }\n\n                // 如果没有匹配的规则，保持原状不变\n                if (!matchedRule) {\n                    continue;\n                }\n\n                const currentType = entry.strategy.type;\n\n                // 根据模式决定操作\n                if (mode === 'enable') {\n                    // 启用模式：根据规则评估是否应该启用\n                    let shouldBeConstant = false;\n                    try {\n                        shouldBeConstant = matchedRule.shouldEnable(context, entryName);\n                    } catch (e) {\n                        console.error(`[动态世界书] 评估条目 \"${entryName}\" 时出错:`, e);\n                        continue;\n                    }\n\n                    if (shouldBeConstant && currentType !== 'constant') {\n                        entry.strategy.type = 'constant';\n                        enabledCount++;\n                        totalProcessed++;\n                        if (CONFIG.DEBUG) {\n                            console.log(`[动态世界书] ✅ 改为蓝灯: ${entryName}`);\n                        }\n                    }\n                } else {\n                    // 禁用模式：根据策略决定是否保留\n                    if (currentType === 'constant') {\n                        let shouldKeepEnabled = false;\n\n                        // 根据策略决定是否保留\n                        if (CONFIG.STRATEGY === 'conservative') {\n                            // 保守模式：保持所有已启用的条目\n                            shouldKeepEnabled = true;\n                        } else if (CONFIG.STRATEGY === 'balanced') {\n                            // 平衡模式：保留核心条目\n                            shouldKeepEnabled = CONFIG.KEEP_ENABLED_AFTER_REPLY.some(pattern =>\n                                pattern.test(entryName)\n                            );\n                        } else {\n                            // 激进模式：只保留最核心的系统条目\n                            shouldKeepEnabled = /^\\[系统\\]/.test(entryName) ||\n                                /^\\[mvu_update\\]/.test(entryName) ||\n                                /^\\[mvu\\]变量列表$/.test(entryName);\n                        }\n\n                        if (!shouldKeepEnabled) {\n                            entry.strategy.type = 'selective';\n                            disabledCount++;\n                            totalProcessed++;\n                            if (CONFIG.DEBUG) {\n                                console.log(`[动态世界书] ⚠️ 改为绿灯: ${entryName}`);\n                            }\n                        }\n                    }\n                }\n            }\n\n            if (CONFIG.DEBUG) {\n                console.log(`[动态世界书] 处理完成 [${mode}模式]，修改 ${totalProcessed} 个条目 (启用 ${enabledCount} 个, 禁用 ${disabledCount} 个)`);\n            }\n\n            return worldbook;\n        });\n\n        // 输出更新摘要\n        if (enabledCount > 0 || disabledCount > 0) {\n            const modeText = mode === 'enable' ? '准备AI回复' : 'AI回复完成';\n            const message = `${modeText}: 启用 ${enabledCount} 个, 禁用 ${disabledCount} 个`;\n            console.info(`[动态世界书] ${message}`);\n            if (CONFIG.DEBUG) {\n                toastr.info(message, '动态世界书');\n            }\n        } else {\n            if (CONFIG.DEBUG) {\n                console.log(`[动态世界书] 本次无需更新条目状态 [${mode}模式]`);\n            }\n        }\n    } catch (e) {\n        console.error('[动态世界书] 更新失败', e);\n        toastr.error(`更新世界书失败: ${e instanceof Error ? e.message : '未知错误'}`, '动态世界书');\n    } finally {\n        isProcessing = false;\n    }\n}\n\n// ============================================================================\n// 初始化\n// ============================================================================\n\n$(() => {\n    errorCatched(async () => {\n        console.info('[动态世界书] 脚本已加载');\n        console.info(`[动态世界书] 当前策略: ${CONFIG.STRATEGY}`);\n\n        // 等待 MVU 初始化\n        await waitGlobalInitialized('Mvu');\n        console.info('[动态世界书] MVU 框架已初始化');\n\n        // 初始检查 - 启用相关条目\n        await updateWorldbookEntries('enable');\n        console.info('[动态世界书] 初始化检查完成');\n\n        // ========================================================================\n        // 核心逻辑：用户输入前启用，AI回复后禁用\n        // ========================================================================\n\n        // 监听用户发送消息 - 在用户输入后、AI 回复前启用相关条目\n        eventOn(tavern_events.MESSAGE_SENT, async () => {\n            if (CONFIG.DEBUG) {\n                console.log('[动态世界书] 🟢 用户发送消息，启用相关世界书条目');\n            }\n            await updateWorldbookEntries('enable');\n        });\n\n        // 监听 AI 消息接收完成 - AI 回复后禁用非核心条目以节省 token\n        eventOn(tavern_events.MESSAGE_RECEIVED, async () => {\n            if (CONFIG.DEBUG) {\n                console.log('[动态世界书] 🔴 AI 回复完成，禁用非核心世界书条目');\n            }\n            // 延迟一小段时间，确保消息完全接收\n            await new Promise(resolve => setTimeout(resolve, 200));\n            await updateWorldbookEntries('disable');\n        });\n\n        // ========================================================================\n        // 辅助逻辑：聊天切换、变量更新等场景\n        // ========================================================================\n\n        // 监听聊天切换事件（新开聊天或切换聊天时触发）\n        eventOn(tavern_events.CHAT_CHANGED, async () => {\n            if (CONFIG.DEBUG) {\n                console.log('[动态世界书] 触发事件: CHAT_CHANGED');\n            }\n            // 延迟时间增加到1秒,确保聊天完全加载\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            await updateWorldbookEntries('enable');\n        });\n\n        // 监听新建聊天事件\n        eventOn(tavern_events.CHAT_CREATED, async () => {\n            if (CONFIG.DEBUG) {\n                console.log('[动态世界书] 触发事件: CHAT_CREATED');\n            }\n            // 延迟时间增加到1秒,确保聊天完全初始化\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            await updateWorldbookEntries('enable');\n        });\n\n        // 监听角色页面加载完成事件（切换角色时触发）\n        eventOn(tavern_events.CHARACTER_PAGE_LOADED, async () => {\n            if (CONFIG.DEBUG) {\n                console.log('[动态世界书] 触发事件: CHARACTER_PAGE_LOADED');\n            }\n            // 延迟时间增加到1秒,确保角色完全加载\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            await updateWorldbookEntries('enable');\n        });\n\n        // 监听 MVU 变量更新 - 变量更新后重新评估需要启用的条目\n        eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, async () => {\n            if (CONFIG.DEBUG) {\n                console.log('[动态世界书] 触发事件: VARIABLE_UPDATE_ENDED');\n            }\n            await updateWorldbookEntries('enable');\n        });\n\n        const strategyText =\n            CONFIG.STRATEGY === 'aggressive' ? '激进模式（最省token）' :\n                CONFIG.STRATEGY === 'balanced' ? '平衡模式（推荐）' :\n                    '保守模式（最安全）';\n\n        console.info(`[动态世界书] 监听器已设置，策略：${strategyText}`);\n        toastr.success(`动态世界书已启用 - ${strategyText}`, '踏月寻仙');\n    })();\n});"],"names":["z","REALM_NAMES","REALM_STAGES","REALM_THRESHOLDS","REALM_LIFESPANS","ItemSchema","object","string","prefault","coerce","number","transform","v","Math","max","FactionSchema","enum","optional","TechniqueSchema","describe","TreasureSchema","LocationSchema","_","clamp","array","SpiritRootSchema","PhysiqueSchema","Schema","record","layer","danger","desc","connections","boolean","data","pickBy","level","majorIdx","floor","toFixed","WORLDBOOK_NAME","DEBUG","CONTEXT_WINDOW","STRATEGY","KEEP_ENABLED_AFTER_REPLY","RULES","entryPattern","shouldEnable","priority","ctx","entryName","currentRegion","match","regionName","trim","isMatch","console","log","characterName","stageName","hongyanData","mvuData","escaped","replace","nameRegex","RegExp","recentMessages","some","msg","test","range","favor","isInRange","isInHongyan","undefined","isInLibrary","mentionCount","filter","length","threshold","realmName","eventName","eventRegex","isMentioned","category","itemName","itemRegex","isProcessing","async","updateWorldbookEntries","mode","context","waitGlobalInitialized","lastMessageId","getLastMessageId","allMessages","getChatMessages","slice","map","m","message","e","warn","variables","getVariables","type","message_id","statData","get","parse","chatVariables","chatStatData","chatId","SillyTavern","getCurrentChatId","getContext","worldbookName","charWorldbooks","getCharWorldbookNames","primary","enabledCount","disabledCount","totalProcessed","sortedRules","sort","a","b","updateWorldbookWith","worldbook","entry","enabled","name","matchedRule","rule","includes","currentType","strategy","shouldBeConstant","error","shouldKeepEnabled","pattern","info","toastr","Error","$","errorCatched","eventOn","tavern_events","MESSAGE_SENT","MESSAGE_RECEIVED","Promise","resolve","setTimeout","CHAT_CHANGED","CHAT_CREATED","CHARACTER_PAGE_LOADED","Mvu","events","VARIABLE_UPDATE_ENDED","strategyText","success"],"ignoreList":[],"sourceRoot":""}