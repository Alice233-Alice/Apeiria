{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/美化状态栏/schema.ts","src://tavern_helper_template/src/踏月寻仙-变量结构/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","// ============================================================================\n// 踏月寻仙 - MVU 变量结构定义 (Zod Schema for MVU Variables)\n// ============================================================================\n// 修炼境界等级与突破阈值映射\nconst REALM_THRESHOLDS = [100, 100, 100, 100, 200, 200, 200, 200, 400, 400, 400, 400, 800, 800, 800, 800, 1600, 1600, 1600, 1600, 3200, 3200, 3200, 3200, 6400, 6400, 6400, 6400, 12800, 12800, 12800, 12800, 25600, 25600, 25600, 25600];\n// 修炼境界等级与寿元上限映射\nconst REALM_LIFESPANS = [100, 100, 100, 100, 200, 200, 200, 200, 500, 500, 500, 500, 1000, 1000, 1000, 1000, 2000, 2000, 2000, 2000, 5000, 5000, 5000, 5000, 10000, 10000, 10000, 10000, 50000, 50000, 50000, 50000, 100000, 100000, 100000, 100000];\n// 修炼境界等级与境界描述映射\nconst REALM_NAMES = ['练气', '筑基', '金丹', '元婴', '化神', '炼虚', '合体', '大乘', '渡劫'];\nconst REALM_STAGES = ['初期', '中期', '后期', '大圆满'];\n// 物品 Schema\nconst ItemSchema = z.object({\n    名称: z.string(),\n    描述: z.string(),\n    品阶: z.string(),\n    数量: z.coerce.number(),\n});\n// 修士基础字段（不含 transform）\nconst CultivatorBaseFields = {\n    等级: z.coerce.number().transform(v => _.clamp(v, 1, 36)),\n    修为: z.coerce.number().transform(v => Math.max(0, v)),\n    灵根: z.string().prefault('五行杂灵根'),\n    体质: z.string().prefault('凡体'),\n    功法: z.string().prefault('无'),\n    本命兵器: z.string().prefault('无'),\n    神通列表: z.record(z.string().describe('神通名'), z.string().describe('神通描述')).prefault({}),\n    灵石: z.coerce.number().transform(v => Math.max(0, v)),\n    已活岁月: z.coerce.number().transform(v => Math.max(0, v)),\n    尝试突破: z.boolean().prefault(false),\n};\n// 计算衍生数据的辅助函数\nfunction addDerivedFields(data) {\n    const level = data.等级;\n    const 突破阈值 = REALM_THRESHOLDS[level - 1] || 100;\n    const 寿元上限 = REALM_LIFESPANS[level - 1] || 100;\n    const majorIdx = Math.floor((level - 1) / 4);\n    const minorIdx = (level - 1) % 4;\n    const 境界描述 = `${REALM_NAMES[majorIdx] || '练气'}${REALM_STAGES[minorIdx]}`;\n    const 寿元状态 = `${data.已活岁月}/${寿元上限}`;\n    const 状态 = data.尝试突破 ? '突破中' : data.修为 >= 突破阈值 ? '瓶颈期' : '修炼中';\n    const 进度 = `${((data.修为 / 突破阈值) * 100).toFixed(1)}%`;\n    return {\n        ...data,\n        突破阈值,\n        寿元上限,\n        境界描述,\n        寿元状态,\n        状态,\n        进度,\n    };\n}\n// 完整的 MVU 变量结构\nexport const Schema = z.object({\n    世界时钟: z\n        .object({\n        纪元: z.string().prefault('末法时代'),\n        年份: z.coerce.number().prefault(1),\n    })\n        .prefault({}),\n    世界地图: z\n        .record(z.string().describe('区域名'), z.object({\n        layer: z.enum(['天层', '地层', '下层']).prefault('地层'),\n        danger: z.coerce.number().transform(v => _.clamp(v, 0, 100)),\n        desc: z.string().prefault(''),\n        connections: z.array(z.string()).prefault([]),\n    }))\n        .prefault({}),\n    世界图志: z\n        .record(z.string().describe('事件名'), z.object({\n        状态: z.string().prefault(''),\n        事件: z.string().prefault(''),\n    }))\n        .prefault({}),\n    本尊: z\n        .object({\n        ...CultivatorBaseFields,\n        行踪: z\n            .object({\n            当前区域: z.string().prefault('未知之地'),\n            所属层级: z.string().optional(),\n            环境描述: z.string().optional(),\n            危险度: z.coerce.number().optional(),\n            可用通道: z.array(z.string()).optional(),\n            导航信息: z.string().optional(),\n        })\n            .prefault({}),\n        身份: z\n            .object({\n            姓名: z.string().prefault('无名氏'),\n            宗门: z.string().prefault('散修'),\n            出身: z.string().prefault('凡人'),\n        })\n            .prefault({}),\n        背包: z\n            .record(z.string().describe('物品名'), ItemSchema)\n            .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0))\n            .prefault({}),\n        法宝: z\n            .record(z.string().describe('法宝名'), ItemSchema)\n            .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0))\n            .prefault({}),\n        杂物袋: z\n            .record(z.string().describe('杂物名'), ItemSchema)\n            .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0))\n            .prefault({}),\n    })\n        .transform(addDerivedFields)\n        .prefault({\n        等级: 1,\n        修为: 0,\n        灵根: '五行杂灵根',\n        体质: '凡体',\n        功法: '无',\n        本命兵器: '无',\n        灵石: 0,\n        已活岁月: 16,\n        尝试突破: false,\n    }),\n    红颜: z\n        .record(z.string().describe('红颜名'), z\n        .object({\n        ...CultivatorBaseFields,\n        好感度: z.coerce.number().transform(v => _.clamp(v, -100, 100)),\n        关系: z.string().prefault('陌生人'),\n        重要性: z.string().prefault('路人'),\n    })\n        .transform(addDerivedFields))\n        .prefault({}),\n    NPC图鉴: z\n        .record(z.string().describe('NPC名'), z\n        .object({\n        ...CultivatorBaseFields,\n        所在宗门: z.string().prefault('散修'),\n    })\n        .transform(addDerivedFields))\n        .prefault({}),\n});\n// 配置常量\nexport const CONFIG = {\n    REALMS: {\n        MAJOR: REALM_NAMES,\n        MINOR: REALM_STAGES,\n    },\n    ELEMENTS: {\n        火: { effect: '灼烧', visual: '烈焰', nature: '爆裂', color: '#ff4444' },\n        水: { effect: '缠绕', visual: '激流', nature: '柔韧', color: '#4488ff' },\n        冰: { effect: '冻结', visual: '寒霜', nature: '极寒', color: '#88ddff' },\n        雷: { effect: '麻痹', visual: '紫电', nature: '狂暴', color: '#aa44ff' },\n        风: { effect: '切割', visual: '罡风', nature: '无形', color: '#88ff88' },\n        土: { effect: '镇压', visual: '岩铠', nature: '厚重', color: '#aa8844' },\n        木: { effect: '寄生', visual: '藤蔓', nature: '生生不息', color: '#44aa44' },\n        金: { effect: '穿透', visual: '锐金', nature: '锋利', color: '#ffdd44' },\n        暗: { effect: '腐蚀', visual: '黑雾', nature: '诡谲', color: '#442244' },\n        光: { effect: '净化', visual: '圣辉', nature: '神圣', color: '#ffffaa' },\n        混沌: { effect: '湮灭', visual: '灰光', nature: '虚无', color: '#888888' },\n    },\n};\n// 获取灵根元素颜色\nexport function getRootColor(root) {\n    for (const [elem, data] of Object.entries(CONFIG.ELEMENTS)) {\n        if (root.includes(elem)) {\n            return data.color;\n        }\n    }\n    return '#aaaaaa'; // 默认灰色\n}\n// 获取境界等级颜色\nexport function getRealmColor(level) {\n    const majorIdx = Math.floor((level - 1) / 4);\n    const colors = [\n        '#888888', // 练气 - 灰色\n        '#44aa44', // 筑基 - 绿色\n        '#4488ff', // 金丹 - 蓝色\n        '#aa44ff', // 元婴 - 紫色\n        '#ff4444', // 化神 - 红色\n        '#ffaa00', // 炼虚 - 橙色\n        '#ffdd44', // 合体 - 金色\n        '#ffffff', // 大乘 - 白色\n        '#ff88ff', // 渡劫 - 粉色\n    ];\n    return colors[majorIdx] || '#888888';\n}\n// 获取危险度颜色\nexport function getDangerColor(danger) {\n    if (danger >= 90)\n        return '#ff0000';\n    if (danger >= 70)\n        return '#ff4400';\n    if (danger >= 50)\n        return '#ff8800';\n    if (danger >= 30)\n        return '#ffcc00';\n    return '#44aa44';\n}\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\r\nimport { Schema } from '../美化状态栏/schema';\r\n\r\n$(() => {\r\n    registerMvuSchema(Schema);\r\n    console.info('[踏月寻仙] MVU 变量结构已注册');\r\n});"],"names":["z","REALM_THRESHOLDS","REALM_LIFESPANS","REALM_NAMES","REALM_STAGES","ItemSchema","object","string","coerce","number","CultivatorBaseFields","transform","v","_","clamp","Math","max","prefault","record","describe","boolean","addDerivedFields","data","level","majorIdx","floor","toFixed","Schema","layer","enum","danger","desc","connections","array","optional","pickBy","$","console","info"],"ignoreList":[],"sourceRoot":""}